<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UOPI - Dashboard Operativo</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #22d3ee;
      --accent-color: #38bdf8;
      --danger-color: #ef4444;
      --surf-bg: #0f172a;
      --card-bg: #1e293b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --shadow: 0 6px 20px rgba(37, 99, 235, 0.12);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(120deg, var(--surf-bg) 60%, var(--accent-color) 100%);
      color: var(--text-primary);
      min-height: 100vh;
      overflow-x: hidden;
    }
    .fade-in { animation: fadeIn 0.8s ease; }
    @keyframes fadeIn { from { opacity:0; transform: scale(0.98) translateY(20px); } to { opacity:1; transform:none; } }
    .slide-up { animation: slideUp 0.8s cubic-bezier(.32,1.56,.49,1); }
    @keyframes slideUp { from { opacity:0; transform: translateY(60px); } to { opacity:1; transform:none; } }
    .pulse { animation: pulse 1.3s infinite alternate cubic-bezier(.47,1.4,.55,.92); }
    @keyframes pulse { from { box-shadow:none; } to { box-shadow:0 0 0 8px rgba(37,99,235,.1); } }

    .login-container {
      min-height: 100vh; display: flex; align-items: center; justify-content: center; background: transparent;
    }
    .login-card {
      background: var(--card-bg);
      border-radius: 22px;
      box-shadow: var(--shadow);
      padding: 2.5rem 2.5rem 2rem;
      width: 355px;
      text-align: center;
      transition: box-shadow .3s;
    }
    .login-card:hover { box-shadow: 0 10px 32px rgba(37,99,235,0.23);}
    .logo-badge {
      background: linear-gradient(120deg, var(--primary-color), var(--secondary-color));
      width: 80px; height: 80px; border-radius: 50%;
      margin: 0 auto 1rem; font-size: 2.1rem; color: #fff;
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 4px 20px rgba(34,211,238,0.13);
      animation: pulse 1.5s infinite alternate;
    }
    .login-title { font-size: 2rem; font-weight: 700; background: linear-gradient(120deg, var(--primary-color), var(--accent-color)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 0.35rem;}
    .login-subtitle { color: var(--text-secondary); font-size: 1.06rem; margin-bottom: 1.3rem;}
    .discord-login-btn {
      width: 100%; padding: 1rem; background: #5865f2; border: none; border-radius: 16px;
      font-size: 1.08rem; font-weight: 600; color: #fff; display: flex; align-items: center; justify-content: center; gap: .7rem; box-shadow: 0 4px 20px rgba(88,101,242,.10); margin-bottom: 1.1rem; margin-top:.5rem; transition:.22s;
      position: relative; overflow: hidden;
    }
    .discord-login-btn::after {
      content: ''; position: absolute; left:0;top:0;width:100%;height:100%; background:#fff3; opacity:0; transition:.3s;
    }
    .discord-login-btn:hover, .discord-login-btn:focus { background: #4752C4; transform: translateY(-2px) scale(1.03);}
    .discord-login-btn:active::after {opacity:1;}
    .features-grid { display:grid; grid-template-columns: 1fr 1fr; gap:.55rem; }
    .feature-card { background:rgba(30,41,59,.76); padding:.6rem .3rem; border-radius:10px; border:1px solid var(--accent-color); text-align:center; font-size:.80rem; box-shadow:var(--shadow);}
    .feature-icon { color:var(--secondary-color); font-size:1.08rem; margin-bottom:.18rem;}
    .feature-title { font-weight:600; font-size:.90rem; margin-bottom:.02rem;}
    .feature-desc { color:var(--text-secondary); font-size:.73rem;}
    .error-message { color:var(--danger-color); font-size: .98rem; margin-bottom:.8rem;display:none; border:1px solid var(--danger-color); border-radius:7px; background: #ef444410; padding:.6rem;}
    .error-message.show { display:block;}
    /* DASHBOARD STYLES */
    .dashboard { min-height:100vh; display:none; animation: fadeIn .9s;}
    .dashboard.active { display:block;}
    .header {
      display:flex; justify-content:space-between; align-items: center; padding:1.3rem 1.8rem; background: var(--card-bg); border-bottom:1px solid var(--accent-color); box-shadow:var(--shadow); position:sticky;top:0;z-index:50;
    }
    .header-left { display:flex; align-items:center; gap:1rem;}
    .header-logo { background:linear-gradient(120deg,var(--primary-color),var(--secondary-color)); width:44px;height:44px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.4rem;}
    .header-title { font-size:1.25rem; font-weight:700;}
    .user-info { display:flex;align-items:center;gap:.55rem;padding:.57rem 1.15rem;background:rgba(34,211,238,.13);border-radius:8px;}
    .user-avatar { width:32px;height:32px;border-radius:50%;background: var(--accent-color);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:600; font-size: 1.09rem;}
    .logout-btn { padding:.5rem 1.1rem; background:var(--danger-color); border:none; border-radius:8px; color:#fff;font-weight:600; cursor:pointer;transition:.17s;}
    .logout-btn:hover { background:#dc2626;}
    .main-container { display: flex; min-height:calc(100vh - 88px);}
    .sidebar {
      width:190px;background: var(--card-bg);border-right:1px solid var(--accent-color);padding:2rem 0;
      transition:.19s; display:grid; gap:.9rem; position:relative; min-height:calc(100vh - 88px);
    }
    .nav-item {
      display:flex;align-items:center;gap:1.1rem;padding:.96rem 2rem; cursor:pointer;transition:.17s;background:none;color:var(--text-secondary);border:none;width:100%;text-align:left;font-size:.98rem;border-radius:8px;
    }
    .nav-item:hover {background:rgba(34,211,238,.09); color:var(--secondary-color);}
    .nav-item.active {background:rgba(37,99,235,.17); color:var(--primary-color);border-right:3px solid var(--primary-color);}
    .nav-icon { width:24px;text-align:center;}
    .content {flex:1;padding:2rem 1.3rem;overflow-y:auto;}
    .page-section { display:none;animation: fadeIn .8s;}
    .page-section.active { display:block;}
    .page-header {margin-bottom:2.1rem;}
    .page-title {font-size:2.0rem;font-weight:700;margin-bottom:.41rem;}
    .page-subtitle {color:var(--text-secondary);}
    .stats-grid {display:grid;grid-template-columns:repeat(auto-fit,minmax(210px,1fr));gap:1.4rem;margin-bottom:2.6rem;}
    .stat-card {background:var(--card-bg);padding:1.1rem 1.2rem;border-radius:13px;border:1px solid var(--accent-color);box-shadow:var(--shadow);transition:.19s;}
    .stat-header {display:flex;align-items:center;margin-bottom:.72rem;}
    .stat-icon {width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:1.42rem;color:#fff;}
    .stat-icon.primary {background:var(--primary-color);}
    .stat-icon.success {background:var(--secondary-color);}
    .stat-icon.warning {background:var(--accent-color);}
    .stat-icon.danger {background:var(--danger-color);}
    .stat-value {font-size:2.2rem;font-weight:800;margin-bottom:.23rem;}
    .stat-label {color:var(--text-secondary);font-size:.91rem;}
    /* Responsive */
    @media (max-width: 900px){
      .main-container{flex-direction:column;}
      .sidebar{width:100%; min-height:auto;}
      .header{padding:1rem;}
      .content{padding:1rem;}
      .stats-grid{grid-template-columns:1fr;}
      .features-grid{grid-template-columns:1fr;}
    }
  </style>
</head>
<body>
  <!-- LOGIN -->
  <div id="loginPage" class="login-container fade-in">
    <div class="login-card slide-up">
      <div class="logo-badge"><i class="fas fa-shield-alt"></i></div>
      <h1 class="login-title">UOPI Dashboard</h1>
      <p class="login-subtitle">Accesso Unit√† Operative Polizia Italiana</p>
      <div id="errorMessage" class="error-message"></div>
      <button id="discordLoginBtn" class="discord-login-btn">
        <i class="fab fa-discord"></i>
        Accedi con Discord
      </button>
      <div class="features-grid">
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-users"></i></div><span class="feature-title">Personale</span><div class="feature-desc">Turni e ruoli</div></div>
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-radio"></i></div><span class="feature-title">Operativo</span><div class="feature-desc">Dispatch</div></div>
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-car"></i></div><span class="feature-title">Mezzi</span><div class="feature-desc">Flotta</div></div>
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-chart-bar"></i></div><span class="feature-title">Report</span><div class="feature-desc">Statistiche</div></div>
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-comments"></i></div><span class="feature-title">Messaggi</span><div class="feature-desc">Alert</div></div>
        <div class="feature-card"><div class="feature-icon"><i class="fas fa-archive"></i></div><span class="feature-title">Archivio</span><div class="feature-desc">Documenti</div></div>
      </div>
    </div>
  </div>
  <!-- DASHBOARD -->
  <div id="dashboard" class="dashboard">
    <header class="header">
      <div class="header-left">
        <div class="header-logo"><i class="fas fa-shield-alt"></i></div>
        <h1 class="header-title">UOPI Dashboard</h1>
      </div>
      <div class="header-right">
        <div class="user-info">
          <div class="user-avatar" id="userAvatar">U</div>
          <span id="userName">Ospite</span>
        </div>
        <button class="logout-btn" id="logoutBtn"><i class="fas fa-sign-out-alt"></i></button>
      </div>
    </header>
    <div class="main-container">
      <nav class="sidebar">
        <button class="nav-item active" data-page="dashboard"><i class="fas fa-tachometer-alt nav-icon"></i><span>Dashboard</span></button>
        <button class="nav-item" data-page="personnel"><i class="fas fa-users nav-icon"></i><span>Personale</span></button>
        <button class="nav-item" data-page="operations"><i class="fas fa-radio nav-icon"></i><span>Operazioni</span></button>
        <button class="nav-item" data-page="vehicles"><i class="fas fa-car nav-icon"></i><span>Mezzi</span></button>
        <button class="nav-item" data-page="reports"><i class="fas fa-chart-bar nav-icon"></i><span>Report</span></button>
      </nav>
      <main class="content">
        <!-- Dashboard principale -->
        <div id="page-dashboard" class="page-section active">
          <div class="page-header">
            <h2 class="page-title">Panoramica Operativa</h2>
            <p class="page-subtitle">Stato generale delle operazioni in tempo reale</p>
          </div>
          <div class="stats-grid">
            <div class="stat-card"><div class="stat-header"><div class="stat-icon primary"><i class="fas fa-users"></i></div></div><div class="stat-value" id="statPersonnel">--</div><div class="stat-label">Personale Totale</div></div>
            <div class="stat-card"><div class="stat-header"><div class="stat-icon success"><i class="fas fa-check-circle"></i></div></div><div class="stat-value" id="statActive">--</div><div class="stat-label">In Servizio</div></div>
            <div class="stat-card"><div class="stat-header"><div class="stat-icon warning"><i class="fas fa-car"></i></div></div><div class="stat-value" id="statVehicles">--</div><div class="stat-label">Mezzi Disponibili</div></div>
            <div class="stat-card"><div class="stat-header"><div class="stat-icon danger"><i class="fas fa-exclamation-triangle"></i></div></div><div class="stat-value" id="statAlerts">--</div><div class="stat-label">Allerte Attive</div></div>
          </div>
        </div>
        <!-- Personale -->
        <div id="page-personnel" class="page-section">
          <div class="page-header">
            <h2 class="page-title">Gestione Personale</h2><p class="page-subtitle">Anagrafica, turni e qualifiche.</p>
          </div>
          <div>Ci saranno funzioni per la gestione e la visualizzazione delle unit√†, turni e ruoli.</div>
        </div>
        <!-- Operazioni -->
        <div id="page-operations" class="page-section">
          <div class="page-header">
            <h2 class="page-title">Coordinamento Operativo</h2><p class="page-subtitle">Gestione operazioni e dispatch.</p>
          </div>
          <div>Sezione in sviluppo!</div>
        </div>
        <!-- Mezzi -->
        <div id="page-vehicles" class="page-section">
          <div class="page-header">
            <h2 class="page-title">Gestione Mezzi</h2><p class="page-subtitle">Inventario flotta e manutenzione.</p>
          </div>
          <div>Visualizzerai la flotta e lo stato dei mezzi qui.</div>
        </div>
        <!-- Reports -->
        <div id="page-reports" class="page-section">
          <div class="page-header">
            <h2 class="page-title">Report & Analytics</h2><p class="page-subtitle">Statistiche operative.</p>
          </div>
          <div>Reportistica personalizzata e statistiche avanzate.</div>
        </div>
      </main>
    </div>
  </div>
  <script>
    // OAuth2 setup
    const CLIENT_ID = '1387801645743869982';
    const REDIRECT_URI = window.location.origin + window.location.pathname;
    const SCOPES = 'identify';

    const loginPage = document.getElementById('loginPage');
    const dashboard = document.getElementById('dashboard');
    const discordLoginBtn = document.getElementById('discordLoginBtn');
    const logoutBtn = document.getElementById('logoutBtn');
    const errorMessage = document.getElementById('errorMessage');
    const navItems = document.querySelectorAll('.nav-item');
    const pageSection = document.querySelectorAll('.page-section');
    const userName = document.getElementById('userName');
    const userAvatar = document.getElementById('userAvatar');

    // Statistiche demo animate
    function animateStat(id, val){
      let el = document.getElementById(id);
      let n = 0, step = Math.ceil(val/34);
      let interval = setInterval(()=>{ n += step; el.textContent = n >= val ? val : n; if(n>=val) clearInterval(interval)}, 18);
      el.textContent = '0';
    }
    function loadStats(){
      animateStat('statPersonnel', 43); animateStat('statActive', 16);
      animateStat('statVehicles', 7); animateStat('statAlerts', 4);
    }
    // DASHBOARD NAV
    navItems.forEach(item => {
      item.addEventListener('click', function() {
        navItems.forEach(i=>i.classList.remove('active'));
        pageSection.forEach(s=>s.classList.remove('active'));
        this.classList.add('active');
        let pg = document.getElementById('page-' + this.getAttribute('data-page'));
        if(pg) pg.classList.add('active');
      });
    });

    function showError(msg){
      errorMessage.textContent = msg;
      errorMessage.classList.add('show');
      setTimeout(()=>errorMessage.classList.remove('show'), 3400);
    }
    // LOGOUT
    logoutBtn.onclick = function(){
      dashboard.classList.remove('active');
      loginPage.style.display = 'flex';
      window.history.replaceState({}, document.title, window.location.pathname);
      userName.textContent = 'Ospite';
      userAvatar.textContent = 'U';
      userAvatar.style.backgroundImage = 'none';
    };

    // LOGIN
    discordLoginBtn.onclick = function(){
      // REDIRECT OAuth2
      const OAUTH_URL =
        `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}` +
        `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}` +
        `&response_type=token` +
        `&scope=${encodeURIComponent(SCOPES)}`;
      window.location.href = OAUTH_URL;
    };

    function handleDiscordToken(token){
      // Ottieni info utente da Discord
      fetch('https://discord.com/api/users/@me', { headers: { Authorization: `Bearer ${token}` } })
      .then(r=>r.json())
      .then(user=>{
        if(!user.id){ showError('Autorizzazione Discord fallita'); return; }
        loginPage.style.display = 'none'; dashboard.classList.add('active');
        userName.textContent = user.username;
        userAvatar.textContent = '';
        userAvatar.style.backgroundImage = `url(https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png)`;
        userAvatar.style.backgroundSize = 'cover';
        loadStats();
      })
      .catch(()=>showError('Errore comunicazione API Discord'));
    }

    // BOTTA E RISPOSTA OAUTH2 "Token Implicit Grant"
    window.addEventListener('load', ()=>{
      let hash=window.location.hash, token=null;
      if(hash && hash.includes('access_token=')){
        token = new URLSearchParams(hash.substr(1)).get('access_token');
        if(token){ handleDiscordToken(token); }
      }
    });

    // Demo stats al primo accesso
    window.addEventListener('DOMContentLoaded', ()=>{
      loadStats();
    });
  </script>
</body>
</html>
