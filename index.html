<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="theme-color" content="#3b82f6">
    <title>U.O.P.I. - IPRP 8.0</title>
    <link rel="icon" type="image/png" href="https://i.imgur.com/B6E4u1X.png">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* ========== DESIGN SYSTEM PROFESSIONALE ========== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            overflow-x: hidden;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --accent: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg-app: #0a0e1a;
            --bg-card: rgba(30, 41, 59, 0.6);
            --text-primary: #ffffff;
            --text-secondary: #e2e8f0;
            --text-muted: #94a3b8;
            --border: rgba(255, 255, 255, 0.12);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-accent: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --shadow-glow: 0 0 30px rgba(59, 130, 246, 0.3);
            --shadow-card: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        /* Innovative Neo theme (sleek, high-contrast, reduced noise) */
        :root[data-theme="neo"] {
            --primary: #7c3aed;
            --primary-dark: #5b21b6;
            --accent: #06b6d4;
            --danger: #fb7185;
            --warning: #f97316;
            --bg-app: #0b0f14;
            --bg-card: rgba(13, 17, 23, 0.65);
            --text-primary: #e5e7eb;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border: rgba(148, 163, 184, 0.14);
            --gradient-primary: linear-gradient(135deg, #7c3aed 0%, #06b6d4 100%);
            --gradient-accent: linear-gradient(135deg, #22d3ee 0%, #7c3aed 100%);
            --gradient-success: linear-gradient(135deg, #10b981 0%, #22d3ee 100%);
            --shadow-glow: 0 0 40px rgba(124, 58, 237, 0.35);
            --shadow-card: 0 24px 48px rgba(0, 0, 0, 0.5);
        }

        /* FDO database-style theme: flat, squared, data-grid aesthetics */
        :root[data-theme="fdo"] {
            --primary: #1f6feb;          /* Azure (GitHub blue-ish) */
            --primary-dark: #1158c7;
            --accent: #2ea043;          /* Success green */
            --danger: #f85149;          /* Alert red */
            --warning: #d29922;         /* Amber */
            --bg-app: #0d1117;          /* Dark slate */
            --bg-card: #0f141b;         /* Slightly lighter */
            --text-primary: #c9d1d9;
            --text-secondary: #adbac7;
            --text-muted: #8b949e;
            --border: rgba(110, 118, 129, 0.4);
            --gradient-primary: linear-gradient(180deg, #0f141b 0%, #0f141b 100%); /* flat */
            --gradient-accent: linear-gradient(180deg, #0f141b 0%, #0f141b 100%);
            --gradient-success: linear-gradient(180deg, #0f141b 0%, #0f141b 100%);
            --shadow-glow: 0 0 0 rgba(0,0,0,0); /* remove glow */
            --shadow-card: 0 1px 0 rgba(255,255,255,0.02), 0 8px 24px rgba(0,0,0,0.35);
        }

        /* FDO visuals: subtle grid background and squared components */
        [data-theme="fdo"] body,
        body[data-theme="fdo"] { /* fallback if applied on body */
            background: radial-gradient(rgba(255,255,255,0.02) 1px, transparent 1px) 0 0 / 16px 16px,
                        linear-gradient(180deg, #0d1117, #0d1117);
        }

        [data-theme="fdo"] .header {
            background: var(--bg-card);
            border-bottom: 1px solid var(--border);
            box-shadow: none;
            border-radius: 0;
        }

        [data-theme="fdo"] .logo { box-shadow: none; border-radius: 0.25rem; }
        [data-theme="fdo"] .brand h1 { letter-spacing: 0.02em; font-weight: 700; }
        [data-theme="fdo"] .brand p { color: var(--text-muted); font-weight: 500; }

        [data-theme="fdo"] .nav {
            background: transparent;
            padding: 0;
            gap: 0.5rem;
        }

        [data-theme="fdo"] .nav-btn {
            background: var(--bg-card);
            color: var(--text-secondary);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            box-shadow: none;
        }
        [data-theme="fdo"] .nav-btn.active,
        [data-theme="fdo"] .nav-btn:hover {
            background: #0b1320;
            color: var(--text-primary);
            border-color: rgba(31,111,235,0.55);
        }

        [data-theme="fdo"] .user-profile {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 0.375rem;
            box-shadow: none;
        }

        /* Generic data-card look for content panels */
        [data-theme="fdo"] .content *[class*="card"],
        [data-theme="fdo"] .content *[class*="section"],
        [data-theme="fdo"] .content *[class*="panel"] {
            background: var(--bg-card) !important;
            border: 1px solid var(--border) !important;
            border-radius: 0.375rem !important;
            box-shadow: none !important;
        }

        /* Data list rows */
        [data-theme="fdo"] .content *[class*="row"],
        [data-theme="fdo"] .content *[class*="item"],
        [data-theme="fdo"] .content *[class*="entry"] {
            border: 1px solid rgba(110,118,129,0.25);
            background: #0c1118;
        }

        /* Chips/pill look becomes tag-like */
        [data-theme="fdo"] .badge, [data-theme="fdo"] .chip, [data-theme="fdo"] .tag {
            background: #0b1320 !important;
            color: var(--text-secondary) !important;
            border: 1px solid rgba(31,111,235,0.35) !important;
            box-shadow: none !important;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            background-attachment: fixed;
            color: var(--text-primary);
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            overflow-x: hidden;
                /* Mobile optimizations */
                -webkit-text-size-adjust: 100%;
                -webkit-tap-highlight-color: transparent;
                touch-action: manipulation;
            }

            /* Disable image dragging and right-click */
            img {
                -webkit-user-drag: none;
                -khtml-user-drag: none;
                -moz-user-drag: none;
                -o-user-drag: none;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
                pointer-events: none;
        }

        /* Animated background particles */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            animation: backgroundShift 20s ease-in-out infinite;
            pointer-events: none;
            z-index: -1;
        }
        @keyframes backgroundShift {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        /* ========== HEADER ========== */
        .header {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(24px);
            border-bottom: 1px solid var(--border);
            padding: 0.25rem 0.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: slideDown 0.8s cubic-bezier(0.4, 0, 0.2, 1);
            /* Mobile optimizations */
            min-height: 40px;
            flex-wrap: wrap;
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .emblems-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .left-emblem {
            display: flex;
            align-items: center;
        }

        .emblem-circle {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            background: #1e3a8a;
            border: 3px solid #fbbf24;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .italian-flag-top {
            position: absolute;
            top: -2px;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #22c55e 0%, #22c55e 33%, #ffffff 33%, #ffffff 66%, #ef4444 66%, #ef4444 100%);
            border-radius: 50% 50% 0 0;
        }

        .rifle-icon {
            font-size: 1rem;
            color: #fbbf24;
            margin-bottom: 2px;
        }

        .emblem-text {
            font-size: 0.5rem;
            color: white;
            font-weight: bold;
        }

        .right-emblem {
            display: flex;
            align-items: center;
        }

        .shield-emblem {
            width: 2.5rem;
            height: 3rem;
            background: #ef4444;
            border: 3px solid #fbbf24;
            border-radius: 0.5rem;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .shield-flag {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(135deg, #22c55e 0%, #22c55e 33%, #ffffff 33%, #ffffff 66%, #ef4444 66%, #ef4444 100%);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .shield-text {
            font-size: 0.5rem;
            color: #fbbf24;
            font-weight: bold;
            z-index: 1;
        }

        .brand-text {
            display: flex;
            flex-direction: column;
        }

        .logo-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-glow);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: logoFloat 3s ease-in-out infinite;
        }

        .logo:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 0 40px rgba(59, 130, 246, 0.6);
        }

        .logo-right {
            margin-left: auto;
            margin-right: 0;
        }

        @keyframes logoFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-5px); }
        }
        .brand h1 {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.125rem;
        }

        .brand p {
            font-size: 1rem;
            color: var(--text-muted);
            font-weight: 600;
        }

        .nav {
            display: flex;
            gap: 0.25rem;
            background: rgba(255, 255, 255, 0.08);
            padding: 0.25rem;
            border-radius: 0.75rem;
        }

        /* Theme toggle removed */

        /* Database look only inside personnel page container */
        .personnel-db .hierarchical-section {
            position: relative;
            margin: 2.5rem 0;
            border-radius: 18px;
            background: linear-gradient(160deg, rgba(11,18,30,0.96) 0%, rgba(6,11,20,0.94) 100%);
            border: 1px solid rgba(148,163,184,0.14);
            box-shadow: 0 32px 60px -30px rgba(10, 20, 40, 0.7);
            overflow: hidden;
        }

        .personnel-db .hierarchical-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(59,130,246,0.9), transparent);
            opacity: 0.7;
        }

        .personnel-db .hierarchical-section.dirigenziale::before {
            background: linear-gradient(90deg, transparent, rgba(248,113,113,0.9), transparent);
        }
        .personnel-db .hierarchical-section.amministrativo::before {
            background: linear-gradient(90deg, transparent, rgba(52,211,153,0.9), transparent);
        }
        .personnel-db .hierarchical-section.operativo::before {
            background: linear-gradient(90deg, transparent, rgba(96,165,250,0.9), transparent);
        }

        .personnel-db .hierarchy-head {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 2rem;
            padding: 1.75rem 2rem 1.5rem;
            background: linear-gradient(135deg, rgba(17, 24, 39, 0.9), rgba(10, 15, 28, 0.92));
            border-bottom: 1px solid rgba(148,163,184,0.12);
        }

        .personnel-db .hierarchy-head .head-left {
            display: flex;
            gap: 1.25rem;
            align-items: center;
        }

        .personnel-db .hierarchical-icon {
            width: 3.25rem;
            height: 3.25rem;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.35rem;
            position: relative;
            border: 1px solid rgba(148,163,184,0.18);
            background: radial-gradient(circle at 40% 35%, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0) 60%), rgba(15, 23, 42, 0.85);
            color: #cbd5f5;
        }

        .personnel-db .hierarchical-icon.dirigenziale { color: #fca5a5; border-color: rgba(248,113,113,0.45); box-shadow: 0 0 26px rgba(248,113,113,0.32); }
        .personnel-db .hierarchical-icon.amministrativo { color: #6ee7b7; border-color: rgba(52,211,153,0.5); box-shadow: 0 0 26px rgba(45,212,191,0.32); }
        .personnel-db .hierarchical-icon.operativo { color: #93c5fd; border-color: rgba(96,165,250,0.45); box-shadow: 0 0 26px rgba(96,165,250,0.3); }
        .personnel-db .hierarchical-icon::after { display: none; }

        .personnel-db .hierarchy-head h2 {
            font-size: 1.75rem;
            font-weight: 800;
            margin-bottom: 0.35rem;
        }

        .personnel-db .hierarchy-head p {
            color: #a8b0c3;
            max-width: 520px;
            font-size: 0.95rem;
            line-height: 1.55;
        }

        .personnel-db .hierarchy-head .head-metrics {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
            justify-content: flex-end;
        }

        .personnel-db .head-metric {
            min-width: 110px;
            padding: 0.65rem 0.85rem;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.72);
            border: 1px solid rgba(148,163,184,0.16);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
            position: relative;
        }
        .personnel-db .head-metric .metric-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            background: rgba(94, 234, 212, 0.12);
            color: #67e8f9;
        }
        .personnel-db .head-metric:nth-child(2) .metric-icon {
            background: rgba(34, 197, 94, 0.16);
            color: #86efac;
        }
        .personnel-db .head-metric:nth-child(3) .metric-icon {
            background: rgba(250, 204, 21, 0.16);
            color: #fde68a;
        }

        .personnel-db .head-metric .metric-value {
            font-size: 1.4rem;
            font-weight: 700;
        }
        .personnel-db .head-metric {
            min-width: 110px;
            padding: 0.65rem 0.85rem;
            border-radius: 12px;
            background: rgba(15, 23, 42, 0.72);
            border: 1px solid rgba(148,163,184,0.16);
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            gap: 0.25rem;
            position: relative;
        }

        .personnel-db .head-metric .metric-icon {
            width: 28px;
            height: 28px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            background: rgba(94, 234, 212, 0.12);
            color: #67e8f9;
        }

        .personnel-db .head-metric .metric-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .personnel-db .head-metric .metric-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: #94a3b8;
        }

        .personnel-db .hierarchy-body {
            padding: 1.5rem 2rem 2rem;
        }

        .personnel-db .operator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1rem;
        }

        .personnel-db .operator-card {
            display: grid;
            grid-template-columns: 56px 1fr;
            grid-template-rows: auto auto;
            column-gap: 1rem;
            row-gap: 0.6rem;
            padding: 1.1rem 1.2rem;
            background: linear-gradient(120deg, rgba(15, 23, 42, 0.72), rgba(11, 18, 30, 0.78));
            border: 1px solid rgba(148,163,184,0.14);
            border-radius: 14px;
            align-items: center;
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .personnel-db .operator-card:hover {
            transform: translateY(-2px);
            border-color: rgba(148,163,184,0.28);
            box-shadow: 0 20px 36px -24px rgba(15,23,42,0.6);
        }

        .personnel-db .operator-avatar-img {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            border: 1px solid rgba(148,163,184,0.18);
            object-fit: cover;
            background: rgba(12,18,28,0.8);
        }

        .personnel-db .operator-main {
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
            min-width: 0;
        }
        .personnel-db .operator-name {
            font-size: 1.05rem;
            font-weight: 700;
            color: #f8fafc;
        }

        .personnel-db .operator-meta {
            font-size: 0.82rem;
            color: #94a3b8;
            letter-spacing: 0.01em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .personnel-db .operator-tags {
            display: flex;
            gap: 0.4rem;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-start;
            grid-column: 1 / -1;
        }

        .personnel-db .role-chip,
        .personnel-db .status-chip,
        .personnel-db .matricola-chip {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.35rem 0.7rem;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            border: 1px solid rgba(148,163,184,0.14);
            background: rgba(12,19,32,0.85);
            letter-spacing: 0.02em;
        }

        .personnel-db .role-chip.dirigenziale { color: #fca5a5; border-color: rgba(248,113,113,0.35); background: rgba(248,113,113,0.12); }
        .personnel-db .role-chip.amministrativo { color: #6ee7b7; border-color: rgba(52,211,153,0.4); background: rgba(45,212,191,0.14); }
        .personnel-db .role-chip.operativo { color: #93c5fd; border-color: rgba(96,165,250,0.35); background: rgba(96,165,250,0.12); }

        .personnel-db .status-chip.available { color: #86efac; border-color: rgba(34,197,94,0.4); background: rgba(34,197,94,0.14); }
        .personnel-db .status-chip.busy { color: #fcd34d; border-color: rgba(234,179,8,0.35); background: rgba(234,179,8,0.14); }

        .personnel-db .matricola-chip {
            font-family: 'IBM Plex Mono', 'Fira Code', monospace;
            color: #a5b4fc;
            border-color: rgba(129,140,248,0.35);
            background: rgba(79,70,229,0.12);
        }

        @media (max-width: 1024px) {
             .personnel-db .hierarchy-head {
                 flex-direction: column;
                 align-items: flex-start;
             }
             .personnel-db .hierarchy-head .head-metrics {
                 width: 100%;
                 justify-content: flex-start;
             }
             .personnel-db .operator-card {
                 grid-template-columns: 52px 1fr;
             }
         }

         @media (max-width: 640px) {
             .personnel-db .hierarchy-body { padding: 1.25rem; }
             .personnel-db .operator-card {
                 grid-template-columns: 48px 1fr;
             }
             .personnel-db .operator-tags {
                 width: 100%;
                 gap: 0.5rem;
             }
         }

        /* Personnel hero and overview */
        .personnel-db .personnel-hero {
            position: relative;
            display: flex;
            flex-wrap: wrap;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1.5rem;
            padding: 2rem 2.25rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, rgba(13, 19, 33, 0.92), rgba(4, 9, 20, 0.9));
            border: 1px solid rgba(148,163,184,0.18);
            border-radius: 20px;
            overflow: hidden;
        }
        .personnel-db .personnel-hero::after {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 18% -10%, rgba(59,130,246,0.24), transparent 55%),
                        radial-gradient(circle at 82% 120%, rgba(16,185,129,0.25), transparent 60%);
            pointer-events: none;
        }
        .personnel-db .hero-body {
            position: relative;
            z-index: 1;
            max-width: 560px;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .personnel-db .hero-title {
            font-size: 2.4rem;
            font-weight: 800;
            letter-spacing: -0.02em;
        }
        .personnel-db .hero-subtitle {
            color: #94a3b8;
            font-size: 1rem;
            line-height: 1.6;
        }
        .personnel-db .hero-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.55rem 0.9rem;
            border-radius: 999px;
            background: rgba(59,130,246,0.18);
            color: #bfdbfe;
            font-weight: 700;
            font-size: 0.8rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
        }
        .personnel-db .hero-chip.alt {
            background: rgba(236,72,153,0.18);
            color: #fbcfe8;
        }
        .personnel-db .hero-actions {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-end;
        }
        .personnel-db .hero-actions .actions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: flex-end;
        }
        .personnel-db .hero-actions .btn {
            box-shadow: 0 12px 28px -18px rgba(59,130,246,0.7);
        }

        .personnel-db .personnel-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .personnel-db .stat-card {
            position: relative;
            padding: 1.25rem 1.4rem;
            border-radius: 16px;
            border: 1px solid rgba(148,163,184,0.16);
            background: linear-gradient(150deg, rgba(13,23,43,0.85), rgba(13,23,43,0.65));
            display: flex;
            flex-direction: column;
            gap: 0.35rem;
        }
        .personnel-db .stat-card.primary { border-color: rgba(59,130,246,0.4); background: linear-gradient(150deg, rgba(29,78,216,0.32), rgba(13,23,43,0.76)); }
        .personnel-db .stat-card.success { border-color: rgba(16,185,129,0.35); background: linear-gradient(150deg, rgba(5,150,105,0.28), rgba(13,23,43,0.76)); }
        .personnel-db .stat-card.rose { border-color: rgba(236,72,153,0.35); background: linear-gradient(150deg, rgba(190,24,93,0.28), rgba(13,23,43,0.75)); }
        .personnel-db .stat-card.teal { border-color: rgba(45,212,191,0.32); background: linear-gradient(150deg, rgba(17,94,89,0.28), rgba(13,23,43,0.74)); }
        .personnel-db .stat-card.blue { border-color: rgba(59,130,246,0.3); background: linear-gradient(150deg, rgba(37,99,235,0.28), rgba(13,23,43,0.75)); }
        .personnel-db .stat-label {
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.08em;
            color: rgba(226,232,240,0.7);
        }
        .personnel-db .stat-value {
            font-size: 2.1rem;
            font-weight: 800;
            color: #f8fafc;
        }
        .personnel-db .stat-foot {
            font-size: 0.82rem;
            color: #94a3b8;
        }

        .personnel-db .personnel-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.85rem;
            align-items: center;
            padding: 1rem 1.25rem;
            margin: 1.75rem 0;
            background: rgba(11,18,30,0.82);
            border: 1px solid rgba(148,163,184,0.16);
            border-radius: 14px;
            box-shadow: inset 0 0 0 1px rgba(15,23,42,0.22);
        }
        .personnel-db .personnel-filters {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .personnel-db .filter-pill {
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(148,163,184,0.2);
            color: #cbd5f5;
            border-radius: 999px;
            padding: 0.45rem 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .personnel-db .filter-pill:hover {
            border-color: rgba(59,130,246,0.45);
            color: #93c5fd;
        }
        .personnel-db .filter-pill.active {
            color: #fff;
            border-color: rgba(59,130,246,0.55);
            background: rgba(59,130,246,0.22);
        }
        .personnel-db .filter-pill[data-role="dirigenziale"].active { background: rgba(248,113,113,0.22); border-color: rgba(248,113,113,0.45); }
        .personnel-db .filter-pill[data-role="amministrativo"].active { background: rgba(16,185,129,0.22); border-color: rgba(16,185,129,0.45); }
        .personnel-db .filter-pill[data-role="operativo"].active { background: rgba(96,165,250,0.22); border-color: rgba(96,165,250,0.45); }
        .personnel-db .personnel-search {
            position: relative;
            flex: 1 1 220px;
            min-width: 220px;
        }
        .personnel-db .personnel-search input {
            width: 100%;
            background: rgba(13,23,43,0.9);
            border: 1px solid rgba(148,163,184,0.22);
            border-radius: 0.6rem;
            padding: 0.7rem 0.85rem;
            color: var(--text-primary);
        }
        .personnel-db .personnel-quick {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-left: auto;
        }
        .personnel-db .quick-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            padding: 0.55rem 0.85rem;
            border-radius: 0.7rem;
            border: 1px solid rgba(148,163,184,0.22);
            background: rgba(13,23,43,0.72);
            color: #cbd5f5;
            font-weight: 600;
            font-size: 0.82rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .personnel-db .quick-btn:hover {
            border-color: rgba(59,130,246,0.45);
            color: #93c5fd;
            transform: translateY(-1px);
        }
        .personnel-db .quick-btn i {
            font-size: 0.85rem;
        }

        .personnel-db .access-card {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            align-items: center;
            padding: 1rem 1.25rem;
            border-radius: 14px;
            border: 1px solid rgba(245,158,11,0.3);
            background: rgba(245,158,11,0.08);
        }
        .personnel-db .access-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            background: rgba(245,158,11,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #f59e0b;
            font-size: 1.2rem;
        }
        .personnel-db .access-copy h3 {
            margin: 0 0 0.25rem;
            color: #fbbf24;
            font-size: 1.05rem;
        }
        .personnel-db .access-copy p {
            margin: 0;
            color: #facc15;
            font-size: 0.85rem;
            opacity: 0.85;
        }
        @media (max-width: 768px) {
            .personnel-db .personnel-hero {
                padding: 1.75rem 1.5rem;
            }
            .personnel-db .personnel-overview {
                grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            }
            .personnel-db .hero-actions {
                align-items: flex-start;
            }
            .personnel-db .hero-actions .actions {
                justify-content: flex-start;
            }
            .personnel-db .personnel-quick {
                width: 100%;
                margin-left: 0;
                justify-content: flex-start;
            }
        }

        .nav-btn {
            padding: 0.75rem 1.25rem;
            background: transparent;
            border: none;
            border-radius: 0.75rem;
            color: var(--text-muted);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
                /* Mobile optimizations */
                min-height: 44px;
                min-width: 44px;
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }


        .nav-btn.active {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
            transform: translateY(-2px);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1rem;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 0.75rem;
            border: 1px solid rgba(139, 92, 246, 0.3);
            position: relative;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .discord-logo {
            width: 2.5rem;
            height: 2.5rem;
            background: #5865f2;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            background: linear-gradient(135deg, #5865f2, #4752c4);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.125rem;
            margin-right: 0.75rem;
        }

        .user-profile:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateY(-1px);
        }

        .user-avatar {
            width: 2rem;
            height: 2rem;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid rgba(59, 130, 246, 0.3);
        }
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            margin-top: 0.5rem;
            background: rgba(30, 41, 59, 0.95);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border);
            border-radius: 1rem;
            padding: 0.5rem;
            min-width: 200px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
        }

        .user-dropdown.active {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .dropdown-item:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .dropdown-item.logout {
            color: #ef4444;
        }

        .dropdown-item.logout:hover {
            background: rgba(239, 68, 68, 0.1);
        }

        /* Sistema Notifiche Migliorato */
        .notifications-container {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-width: 420px;
            pointer-events: none;
        }
        .notification {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.95));
            backdrop-filter: blur(32px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 1.25rem;
            padding: 1.5rem;
                box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 0 0 1px rgba(255, 255, 255, 0.05),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            opacity: 0;
            transform: translateX(500px) scale(0.8);
            transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
            overflow: hidden;
            pointer-events: auto;
            min-height: 80px;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0) scale(1);
        }

        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notification.show::before {
            opacity: 1;
        }

        .notification.success {
            border-left: 4px solid #10b981;
        }

        .notification.success::before {
            background: linear-gradient(90deg, transparent, #10b981, transparent);
        }

        .notification.error {
            border-left: 4px solid #ef4444;
        }

        .notification.error::before {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }

        .notification.info {
            border-left: 4px solid #3b82f6;
        }

        .notification.info::before {
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
        }

        .notification.warning {
            border-left: 4px solid #f59e0b;
        }

        .notification.warning::before {
            background: linear-gradient(90deg, transparent, #f59e0b, transparent);
        }

        .notification-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            gap: 1rem;
        }

        .notification-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
            position: relative;
            overflow: hidden;
        }

        .notification.success .notification-icon {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
            color: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.3);
        }

        .notification.error .notification-icon {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.3));
            color: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }

        .notification.info .notification-icon {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3));
            color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .notification.warning .notification-icon {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3));
            color: #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }

        .notification-content-wrapper {
            flex: 1;
            min-width: 0;
        }

        .notification-title {
            font-weight: 700;
            color: var(--text-primary);
            font-size: 1rem;
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .notification-content {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }
        .notification-time {
            color: var(--text-muted);
            font-size: 0.75rem;
            font-weight: 500;
            opacity: 0.8;
        }
        .notification-close {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .notification-close:hover {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: #ef4444;
            transform: scale(1.05);
        }

        .notification-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            border-radius: 0 0 1.25rem 1.25rem;
            transition: width linear;
        }

        .notification.success .notification-progress {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .notification.error .notification-progress {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .notification.info .notification-progress {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }
        .notification:hover {
            transform: translateX(-5px) scale(1.02);
                box-shadow: 
                0 30px 60px rgba(0, 0, 0, 0.6),
                0 0 0 1px rgba(255, 255, 255, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.15);
        }
        /* Scrollbar personalizzata */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.6), rgba(139, 92, 246, 0.6));
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.8), rgba(139, 92, 246, 0.8));
        }

        ::-webkit-scrollbar-corner {
            background: rgba(30, 41, 59, 0.3);
        }

        /* Scrollbar per Firefox */
        * {
            scrollbar-width: thin;
            scrollbar-color: rgba(59, 130, 246, 0.6) rgba(30, 41, 59, 0.3);
        }

        /* ========== DROPDOWN MENU ULTRA-MODERNO ========== */
        .custom-dropdown {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .dropdown-trigger {
            width: 100%;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 1rem;
            color: var(--text-primary);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 
                        0 0 0 1px rgba(255, 255, 255, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }

        .dropdown-trigger:hover {
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.2), 
                        0 0 0 1px rgba(59, 130, 246, 0.3),
                        inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
        }

        .dropdown-trigger:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15),
                        0 12px 40px rgba(59, 130, 246, 0.2);
        }

        .dropdown-trigger::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent, 
                rgba(59, 130, 246, 0.1), 
                rgba(16, 185, 129, 0.1), 
                transparent);
            transition: left 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dropdown-trigger:hover::before {
            left: 100%;
        }

        .dropdown-trigger::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.05) 0%, 
                transparent 50%, 
                rgba(16, 185, 129, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .dropdown-trigger:hover::after {
            opacity: 1;
        }

        .dropdown-text {
            flex: 1;
            text-align: left;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-weight: 500;
            letter-spacing: 0.025em;
        }

        .dropdown-arrow {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            color: #94a3b8;
            font-size: 1rem;
            margin-left: 0.75rem;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
        }

        .dropdown-trigger.open .dropdown-arrow {
            transform: rotate(180deg);
            color: #3b82f6;
        }
        .dropdown-menu {
            position: absolute;
            top: calc(100% + 0.75rem);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, 
                rgba(30, 41, 59, 0.95) 0%, 
                rgba(15, 23, 42, 0.98) 100%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), 
                        0 0 0 1px rgba(255, 255, 255, 0.1),
                        inset 0 1px 0 rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(24px);
            z-index: 1000;
            opacity: 0;
            transform: translateY(-15px) scale(0.9);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            max-height: 350px;
            overflow-y: auto;
            overflow-x: hidden;
        }

        .dropdown-menu.show {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: all;
        }

        .dropdown-menu::before {
            content: '';
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-bottom: 8px solid rgba(30, 41, 59, 0.95);
            filter: drop-shadow(0 -2px 4px rgba(0, 0, 0, 0.2));
        }

        .dropdown-item {
            padding: 1rem 1.25rem;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
            display: flex;
            align-items: center;
            gap: 1rem;
            position: relative;
            overflow: hidden;
            font-weight: 500;
        }

        .dropdown-item:last-child {
            border-bottom: none;
            border-radius: 0 0 1rem 1rem;
        }

        .dropdown-item:first-child {
            border-radius: 1rem 1rem 0 0;
        }

        .dropdown-item:hover {
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.15) 0%, 
                rgba(37, 99, 235, 0.1) 100%);
            color: #e2e8f0;
            transform: translateX(8px);
            box-shadow: inset 0 0 0 1px rgba(59, 130, 246, 0.2);
        }

        .dropdown-item.selected {
            background: linear-gradient(135deg, 
                rgba(16, 185, 129, 0.2) 0%, 
                rgba(5, 150, 105, 0.15) 100%);
            color: #10b981;
            font-weight: 600;
            box-shadow: inset 0 0 0 1px rgba(16, 185, 129, 0.3);
        }

        .dropdown-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            transform: scaleY(0);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border-radius: 0 2px 2px 0;
        }

        .dropdown-item:hover::before {
            transform: scaleY(1);
        }

        .dropdown-item.selected::before {
            transform: scaleY(1);
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .dropdown-item-icon {
            font-size: 1.5rem;
            min-width: 2rem;
            text-align: center;
            filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.4));
            transition: all 0.3s ease;
        }

        .dropdown-item:hover .dropdown-item-icon {
            transform: scale(1.1);
            filter: drop-shadow(0 4px 8px rgba(59, 130, 246, 0.3));
        }

        .dropdown-item.selected .dropdown-item-icon {
            filter: drop-shadow(0 3px 6px rgba(16, 185, 129, 0.4));
        }

        .dropdown-item-text {
            flex: 1;
            font-weight: 500;
            line-height: 1.5;
            letter-spacing: 0.025em;
        }
        .dropdown-item-qualification {
            font-size: 0.8125rem;
            color: #94a3b8;
            margin-top: 0.25rem;
            font-weight: 400;
            opacity: 0.9;
        }

        .dropdown-item:hover .dropdown-item-qualification {
            color: #cbd5e1;
        }

        .dropdown-item.selected .dropdown-item-qualification {
            color: rgba(16, 185, 129, 0.8);
        }

        /* Scrollbar Ultra-Moderno */
        .dropdown-menu::-webkit-scrollbar {
            width: 8px;
        }

        .dropdown-menu::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 4px;
            margin: 0.5rem 0;
        }

        .dropdown-menu::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 4px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dropdown-menu::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.4);
        }

        /* Focus e Stati Attivi Avanzati */
        .dropdown-trigger:focus-within {
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15),
                        0 20px 60px rgba(59, 130, 246, 0.2);
        }

        .dropdown-item:focus {
            outline: none;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.15));
            box-shadow: inset 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        /* Animazioni di Entrata per Oggetti */
        .dropdown-item {
            animation: slideInFromLeft 0.3s cubic-bezier(0.4, 0, 0.2, 1) both;
        }
        .dropdown-item:nth-child(1) { animation-delay: 0.05s; }
        .dropdown-item:nth-child(2) { animation-delay: 0.1s; }
        .dropdown-item:nth-child(3) { animation-delay: 0.15s; }
        .dropdown-item:nth-child(4) { animation-delay: 0.2s; }
        .dropdown-item:nth-child(5) { animation-delay: 0.25s; }
        .dropdown-item:nth-child(6) { animation-delay: 0.3s; }
        .dropdown-item:nth-child(7) { animation-delay: 0.35s; }
        .dropdown-item:nth-child(8) { animation-delay: 0.4s; }

        @keyframes slideInFromLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        /* Design Responsivo Avanzato */
        @media (max-width: 768px) {
            .dropdown-menu {
                max-height: 280px;
                border-radius: 0.875rem;
            }
            
            .dropdown-item {
                padding: 0.875rem 1rem;
                gap: 0.875rem;
            }
            
            .dropdown-item-text {
                font-size: 0.9375rem;
            }

            .dropdown-item-icon {
                font-size: 1.375rem;
                min-width: 1.75rem;
            }

            .dropdown-trigger {
                padding: 0.875rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .dropdown-menu {
                max-height: 250px;
            }
            
            .dropdown-item {
                padding: 0.75rem 0.875rem;
                gap: 0.75rem;
            }
            
            .dropdown-item-text {
                font-size: 0.875rem;
            }

            .dropdown-item-icon {
                font-size: 1.25rem;
                min-width: 1.5rem;
            }
        }

        /* ========== OVERLAY SVILUPPO SEMPLICE ========== */
        .development-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeInSimple 0.3s ease-out;
            border-radius: 1rem;
        }

        .development-banner {
            background: rgba(30, 41, 59, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(20px);
            animation: slideInSimple 0.4s ease-out;
            max-width: 400px;
        }

        .development-banner h2 {
            color: #f59e0b;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .development-banner p {
            color: #94a3b8;
            font-size: 1rem;
            margin: 0;
            opacity: 0.9;
        }

        .development-icon {
            font-size: 2rem;
            margin-bottom: 1rem;
            opacity: 0.8;
        }
        @keyframes fadeInSimple {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        @keyframes slideInSimple {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive per overlay semplice */
        @media (max-width: 768px) {
            .development-banner {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            .development-banner h2 {
                font-size: 1.25rem;
            }
            
            .development-banner p {
                font-size: 0.875rem;
            }
            
            .development-icon {
                font-size: 1.75rem;
            }
        }
        /* ========== MESSAGGIO SVILUPPO SEMPLICE ========== */
        .development-message {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 3rem 2rem;
            text-align: center;
            margin: 2rem 0;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            animation: fadeInMessage 0.6s ease-out;
        }
        .development-message .development-icon {
            font-size: 3rem;
            margin-bottom: 1.5rem;
            opacity: 0.8;
        }
        .development-message h3 {
            color: #f59e0b;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .development-message p {
            color: #94a3b8;
            font-size: 1.125rem;
            margin: 0;
            opacity: 0.9;
        }

        @keyframes fadeInMessage {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Responsive per messaggio */
        @media (max-width: 768px) {
            .development-message {
                padding: 2rem 1.5rem;
                margin: 1.5rem 0;
            }
            
            .development-message h3 {
                font-size: 1.5rem;
            }
            
            .development-message p {
                font-size: 1rem;
            }
            
            .development-message .development-icon {
                font-size: 2.5rem;
            }
        }

        /* Dropdown Styling Fix - Migliorato */
        select {
            background: #1e293b !important;
            background-color: #1e293b !important;
            color: #e2e8f0 !important;
            border: 1px solid #334155 !important;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23e2e8f0' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1rem;
            padding-right: 2.5rem !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
        }
        
        select option {
            background: #1e293b !important;
            background-color: #1e293b !important;
            color: #e2e8f0 !important;
            padding: 0.75rem !important;
            font-size: 1rem !important;
            font-weight: 500 !important;
            border: none !important;
        }
        
        select option:hover {
            background: #334155 !important;
            background-color: #334155 !important;
        }
        
        select option:checked {
            background: #3b82f6 !important;
            background-color: #3b82f6 !important;
            color: white !important;
        }
        
        select:focus {
            background: #1e293b !important;
            background-color: #1e293b !important;
            color: #e2e8f0 !important;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1) !important;
            outline: none !important;
        }
        
        select:hover {
            background: #334155 !important;
            background-color: #334155 !important;
            border-color: #475569 !important;
        }
        
        /* Forza il tema scuro per tutti i browser */
        select::-ms-expand {
            display: none;
        }
        
        /* Firefox specific */
        @-moz-document url-prefix() {
            select {
                background: #1e293b !important;
                background-color: #1e293b !important;
                color: #e2e8f0 !important;
            }
            
            select option {
                background: #1e293b !important;
                background-color: #1e293b !important;
                color: #e2e8f0 !important;
            }
        }

        /* Separazione Gerarchica Nuclei */
        .nuclei-separator {
            position: relative;
            margin: 1.5rem 0;
            padding: 1rem;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
            border-radius: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .nuclei-separator::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            border-radius: 1rem 1rem 0 0;
        }

        .nuclei-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
            font-weight: 700;
        }

        .nuclei-title.dirigenziale {
            color: #ef4444;
        }

        .nuclei-title.amministrativo {
            color: #10b981;
        }

        .nuclei-title.operativo {
            color: #3b82f6;
        }

        .nuclei-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .nuclei-icon.dirigenziale {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.3));
            color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .nuclei-icon.amministrativo {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
            color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .nuclei-icon.operativo {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3));
            color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.3);
        }

        .nuclei-description {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.5;
            margin-bottom: 0.5rem;
        }

        .nuclei-stats {
            display: flex;
            gap: 1rem;
            margin-top: 0.75rem;
        }
        .nuclei-stat {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            font-size: 0.8125rem;
            font-weight: 600;
        }

        .nuclei-stat.dirigenziale {
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .nuclei-stat.amministrativo {
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .nuclei-stat.operativo {
            color: #3b82f6;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        /* Divisione Gerarchica Avanzata */
        .hierarchical-section {
            margin: 2rem 0;
            position: relative;
        }

        .hierarchical-section::before {
            content: '';
            position: absolute;
            top: -1rem;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            opacity: 0.3;
        }
        .hierarchical-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem 2rem;
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border-radius: 1rem 1rem 0 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: none;
            position: relative;
            overflow: hidden;
        }

        .hierarchical-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
        }

        .hierarchical-title {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 1.5rem;
            font-weight: 800;
        }
        .hierarchical-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            position: relative;
        }

        .hierarchical-icon::after {
            content: '';
            position: absolute;
            inset: -2px;
            border-radius: 1rem;
            padding: 2px;
            background: linear-gradient(45deg, currentColor, transparent, currentColor);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0.3;
        }

        .hierarchical-icon.dirigenziale {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(220, 38, 38, 0.3));
            color: #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }

        .hierarchical-icon.amministrativo {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
            color: #10b981;
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4);
        }

        .hierarchical-icon.operativo {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3));
            color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }

        .hierarchical-stats {
            display: flex;
            gap: 1.5rem;
        }

        .hierarchical-stat {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.25rem;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 0.75rem;
            font-size: 0.9375rem;
            font-weight: 700;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hierarchical-stat.dirigenziale {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
        }

        .hierarchical-stat.amministrativo {
            color: #10b981;
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
        }
        .hierarchical-stat.operativo {
            color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }

.hierarchical-content {
    background: rgba(30, 41, 59, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-top: none;
    border-radius: 0 0 1rem 1rem;
    padding: 1rem 1.25rem; /* più respiro dai bordi */
    backdrop-filter: blur(24px);
}

        .hierarchical-description {
            padding: 1.5rem 2rem;
            color: var(--text-secondary);
            font-size: 1rem;
            line-height: 1.6;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-style: italic;
        }

        .hierarchical-table {
            background: transparent;
            border: none;
            border-radius: 0;
            margin: 0;
        }

        .hierarchical-table table {
            background: transparent;
        }

        .hierarchical-table th {
            background: rgba(255, 255, 255, 0.05);
            font-size: 0.875rem;
            padding: 1rem 1.5rem;
        }

        .hierarchical-table td {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .hierarchical-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

/* Personnel modern grid */
.personnel-toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
    padding: 1rem 1.25rem;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 0.75rem;
    margin: 1rem 0 1.5rem 0;
}

.personnel-search {
    flex: 1 1 220px;
    min-width: 220px;
}

.personnel-search input {
    width: 100%;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 0.5rem;
    padding: 0.625rem 0.75rem;
    color: var(--text-primary);
}
.personnel-filters {
    display: flex;
    gap: 0.5rem;
}

.filter-pill {
    background: rgba(255, 255, 255, 0.06);
    border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--text-secondary);
    border-radius: 999px;
    padding: 0.4rem 0.75rem;
    font-weight: 600;
    cursor: pointer;
    transition: background 0.2s ease, color 0.2s ease, border-color 0.2s ease;
}
.filter-pill.active { color: #fff; border-color: rgba(255,255,255,0.2); }
.filter-pill[data-role="dirigenziale"].active { background: rgba(239, 68, 68, 0.18); }
.filter-pill[data-role="amministrativo"].active { background: rgba(16, 185, 129, 0.18); }
.filter-pill[data-role="operativo"].active { background: rgba(59, 130, 246, 0.18); }

.operator-grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    gap: 1rem;
}

@media (max-width: 1024px) {
    .operator-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); }
}
@media (max-width: 640px) {
    .operator-grid { grid-template-columns: 1fr; }
}
.operator-card {
    display: flex;
    align-items: center;
    gap: 0.875rem;
    background: rgba(15, 23, 42, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 0.75rem;
    padding: 0.875rem 1rem; /* più spazio interno */
    transition: transform 0.2s ease, border-color 0.2s ease;
}

.operator-card:hover {
    transform: translateY(-2px);
    border-color: rgba(255, 255, 255, 0.14);
}
.operator-avatar-img {
    width: 42px;
    height: 42px;
    border-radius: 10px;
    object-fit: cover;
    display: block;
    background: rgba(255,255,255,0.04);
    border: 1px solid rgba(255,255,255,0.08);
}
.operator-info { flex: 1; min-width: 0; display: flex; flex-direction: column; justify-content: center; }
.operator-name { color: #fff; font-weight: 700; }
.operator-meta { color: var(--text-muted); font-size: 0.8125rem; }

.role-chip {
    padding: 0.25rem 0.6rem;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.75rem;
    border: 1px solid rgba(255,255,255,0.12);
}
.role-chip.dirigenziale { color: #ef4444; background: rgba(239,68,68,0.1); border-color: rgba(239,68,68,0.25); }
.role-chip.amministrativo { color: #10b981; background: rgba(16,185,129,0.1); border-color: rgba(16,185,129,0.25); }
.role-chip.operativo { color: #3b82f6; background: rgba(59,130,246,0.1); border-color: rgba(59,130,246,0.25); }

.status-chip {
    padding: 0.25rem 0.6rem;
    border-radius: 999px;
    font-weight: 700;
    font-size: 0.75rem;
}
.status-chip.available { color: #10b981; background: rgba(16,185,129,0.12); }
.status-chip.busy { color: #3b82f6; background: rgba(59,130,246,0.12); }

        /* Priorità Gerarchica */
        .hierarchical-section.dirigenziale {
            z-index: 3;
        }

        .hierarchical-section.amministrativo {
            z-index: 2;
        }

        .hierarchical-section.operativo {
            z-index: 1;
        }

        /* Animazioni Gerarchiche */
        .hierarchical-section {
            opacity: 0;
            transform: translateY(30px);
            animation: hierarchicalFadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        .hierarchical-section.dirigenziale {
            animation-delay: 0.1s;
        }

        .hierarchical-section.amministrativo {
            animation-delay: 0.3s;
        }

        .hierarchical-section.operativo {
            animation-delay: 0.5s;
        }

        @keyframes hierarchicalFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .avatar {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }
        /* ========== MAIN CONTENT ========== */
        .main {
            max-width: 1600px;
            margin: 0 auto;
            padding: 0.5rem 0.5rem;
        }

        .page-header {
            margin-bottom: 3rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.5rem;
        }

        .page-header p {
            color: var(--text-muted);
            font-size: 1.125rem;
        }

        .actions {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        /* ========== BUTTONS ========== */
        .btn {
            padding: 0.875rem 1.75rem;
            border: none;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.9375rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-primary::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-primary:hover::before {
            left: 100%;
        }
        .btn-primary:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-success {
            background: var(--gradient-success);
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            position: relative;
            overflow: hidden;
        }

        .btn-success::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-success:hover::before {
            left: 100%;
        }

        .btn-success:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 12px 30px rgba(16, 185, 129, 0.5);
        }

        /* ========== GRID ========== */
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        /* ========== CARDS ========== */
        .card {
            background: rgba(30, 41, 59, 0.6);
            backdrop-filter: blur(24px);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            opacity: 0;
            transform: translateY(30px);
            animation: cardFadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        .card:hover::before {
            transform: scaleX(1);
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-card);
            border-color: rgba(59, 130, 246, 0.4);
        }

        @keyframes cardFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.2s; }
        .card:nth-child(3) { animation-delay: 0.3s; }
        .card:nth-child(4) { animation-delay: 0.4s; }

        .stat-card {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .stat-icon {
            width: 4rem;
            height: 4rem;
            border-radius: 1rem;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            color: white;
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            animation: iconPulse 2s ease-in-out infinite;
        }

        .stat-icon:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.5);
        }
        @keyframes iconPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .stat-content h3 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            color: var(--text-muted);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }
        /* ========== TABLE ========== */
        .table-container {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--border);
            border-radius: 1.5rem;
            overflow: hidden;
            backdrop-filter: blur(24px);
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
            animation-delay: 0.3s;
            max-width: 100%;
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        table {
            width: 100%;
            min-width: 800px;
            border-collapse: collapse;
            table-layout: auto;
        }

        th, td {
            padding: 1.25rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(255, 255, 255, 0.05);
            font-weight: 700;
            color: var(--text-primary);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        tr {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: none;
        }
        /* Responsive table senza scrollbar */
        .hierarchical-table {
            width: 100%;
            overflow: hidden;
        }
        
        .hierarchical-table table {
            width: 100%;
            table-layout: fixed;
        }
        
        .hierarchical-table th,
        .hierarchical-table td {
            word-wrap: break-word;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* ========== PANORAMICA RIVOLUZIONARIA 2.0 ========== */
        
        /* Revolutionary Overview Container */
        .revolutionary-overview {
            padding: 0;
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
        }

        /* Hero Section V2 - Revolutionary */
        .hero-section-v2 {
            position: relative;
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 3rem 2rem;
            margin-bottom: 3rem;
            border-radius: 2rem;
            overflow: hidden;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.95), rgba(30, 41, 59, 0.9));
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(24px);
        }

        .hero-background {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .hero-particles {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            animation: particleFloat 20s ease-in-out infinite;
        }

        .hero-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: gridMove 30s linear infinite;
        }

        @keyframes particleFloat {
            0%, 100% { opacity: 0.3; transform: scale(1) rotate(0deg); }
            50% { opacity: 0.6; transform: scale(1.1) rotate(180deg); }
        }

        @keyframes gridMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }
        .hero-content-v2 {
            position: relative;
            z-index: 2;
            flex: 1;
            max-width: 600px;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
            border: 1px solid rgba(16, 185, 129, 0.4);
            border-radius: 2rem;
            margin-bottom: 1.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: #10b981;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .badge-icon {
            width: 1rem;
            height: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #10b981, #059669);
            border-radius: 50%;
            color: white;
            font-size: 0.5rem;
            animation: badgePulse 2s ease-in-out infinite;
        }
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .hero-title-v2 {
            margin: 0 0 1rem 0;
            line-height: 1.1;
        }
        .title-main {
            display: block;
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff, #e2e8f0, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.3);
        }
        .title-sub {
            display: block;
            font-size: 1.5rem;
            font-weight: 600;
            color: #3b82f6;
            text-transform: uppercase;
            letter-spacing: 0.2em;
        }
        .hero-description-v2 {
            font-size: 1.25rem;
            color: #94a3b8;
            margin-bottom: 2rem;
            line-height: 1.6;
            max-width: 500px;
        }
        .hero-stats-mini {
            display: flex;
            gap: 2rem;
        }
        .mini-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }
        .mini-stat:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.08);
        }
        .mini-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .mini-label {
            font-size: 0.75rem;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .hero-controls {
            position: relative;
            z-index: 2;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .control-btn {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 1rem;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            min-width: 150px;
        }

        .control-btn.primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .control-btn.primary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.6);
        }

        .control-btn.secondary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.4);
        }

        .control-btn.secondary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 20px 40px rgba(139, 92, 246, 0.6);
        }
        /* Stats Dashboard V2 */
        .stats-dashboard-v2 {
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
        }

        .dashboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .dashboard-header h2 {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0;
        }

        .time-selector {
            display: flex;
            gap: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            padding: 0.25rem;
        }

        .time-selector span {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .time-active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white !important;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .stats-grid-v2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .stat-card-v2 {
            position: relative;
            padding: 2rem;
            border-radius: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(24px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card-v2:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
        }

        .stat-background {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .stat-pattern {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.05) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(255, 255, 255, 0.03) 0%, transparent 50%);
            animation: patternFloat 15s ease-in-out infinite;
        }

        @keyframes patternFloat {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.1); }
        }

        .primary-gradient {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.3));
        }

        .success-gradient {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.3));
        }

        .warning-gradient {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.3));
        }

        .info-gradient {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.3));
        }

        .like-crystal {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(124, 58, 237, 0.4), rgba(59, 130, 246, 0.2));
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.2);
        }

        .stat-content-v2 {
            position: relative;
            z-index: 2;
        }

        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .stat-icon-v2 {
            width: 3rem;
            height: 3rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .primary-gradient .stat-icon-v2 {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .success-gradient .stat-icon-v2 {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .warning-gradient .stat-icon-v2 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .info-gradient .stat-icon-v2 {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .stat-trend {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
        }
        .stat-trend.positive {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .stat-trend.neutral {
            background: rgba(148, 163, 184, 0.2);
            color: #94a3b8;
            border: 1px solid rgba(148, 163, 184, 0.3);
        }

        .stat-value-v2 {
            font-size: 3.5rem;
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 0.5rem;
            line-height: 1;
            text-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
        }

        .stat-label-v2 {
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            margin-bottom: 1.5rem;
        }

        .stat-progress {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        .progress-bar-v2 {
            width: 100%;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .progress-fill-v2 {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 1s ease;
            background: linear-gradient(90deg, #3b82f6, #10b981);
        }

        .primary-gradient .progress-fill-v2 {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .success-gradient .progress-fill-v2 {
            background: linear-gradient(90deg, #10b981, #059669);
        }
        .warning-gradient .progress-fill-v2 {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        .info-gradient .progress-fill-v2 {
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
        }

        .progress-text {
            font-size: 0.75rem;
            color: #94a3b8;
            font-weight: 600;
        }
        /* Analytics Hub V2 */
        .analytics-hub {
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
        }

        .hub-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .hub-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .hub-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .hub-text h2 {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0 0 0.25rem 0;
        }

        .hub-text p {
            color: #94a3b8;
            font-size: 1rem;
            margin: 0;
        }

        .hub-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: #10b981;
        }

        .status-dot {
            width: 0.5rem;
            height: 0.5rem;
            border-radius: 50%;
            background: #10b981;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .status-dot.active {
            background: #10b981;
        }

        .status-dot.standby {
            background: #f59e0b;
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        .analytics-grid-v2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
        }

        .analytics-card-v2 {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            padding: 2rem;
            backdrop-filter: blur(24px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .analytics-card-v2:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.3);
        }

        .card-header-v2 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .card-header-v2 h3 {
            color: #ffffff;
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0;
        }
        .card-controls {
            display: flex;
            gap: 0.5rem;
        }

        .control-toggle {
            padding: 0.25rem 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            background: transparent;
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-toggle.active {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border-color: #3b82f6;
        }
        /* Matrix Grid */
        .matrix-grid {
            display: grid;
            gap: 1rem;
        }
        .matrix-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-radius: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .matrix-item.available {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.2));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .matrix-item.in-service {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.2));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .matrix-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .matrix-item.available .animation-icon {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .matrix-item.in-service .matrix-icon {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .matrix-content {
            flex: 1;
        }
        .matrix-value {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            line-height: 1;
            margin-bottom: 0.25rem;
        }

        .matrix-label {
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        .matrix-percentage {
            font-size: 0.75rem;
            color: #60a5fa;
            font-weight: 600;
        }

        .matrix-indicator {
            width: 0.5rem;
            height: 100%;
            border-radius: 0.25rem;
            position: absolute;
            right: 0;
            top: 0;
        }
        .matrix-item.available .matrix-indicator {
            background: linear-gradient(180deg, #10b981, #059669);
        }
        .matrix-item.in-service .matrix-indicator {
            background: linear-gradient(180deg, #3b82f6, #2563eb);
        }

        /* Team Chart */
        .team-chart {
            display: grid;
            gap: 1.5rem;
        }

        .team-item-v2 {
            padding: 1.5rem;
            border-radius: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .team-item-v2.alpha {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(124, 58, 237, 0.2));
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .team-item-v2.beta {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.2));
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .team-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .team-icon-v2 {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .team-item-v2.alpha .team-icon-v2 {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .team-item-v2.beta .team-icon-v2 {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .team-name {
            font-size: 1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
            display: block;
        }

        .team-count {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .team-metrics {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .metric {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-label {
            font-size: 0.75rem;
            color: #94a3b8;
            font-weight: 600;
        }
        .metric-value {
            font-size: 1rem;
            font-weight: 800;
            color: #ffffff;
        }

        .team-chart-bar {
            margin-top: 1rem;
        }
        .chart-bar {
            width: 100%;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 1s ease;
        }

        .bar-fill.alpha {
            background: linear-gradient(90deg, #8b5cf6, #7c3aed);
        }

        .bar-fill.beta {
            background: linear-gradient(90deg, #f59e0b, #d97706);
        }

        /* Command Hierarchy */
        .command-hierarchy {
            display: grid;
            gap: 1rem;
        }

        .hierarchy-level-v2 {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-radius: 1rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .hierarchy-level-v2.dirigenziale {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.2));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .hierarchy-level-v2.amministrativo {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.2));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .hierarchy-level-v2.operativo {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.2));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .level-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
        }

        .hierarchy-level-v2.dirigenziale .level-icon {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .hierarchy-level-v2.amministrativo .level-icon {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .hierarchy-level-v2.operativo .level-icon {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }

        .level-info {
            flex: 1;
            margin-left: 1rem;
        }

        .level-name {
            font-size: 1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
            display: block;
        }

        .level-count {
            font-size: 0.75rem;
            color: #94a3b8;
        }

        .level-status {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .status-bar {
            width: 4rem;
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.25rem;
            overflow: hidden;
        }

        .status-fill {
            height: 100%;
            border-radius: 0.25rem;
            transition: width 1s ease;
        }

        .status-fill.dirigenziale {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .status-fill.amministrativo {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .status-fill.operativo {
            background: linear-gradient(90deg, #3b82f6, #2563eb);
        }

        .status-percentage {
            font-size: 0.75rem;
            color: #60a5fa;
            font-weight: 600;
        }

        /* Role Hierarchy */
        .hierarchy-grid {
            display: grid;
            gap: 1rem;
        }

        .hierarchy-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border-radius: 1rem;
            transition: all 0.3s ease;
        }
        .hierarchy-item.dirigenziale {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .hierarchy-item.amministrativo {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .hierarchy-item.operativo {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .hierarchy-level {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .hierarchy-item.dirigenziale .hierarchy-level i {
            color: #ef4444;
        }

        .hierarchy-item.amministrativo .hierarchy-level i {
            color: #10b981;
        }

        .hierarchy-item.operativo .hierarchy-level i {
            color: #3b82f6;
        }
        .hierarchy-level span {
            color: #ffffff;
            font-weight: 600;
        }
        .hierarchy-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: #ffffff;
        }
        /* Empty State V2 */
        .empty-state-v2 {
            text-align: center;
            padding: 4rem 2rem;
            position: relative;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
            overflow: hidden;
            margin-bottom: 3rem;
        }

        .empty-background {
            position: absolute;
            inset: 0;
            z-index: 1;
        }

        .empty-particles {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 30% 20%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                        radial-gradient(circle at 70% 80%, rgba(16, 185, 129, 0.1) 0%, transparent 50%);
            animation: particleFloat 20s ease-in-out infinite;
        }

        .empty-grid {
            position: absolute;
            inset: 0;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.02) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.02) 1px, transparent 1px);
            background-size: 40px 40px;
            animation: gridMove 25s linear infinite;
        }

        .empty-content-v2 {
            position: relative;
            z-index: 2;
        }

        .empty-icon-v2 {
            position: relative;
            width: 8rem;
            height: 8rem;
            margin: 0 auto 2rem;
        }

        .icon-background {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            border-radius: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: white;
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.4);
            animation: iconPulse 3s ease-in-out infinite;
        }

        .icon-glow {
            position: absolute;
            inset: -10px;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            border-radius: 2.5rem;
            opacity: 0.3;
            filter: blur(20px);
            animation: glowPulse 3s ease-in-out infinite;
        }

        @keyframes glowPulse {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .empty-title {
            font-size: 3rem;
            font-weight: 900;
            color: #ffffff;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .empty-description {
            color: #94a3b8;
            font-size: 1.25rem;
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .launch-btn {
            position: relative;
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1.25rem 2rem;
            border: none;
            border-radius: 1.5rem;
            font-weight: 700;
            font-size: 1.125rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            color: white;
            text-decoration: none;
        }

        .btn-background {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }
        .btn-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .launch-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 25px 50px rgba(59, 130, 246, 0.6);
        }

        .launch-btn:hover .btn-background {
            background: linear-gradient(135deg, #2563eb, #059669, #7c3aed);
        }
        /* Command Center */
        /* ========== HOMEPAGE ULTRA-MODERNA 4.0 ========== */
        .home-ultra { max-width: 1600px; margin: 0 auto; }
        
        /* Hero principale */
        .hero-ultra {
            position: relative;
            padding: 3rem 2.5rem;
            margin-bottom: 2rem;
            background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(16,185,129,0.12) 50%, rgba(139,92,246,0.1) 100%);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 2rem;
            backdrop-filter: blur(32px);
            overflow: hidden;
        }
        .hero-ultra::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 30%, rgba(59,130,246,0.15), transparent 60%),
                        radial-gradient(circle at 80% 70%, rgba(16,185,129,0.12), transparent 55%);
            animation: heroGlow 8s ease-in-out infinite;
            pointer-events: none;
        }
        @keyframes heroGlow {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
        }
        .hero-ultra-content {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 2rem;
        }
        .hero-ultra-left {
            flex: 1;
            max-width: 600px;
        }
        .hero-ultra-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(16,185,129,0.15);
            border: 1px solid rgba(16,185,129,0.3);
            border-radius: 2rem;
            color: #10b981;
            font-weight: 800;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            margin-bottom: 1.25rem;
        }
        .hero-ultra-badge i {
            animation: pulse 2s ease-in-out infinite;
        }
        .hero-ultra h1 {
            margin: 0 0 0.75rem 0;
            font-size: 3rem;
            font-weight: 900;
            color: #fff;
            line-height: 1.1;
            background: linear-gradient(135deg, #fff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .hero-ultra p {
            margin: 0 0 2rem 0;
            font-size: 1.125rem;
            color: #94a3b8;
            line-height: 1.6;
        }
        .hero-ultra-actions {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .hero-ultra-actions .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem 1.75rem;
            border-radius: 1rem;
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: none;
        }
        .hero-ultra-actions .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 8px 24px rgba(59,130,246,0.35);
        }
        .hero-ultra-actions .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 32px rgba(59,130,246,0.45);
        }
        .hero-ultra-actions .btn-secondary {
            background: rgba(255,255,255,0.08);
            color: #e2e8f0;
            border: 1px solid rgba(255,255,255,0.15);
        }
        .hero-ultra-actions .btn-secondary:hover {
            background: rgba(255,255,255,0.12);
            transform: translateY(-2px);
        }
        .hero-ultra-right {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-end;
        }
        .hero-ultra-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 1rem;
            color: #94a3b8;
            font-weight: 700;
            font-size: 0.875rem;
        }
        .hero-ultra-status .pulse-dot {
            width: 0.5rem;
            height: 0.5rem;
            background: #10b981;
            border-radius: 50%;
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* KPI Cards ultra-moderne */
        .kpi-ultra-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }
        .kpi-ultra-card {
            position: relative;
            padding: 1.75rem 1.5rem;
            background: rgba(30,41,59,0.65);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.5rem;
            backdrop-filter: blur(24px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }
        .kpi-ultra-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, currentColor, transparent);
            opacity: 0.6;
        }
        .kpi-ultra-card:hover {
            transform: translateY(-5px);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        .kpi-ultra-card.primary { color: #3b82f6; }
        .kpi-ultra-card.success { color: #10b981; }
        .kpi-ultra-card.warning { color: #f59e0b; }
        .kpi-ultra-card.info { color: #8b5cf6; }
        .kpi-ultra-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .kpi-ultra-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: currentColor;
            color: white;
            font-size: 1.5rem;
            opacity: 0.15;
        }
        .kpi-ultra-trend {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.35rem 0.65rem;
            background: rgba(255,255,255,0.08);
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 700;
            color: currentColor;
        }
        .kpi-ultra-body {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        .kpi-ultra-label {
            font-size: 0.85rem;
            font-weight: 700;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }
        .kpi-ultra-value {
            font-size: 2.75rem;
            font-weight: 900;
            color: #fff;
            line-height: 1;
        }
        .kpi-ultra-progress {
            margin-top: 1rem;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }
        .kpi-ultra-progress-fill {
            height: 100%;
            background: currentColor;
            border-radius: 2px;
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Sezione Quick Info */
        .quick-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }
        .info-ultra-card {
            padding: 1.5rem;
            background: rgba(30,41,59,0.65);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.5rem;
            backdrop-filter: blur(24px);
        }
        .info-ultra-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(255,255,255,0.08);
        }
        .info-ultra-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.875rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            font-size: 1.125rem;
        }
        .info-ultra-header h3 {
            margin: 0;
            font-size: 1.125rem;
            font-weight: 800;
            color: #fff;
        }
        .info-ultra-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .info-ultra-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem;
            background: rgba(255,255,255,0.04);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 0.875rem;
            transition: all 0.2s ease;
        }
        .info-ultra-item:hover {
            background: rgba(255,255,255,0.08);
            border-color: rgba(255,255,255,0.15);
        }
        .info-ultra-item-left {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .info-badge {
            padding: 0.35rem 0.7rem;
            border-radius: 0.75rem;
            font-size: 0.75rem;
            font-weight: 800;
            border: 1px solid;
        }
        .info-badge.red { color: #fca5a5; background: rgba(248,113,113,0.12); border-color: rgba(248,113,113,0.35); }
        .info-badge.green { color: #6ee7b7; background: rgba(45,212,191,0.14); border-color: rgba(52,211,153,0.4); }
        .info-badge.blue { color: #93c5fd; background: rgba(96,165,250,0.12); border-color: rgba(96,165,250,0.35); }
        .info-badge.violet { color: #c4b5fd; background: rgba(139,92,246,0.12); border-color: rgba(139,92,246,0.35); }
        .info-badge.amber { color: #fcd34d; background: rgba(245,158,11,0.12); border-color: rgba(245,158,11,0.35); }
        .info-number {
            font-size: 1.25rem;
            font-weight: 900;
            color: #fff;
        }
        
        /* Action Cards */
        .actions-ultra-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.25rem;
        }
        .action-ultra-card {
            display: flex;
            align-items: center;
            gap: 1.25rem;
            padding: 1.5rem;
            background: rgba(30,41,59,0.65);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.5rem;
            backdrop-filter: blur(24px);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        .action-ultra-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: currentColor;
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }
        .action-ultra-card:hover::before {
            transform: scaleY(1);
        }
        .action-ultra-card:hover {
            transform: translateY(-4px);
            border-color: rgba(255,255,255,0.2);
            box-shadow: 0 16px 32px rgba(0,0,0,0.3);
        }
        .action-ultra-card.primary { color: #3b82f6; }
        .action-ultra-card.success { color: #10b981; }
        .action-ultra-card.warning { color: #f59e0b; }
        .action-ultra-card.info { color: #8b5cf6; }
        .action-ultra-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: currentColor;
            color: white;
            font-size: 1.5rem;
            box-shadow: 0 8px 20px rgba(0,0,0,0.25);
            flex-shrink: 0;
        }
        .action-ultra-content {
            flex: 1;
            min-width: 0;
        }
        .action-ultra-content h3 {
            margin: 0 0 0.25rem 0;
            font-size: 1.125rem;
            font-weight: 800;
            color: #fff;
        }
        .action-ultra-content p {
            margin: 0;
            font-size: 0.875rem;
            color: #94a3b8;
            line-height: 1.4;
        }
        .action-ultra-arrow {
            font-size: 1.25rem;
            color: #64748b;
            transition: transform 0.3s ease;
        }
        .action-ultra-card:hover .action-ultra-arrow {
            transform: translateX(4px);
            color: currentColor;
        }
        
        /* Empty State ultra-moderno */
        .ultra-empty {
            text-align: center;
            padding: 4rem 2rem;
            background: rgba(30,41,59,0.65);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
            margin-bottom: 2rem;
        }
        .ultra-empty-icon {
            width: 5rem;
            height: 5rem;
            margin: 0 auto 1.5rem;
            border-radius: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            color: white;
            font-size: 2.5rem;
            box-shadow: 0 20px 40px rgba(59,130,246,0.3);
            animation: iconFloat 3s ease-in-out infinite;
        }
        @keyframes iconFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        .ultra-empty h2 {
            margin: 0 0 0.75rem 0;
            font-size: 2rem;
            font-weight: 900;
            color: #fff;
        }
        .ultra-empty p {
            margin: 0 0 2rem 0;
            font-size: 1.125rem;
            color: #94a3b8;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .hero-ultra-content {
                flex-direction: column;
                text-align: center;
            }
            .hero-ultra h1 {
                font-size: 2rem;
            }
            .hero-ultra-actions {
                justify-content: center;
            }
            .kpi-ultra-grid {
                grid-template-columns: 1fr;
            }
            .quick-info-grid {
                grid-template-columns: 1fr;
            }
            .actions-ultra-grid {
                grid-template-columns: 1fr;
            }
        }
        .command-center {
            margin-bottom: 3rem;
            padding: 2rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
        }
        /* ========== PERSONNEL ULTRA (Gerarchia 4.0) ========== */
        .personnel-ultra { max-width: 1600px; margin: 0 auto; }
        .pu-hero { display: flex; justify-content: space-between; align-items: flex-start; gap: 1.25rem; padding: 2rem; margin-bottom: 1.25rem; background: rgba(15,23,42,0.8); border: 1px solid rgba(255,255,255,0.1); border-radius: 1.5rem; backdrop-filter: blur(24px); }
        .pu-hero-left h1 { margin: 0 0 .35rem 0; font-size: 2rem; font-weight: 900; color: #fff; }
        .pu-hero-left p { margin: 0; color: #94a3b8; }
        .pu-hero-right { display: flex; gap: .6rem; flex-wrap: wrap; }
        .pu-chip { display: inline-flex; align-items: center; gap: .4rem; padding: .45rem .7rem; border-radius: .8rem; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); color: #e2e8f0; font-weight: 800; font-size: .8rem; }
        .pu-chip .dot { width: .45rem; height: .45rem; border-radius: 50%; background: #10b981; }
        .pu-toolbar { display: grid; grid-template-columns: 1fr auto; gap: .75rem; padding: 1rem 1.25rem; margin-bottom: 1rem; background: rgba(30,41,59,0.6); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; backdrop-filter: blur(24px); }
        .pu-filters { display: flex; gap: .5rem; flex-wrap: wrap; }
        .pu-search { display: flex; gap: .5rem; align-items: center; }
        .pu-search input { width: 260px; max-width: 100%; padding: .7rem .9rem; border-radius: .8rem; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color: #e2e8f0; }
        .filter-pill { padding: .55rem .85rem; border-radius: .8rem; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color: #e2e8f0; font-weight: 800; cursor: pointer; }
        .filter-pill.active { background: linear-gradient(135deg,#3b82f6,#2563eb); border-color: rgba(59,130,246,0.5); color: #fff; }
        .pu-quick { display: flex; gap: .5rem; flex-wrap: wrap; margin-top: .25rem; }
        .quick-btn { padding: .55rem .85rem; border-radius: .8rem; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color: #e2e8f0; font-weight: 800; cursor: pointer; }
        .pu-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem; }
        .op-card { display: grid; grid-template-columns: 56px 1fr; grid-template-rows: auto auto; column-gap: 1rem; row-gap: .5rem; padding: 1rem; background: rgba(15,23,42,0.72); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; align-items: center; transition: transform .2s ease, border-color .2s ease, box-shadow .2s ease; }
        .op-card:hover { transform: translateY(-3px); border-color: rgba(255,255,255,0.2); box-shadow: 0 20px 36px -24px rgba(15,23,42,0.6); }
        .op-avatar { width: 56px; height: 56px; border-radius: 16px; border: 1px solid rgba(148,163,184,0.18); object-fit: cover; background: rgba(12,18,28,0.8); }
        .op-main { display: flex; flex-direction: column; gap: .25rem; min-width: 0; }
        .op-name { font-size: 1.05rem; font-weight: 800; color: #f8fafc; }
        .op-meta { font-size: .82rem; color: #94a3b8; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .op-tags { grid-column: 1 / -1; display: flex; gap: .4rem; flex-wrap: wrap; }
        .op-chip { display: inline-flex; align-items: center; padding: .35rem .65rem; border-radius: 999px; font-size: .75rem; font-weight: 800; border: 1px solid rgba(148,163,184,0.14); background: rgba(12,19,32,0.85); }
        .role-dir { color: #fca5a5; border-color: rgba(248,113,113,0.35); background: rgba(248,113,113,0.12); }
        .role-amm { color: #6ee7b7; border-color: rgba(52,211,153,0.4); background: rgba(45,212,191,0.14); }
        .role-ope { color: #93c5fd; border-color: rgba(96,165,250,0.35); background: rgba(96,165,250,0.12); }
        .st-ava { color: #86efac; border-color: rgba(34,197,94,0.4); background: rgba(34,197,94,0.14); }
        .st-busy { color: #fcd34d; border-color: rgba(234,179,8,0.35); background: rgba(234,179,8,0.14); }
        .mat-chip { font-family: 'IBM Plex Mono','Fira Code',monospace; color: #a5b4fc; border-color: rgba(129,140,248,0.35); background: rgba(79,70,229,0.12); }
        @media (max-width: 768px){ .pu-toolbar{ grid-template-columns: 1fr; } }
        /* List layout minimal 2-col */
        .pu-list { display: grid; grid-template-columns: repeat(auto-fit, minmax(480px, 1fr)); gap: .85rem; }
        .pu-row { display: grid; grid-template-columns: 56px 1fr auto; align-items: center; gap: .9rem; padding: .9rem 1rem; background: rgba(14,20,33,0.6); border: 1px solid rgba(148,163,184,0.18); border-radius: 14px; }
        .pu-row:hover { border-color: rgba(255,255,255,0.2); box-shadow: 0 20px 36px -24px rgba(15,23,42,0.6); }
        .pu-r-avatar { width:56px; height:56px; border-radius: 50%; border: 1px solid rgba(148,163,184,0.25); object-fit: cover; background: rgba(12,18,28,0.8); }
        .pu-r-main { display:flex; align-items:center; gap:.6rem; min-width:0; flex:1; }
        .pu-grade { padding:.3rem .55rem; border-radius:.55rem; font-weight:800; font-size:.74rem; border:1px solid rgba(148,163,184,0.24); color:#e2e8f0; background: transparent; white-space:nowrap; flex-shrink:0; }
        .pu-namebox { display:flex; flex-direction:column; min-width:0; flex:1; }
        .pu-r-name { color:#e5e7eb; font-weight:800; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%; display:block; }
        .pu-r-meta { color:#94a3b8; font-size:.82rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; max-width:100%; display:block; }
        @media (max-width: 700px){
            .pu-r-name { white-space:normal; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; line-clamp: 2; }
        }
        .pu-r-tags { display:flex; align-items:center; gap:.4rem; flex-wrap: wrap; justify-content: flex-end; max-width: 420px; }
        /* Pannelli per nuclei (con tabs) */
        .pu-segments { display: inline-flex; gap: .5rem; padding: .5rem; background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: .9rem; }
        .segment-btn { padding: .55rem .9rem; border-radius: .7rem; font-weight: 800; color: #e2e8f0; background: transparent; border: none; cursor: pointer; }
        .segment-btn.active { background: linear-gradient(135deg,#3b82f6,#2563eb); color: #fff; }
        .pu-panel-stack { 
            display: block; 
            position: relative;
            min-height: 400px;
        }
        
        .pu-panel { 
            display: flex; 
            flex-direction: column; 
            gap: 1rem; 
            padding: 1.25rem; 
            background: rgba(20,27,45,0.55); 
            border: 1px solid rgba(255,255,255,0.09); 
            border-radius: 1rem; 
            backdrop-filter: blur(18px);
            animation: panelFadeIn 0.5s ease-out;
            position: relative;
        }
        
        @keyframes panelFadeIn {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .pu-panel.hidden { 
            display: none;
            animation: panelFadeOut 0.3s ease-in;
        }
        
        @keyframes panelFadeOut {
            from {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.98);
            }
        }
        
        /* Animazione slide per cambio nucleo */
        .pu-panel.entering {
            animation: slideInFromRight 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .pu-panel.leaving {
            animation: slideOutToLeft 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes slideInFromRight {
            from {
                opacity: 0;
                transform: translateX(50px) scale(0.95);
                filter: blur(4px);
            }
            to {
                opacity: 1;
                transform: translateX(0) scale(1);
                filter: blur(0);
            }
        }
        
        @keyframes slideOutToLeft {
            from {
                opacity: 1;
                transform: translateX(0) scale(1);
                filter: blur(0);
            }
            to {
                opacity: 0;
                transform: translateX(-50px) scale(0.95);
                filter: blur(4px);
            }
        }
        .pu-panel-head { position: sticky; top: 0; z-index: 1; background: transparent; display: flex; align-items: center; justify-content: space-between; padding-bottom: .4rem; border-bottom: 1px dashed rgba(148,163,184,0.3); }
        .pu-panel-title { display: inline-flex; align-items: center; gap: .5rem; font-weight: 900; color: #fff; }
        .pu-count { color: #94a3b8; font-weight: 800; padding: .25rem .5rem; border-radius: .5rem; border: 1px solid rgba(148,163,184,0.25); }
        .pu-panel-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: .6rem; }
        .pu-sort { display: inline-flex; align-items: center; gap: .5rem; }
        .pu-sort select { padding: .55rem .85rem; border-radius: .8rem; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.06); color: #e2e8f0; font-weight: 800; }
        .center-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .center-header h2 {
            font-size: 2rem;
            font-weight: 800;
            color: #ffffff;
            margin: 0 0 0.5rem 0;
        }
        
        /* ========== PERSONNEL ULTRA MODERN REDESIGN ========== */
        .personnel-ultra .pu-hero {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-radius: 2rem;
            padding: 3rem;
            margin-bottom: 2.5rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        
        .personnel-ultra .pu-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 60%;
            height: 200%;
            background: radial-gradient(circle, rgba(59,130,246,0.15) 0%, transparent 60%);
            animation: pulse 20s ease-in-out infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1) rotate(0deg); }
            50% { transform: scale(1.1) rotate(10deg); }
        }
        
        .personnel-ultra .pu-hero-left h1 {
            font-size: 3.5rem;
            font-weight: 900;
            background: linear-gradient(135deg, #ffffff 0%, #60a5fa 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -2px;
            line-height: 1;
            margin-bottom: 1rem;
        }
        
        .personnel-ultra .pu-hero-left p {
            color: #cbd5e1;
            font-size: 1.25rem;
            font-weight: 500;
            opacity: 0.9;
        }
        
        .personnel-ultra .pu-hero-right {
            z-index: 1;
        }
        
        .personnel-ultra .pu-chip {
            background: rgba(59,130,246,0.15);
            border: 2px solid rgba(59,130,246,0.3);
            color: #60a5fa;
            padding: 0.875rem 1.75rem;
            border-radius: 2rem;
            font-weight: 800;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .personnel-ultra .pu-chip:hover {
            background: rgba(59,130,246,0.25);
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(59,130,246,0.4);
        }
        
        .personnel-ultra .pu-toolbar {
            background: rgba(30,41,59,0.4);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.5rem;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        
        .personnel-ultra .pu-filters {
            margin-bottom: 1rem;
        }
        
        .personnel-ultra .filter-pill {
            padding: 0.75rem 1.5rem;
            border-radius: 1rem;
            background: rgba(15,23,42,0.8);
            border: 2px solid transparent;
            color: #94a3b8;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s;
        }
        
        .personnel-ultra .filter-pill:hover {
            background: rgba(59,130,246,0.15);
            border-color: rgba(59,130,246,0.3);
            color: #60a5fa;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59,130,246,0.2);
        }
        
        .personnel-ultra .filter-pill.active {
            background: linear-gradient(135deg, rgba(59,130,246,0.2) 0%, rgba(37,99,235,0.2) 100%);
            border-color: #3b82f6;
            color: #60a5fa;
            box-shadow: 0 0 25px rgba(59,130,246,0.3);
        }
        
        .personnel-ultra .filter-pill[data-role="dirigenziale"]:hover,
        .personnel-ultra .filter-pill[data-role="dirigenziale"].active {
            background: linear-gradient(135deg, rgba(239,68,68,0.2) 0%, rgba(220,38,38,0.2) 100%);
            border-color: #ef4444;
            color: #fca5a5;
        }
        
        .personnel-ultra .filter-pill[data-role="amministrativo"]:hover,
        .personnel-ultra .filter-pill[data-role="amministrativo"].active {
            background: linear-gradient(135deg, rgba(16,185,129,0.2) 0%, rgba(5,150,105,0.2) 100%);
            border-color: #10b981;
            color: #6ee7b7;
        }
        
        .personnel-ultra .filter-pill[data-role="operativo"]:hover,
        .personnel-ultra .filter-pill[data-role="operativo"].active {
            background: linear-gradient(135deg, rgba(59,130,246,0.2) 0%, rgba(37,99,235,0.2) 100%);
            border-color: #3b82f6;
            color: #93c5fd;
        }
        
        .personnel-ultra #personnelSearch {
            width: 100%;
            max-width: 400px;
            padding: 0.875rem 1.25rem;
            border-radius: 1rem;
            border: 2px solid rgba(255,255,255,0.1);
            background: rgba(15,23,42,0.8);
            color: #ffffff;
            font-weight: 500;
            font-size: 0.9375rem;
            transition: all 0.3s;
        }
        
        .personnel-ultra #personnelSearch:hover,
        .personnel-ultra #personnelSearch:focus {
            border-color: rgba(59,130,246,0.5);
            background: rgba(30,41,59,0.8);
            outline: none;
            box-shadow: 0 0 30px rgba(59,130,246,0.3);
        }
        
        .personnel-ultra #personnelSearch::placeholder {
            color: #64748b;
        }
        
        .personnel-ultra #puSortAdmin {
            padding: 0.875rem 1.25rem;
            border-radius: 1rem;
            background: rgba(15,23,42,0.8);
            border: 2px solid rgba(255,255,255,0.1);
            color: #ffffff;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 160px;
        }
        
        .personnel-ultra #puSortAdmin:hover,
        .personnel-ultra #puSortAdmin:focus {
            border-color: rgba(59,130,246,0.5);
            background: rgba(30,41,59,0.8);
            outline: none;
            box-shadow: 0 0 20px rgba(59,130,246,0.2);
        }
        
        /* Segment Buttons Elite */
        .personnel-ultra .segment-btn {
            padding: 1.5rem;
            background: linear-gradient(135deg, rgba(30,41,59,0.6) 0%, rgba(15,23,42,0.6) 100%);
            color: #94a3b8;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 1.25rem;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.75px;
            position: relative;
            backdrop-filter: blur(10px);
            overflow: hidden;
            transition: all 0.3s;
        }
        
        .personnel-ultra .segment-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.6s;
        }
        
        .personnel-ultra .segment-btn:hover::before {
            left: 100%;
        }
        
        .personnel-ultra .segment-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.3);
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-dir"] {
            background: linear-gradient(135deg, rgba(239,68,68,0.15) 0%, rgba(220,38,38,0.1) 100%);
            border-color: rgba(239,68,68,0.3);
            color: #fca5a5;
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-dir"]:hover,
        .personnel-ultra .segment-btn[data-target="#admin-panel-dir"].active {
            background: linear-gradient(135deg, rgba(239,68,68,0.25) 0%, rgba(220,38,38,0.2) 100%);
            border-color: #ef4444;
            box-shadow: 0 15px 30px rgba(239,68,68,0.3);
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-amm"] {
            background: linear-gradient(135deg, rgba(16,185,129,0.15) 0%, rgba(5,150,105,0.1) 100%);
            border-color: rgba(16,185,129,0.3);
            color: #6ee7b7;
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-amm"]:hover,
        .personnel-ultra .segment-btn[data-target="#admin-panel-amm"].active {
            background: linear-gradient(135deg, rgba(16,185,129,0.25) 0%, rgba(5,150,105,0.2) 100%);
            border-color: #10b981;
            box-shadow: 0 15px 30px rgba(16,185,129,0.3);
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-ope"] {
            background: linear-gradient(135deg, rgba(59,130,246,0.15) 0%, rgba(37,99,235,0.1) 100%);
            border-color: rgba(59,130,246,0.3);
            color: #93c5fd;
        }
        
        .personnel-ultra .segment-btn[data-target="#admin-panel-ope"]:hover,
        .personnel-ultra .segment-btn[data-target="#admin-panel-ope"].active {
            background: linear-gradient(135deg, rgba(59,130,246,0.25) 0%, rgba(37,99,235,0.2) 100%);
            border-color: #3b82f6;
            box-shadow: 0 15px 30px rgba(59,130,246,0.3);
        }
        
        .personnel-ultra .segment-btn .pu-count {
            background: rgba(255,255,255,0.15);
            padding: 0.375rem 0.875rem;
            border-radius: 1.5rem;
            font-size: 0.875rem;
            font-weight: 900;
            backdrop-filter: blur(10px);
        }
        
        /* Panel Headers per Nuclei */
        .personnel-ultra .pu-panel-head {
            background: linear-gradient(135deg, rgba(30,41,59,0.6) 0%, rgba(15,23,42,0.7) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1.25rem;
            padding: 1.75rem 2rem;
            margin-bottom: 1.5rem;
            backdrop-filter: blur(15px);
            position: relative;
            overflow: hidden;
        }
        
        .personnel-ultra .pu-panel-head::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, currentColor, transparent);
            opacity: 0.5;
        }
        
        .personnel-ultra .pu-panel-title {
            font-size: 1.875rem;
            font-weight: 900;
            display: flex;
            align-items: center;
            gap: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .personnel-ultra #admin-panel-dir .pu-panel-head::before { 
            background: linear-gradient(90deg, transparent, #ef4444, transparent); 
        }
        .personnel-ultra #admin-panel-dir .pu-panel-title { 
            color: #fca5a5; 
        }
        .personnel-ultra #admin-panel-dir .pu-count { 
            background: rgba(239,68,68,0.2); 
            border: 1px solid rgba(239,68,68,0.4); 
            color: #fca5a5; 
        }
        
        .personnel-ultra #admin-panel-amm .pu-panel-head::before { 
            background: linear-gradient(90deg, transparent, #10b981, transparent); 
        }
        .personnel-ultra #admin-panel-amm .pu-panel-title { 
            color: #6ee7b7; 
        }
        .personnel-ultra #admin-panel-amm .pu-count { 
            background: rgba(16,185,129,0.2); 
            border: 1px solid rgba(16,185,129,0.4); 
            color: #6ee7b7; 
        }
        
        .personnel-ultra #admin-panel-ope .pu-panel-head::before { 
            background: linear-gradient(90deg, transparent, #3b82f6, transparent); 
        }
        .personnel-ultra #admin-panel-ope .pu-panel-title { 
            color: #93c5fd; 
        }
        .personnel-ultra #admin-panel-ope .pu-count { 
            background: rgba(59,130,246,0.2); 
            border: 1px solid rgba(59,130,246,0.4); 
            color: #93c5fd; 
        }
        .center-header p {
            color: #94a3b8;
            font-size: 1rem;
            margin: 0;
        }
        .command-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        .command-item {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            backdrop-filter: blur(24px);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .command-item:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
            border-color: rgba(59, 130, 246, 0.4);
            background: rgba(255, 255, 255, 0.08);
        }
        .command-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.4);
            transition: all 0.3s ease;
        }
        .command-item:hover .command-icon {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.6);
        }
        .command-content {
            flex: 1;
        }
        .command-content h3 {
            color: #ffffff;
            font-size: 1.25rem;
            font-weight: 700;
            margin: 0 0 0.5rem 0;
        }

        .command-content p {
            color: #94a3b8;
            font-size: 0.875rem;
            margin: 0 0 1rem 0;
            line-height: 1.5;
        }

        .command-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .command-status .status-dot.active {
            background: #10b981;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .command-status .status-dot.standby {
            background: #f59e0b;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .command-status span:last-child {
            color: #94a3b8;
        }

        /* ========== RESPONSIVE ========== */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .nav {
                width: 100%;
                overflow-x: auto;
            }

            .main {
                padding: 2rem 1rem;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            /* Mobile responsive per panoramica rivoluzionaria */
            .hero-section-v2 {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
                padding: 2rem 1rem;
            }

            .title-main {
                font-size: 2.5rem;
            }

            .hero-stats-mini {
                flex-direction: column;
                gap: 1rem;
            }

            .stats-grid-v2 {
                grid-template-columns: 1fr;
            }

            .analytics-grid-v2 {
                grid-template-columns: 1fr;
            }

            .command-grid {
                grid-template-columns: 1fr;
            }

            .hub-text h2 {
                font-size: 1.5rem;
            }

            .empty-title {
                font-size: 2rem;
            }

            .empty-icon-v2 {
                width: 6rem;
                height: 6rem;
            }
            .icon-background {
                font-size: 2.5rem;
            }
        }

        /* ========== DEVELOPMENT PAGE STYLES ========== */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding: 2rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
        }

        .page-header h1 {
            font-size: 2.5rem;
            font-weight: 900;
            color: #ffffff;
            margin: 0 0 0.5rem 0;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .page-header p {
            color: #94a3b8;
            font-size: 1.125rem;
            margin: 0;
        }

        .page-actions {
            display: flex;
            gap: 1rem;
        }

        .development-message {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 4rem 2rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
            text-align: center;
            min-height: 400px;
        }

        .development-icon {
            font-size: 4rem;
            margin-bottom: 2rem;
            animation: bounce 2s ease-in-out infinite;
        }

        .development-message h3 {
            font-size: 2rem;
            font-weight: 800;
            color: #f59e0b;
            margin: 0 0 1rem 0;
        }

        .development-message p {
            font-size: 1.125rem;
            color: #94a3b8;
            margin: 0;
        }
        /* ========== COUNTDOWN SYSTEM STYLES - REDESIGNED ========== */
        .countdown-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(8px);
            z-index: 10;
        }

        .countdown-overlay .page-content {
            filter: blur(6px);
            opacity: 0.3;
            pointer-events: none;
            user-select: none;
            width: 100%;
            height: 100%;
            transition: all 0.3s ease;
        }

        .countdown-overlay.unlocked .page-content {
            filter: none;
            opacity: 1;
            pointer-events: auto;
            user-select: auto;
        }

        .countdown-message {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 4rem;
            background: rgba(15, 23, 42, 0.9);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(20px);
            text-align: center;
            width: 90%;
            max-width: 800px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.5s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .countdown-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            color: #f59e0b;
            animation: gentlePulse 2s ease-in-out infinite;
        }

        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .countdown-title {
            font-size: 2.5rem;
            font-weight: 700;
            color: #ffffff;
            margin: 0 0 1rem 0;
            letter-spacing: -0.01em;
        }
        .countdown-subtitle {
            font-size: 1.125rem;
            color: #94a3b8;
            margin: 0 0 2.5rem 0;
            font-weight: 400;
            line-height: 1.5;
        }
        .countdown-timer {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
            width: 100%;
        }
        .countdown-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 1.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            transition: all 0.3s ease;
        }
        .countdown-unit:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        .countdown-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: #ffffff;
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .countdown-label {
            font-size: 0.875rem;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
        }

        .countdown-date {
            font-size: 1rem;
            color: #94a3b8;
            font-weight: 500;
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
            transform: translateY(-5px);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 2rem;
                text-align: center;
            }

            .page-actions {
                justify-content: center;
            }

            .development-message {
                padding: 3rem 1rem;
                min-height: 300px;
            }

            .development-icon {
                font-size: 3rem;
            }

            .development-message h3 {
                font-size: 1.5rem;
            }

            .countdown-message {
                min-width: 320px;
                padding: 2rem 1rem;
            }

            .countdown-timer {
                gap: 0.5rem;
            }

            .countdown-unit {
                min-width: 50px;
                padding: 0.75rem;
            }

            .countdown-number {
                font-size: 1.5rem;
            }
        }

        /* ========== SHIFTS PAGE MODERN DESIGN ========== */
        .shifts-page-container {
            padding: 2rem;
        }
        .shifts-day-container {
            margin-bottom: 3rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 2rem;
            backdrop-filter: blur(24px);
            overflow: hidden;
        }

        .shifts-day-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .day-info {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .day-icon {
            width: 4rem;
            height: 4rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border-radius: 1.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }
        .day-details h2 {
            color: #ffffff;
            font-size: 2rem;
            font-weight: 800;
            margin: 0 0 0.5rem 0;
            background: linear-gradient(135deg, #ffffff, #e2e8f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .day-details p {
            color: #94a3b8;
            font-size: 1.125rem;
            margin: 0;
        }
        .day-stats {
            display: flex;
            gap: 2rem;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(20px);
        }
        .stat-icon {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
        }

        .stat-icon.active {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .stat-icon.completed {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .stat-content {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 900;
            color: #ffffff;
        }

        .stat-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: #94a3b8;
        }

        .shifts-content {
            padding: 2rem;
        }

        .shifts-section {
            margin-bottom: 2.5rem;
        }
        .shifts-section:last-child {
            margin-bottom: 0;
        }

        .section-header {
            margin-bottom: 1.5rem;
        }

        .section-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .title-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }
        .title-icon.active {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .title-icon.completed {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .title-text h3 {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0 0 0.25rem 0;
        }

        .title-text p {
            color: #94a3b8;
            font-size: 1rem;
            margin: 0;
        }

        .shifts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            justify-items: center;
        }

        .shift-card {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .shift-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .shift-card.activation {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .shift-card.deactivation {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .shift-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .shift-icon {
            width: 3rem;
            height: 3rem;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .shift-card.activation .shift-icon {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .shift-card.deactivation .shift-icon {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .shift-info {
            flex: 1;
            margin-left: 1rem;
        }

        .shift-title {
            color: #ffffff;
            font-size: 1.125rem;
            font-weight: 700;
            margin: 0 0 0.25rem 0;
        }

        .shift-subtitle {
            color: #94a3b8;
            font-size: 0.875rem;
            margin: 0;
        }

        .shift-status {
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .shift-status.active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .shift-status.completed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .shift-content {
            padding: 1.5rem;
        }

        .shift-details {
            margin-bottom: 1.5rem;
        }
        .detail-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .detail-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .detail-icon {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: white;
            flex-shrink: 0;
        }

        .detail-icon i.fa-play {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .detail-icon i.fa-stop {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .detail-icon i.fa-calendar {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
        }

        .detail-icon i.fa-user {
            background: linear-gradient(135deg, #f59e0b, #d97706);
        }

        .detail-icon i.fa-car {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
        }

        .detail-info {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .detail-label {
            color: #64748b;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .detail-value {
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .operators-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .operators-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .operators-icon {
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: white;
        }

        .operators-label {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .operators-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .operator-card {
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            transition: all 0.3s ease;
        }

        .operator-card:hover {
            transform: translateY(-2px);
        }

        .operator-card.primary {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .operator-card.secondary {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .operator-name {
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .shift-action-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            border: none;
            border-radius: 1rem;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .shift-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4);
        }
        /* ========== SHIFT CARD COMPATTE ========== */
        .shift-card-compact {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .shift-card-compact:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .shift-card-compact.activation {
            border-color: rgba(16, 185, 129, 0.3);
        }
        .shift-card-compact.activation {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .shift-card-compact.deactivation {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .shift-header-compact {
            display: flex;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .shift-icon-compact {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            color: white;
            margin-right: 0.75rem;
        }

        .shift-card-compact.activation .shift-icon-compact {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .shift-card-compact.deactivation .shift-icon-compact {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .shift-info-compact {
            flex: 1;
        }

        .shift-title-compact {
            color: #ffffff;
            font-size: 1rem;
            font-weight: 700;
            margin: 0 0 0.125rem 0;
        }

        .shift-subtitle-compact {
            color: #94a3b8;
            font-size: 0.75rem;
            margin: 0;
        }

        .shift-status-compact {
            padding: 0.375rem 0.75rem;
            border-radius: 0.75rem;
            font-size: 0.6875rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .shift-status-compact.active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .shift-status-compact.completed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .shift-content-compact {
            padding: 1rem;
        }

        .shift-details-compact {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .detail-item-compact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.5rem;
            font-size: 0.75rem;
            color: #e2e8f0;
        }

        .detail-item-compact i {
            color: #94a3b8;
            font-size: 0.6875rem;
            width: 0.75rem;
        }
        .operators-compact {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .operators-label-compact {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
            font-weight: 600;
        }
        .operators-list-compact {
            display: flex;
            gap: 0.5rem;
        }
        .operator-compact {
            padding: 0.25rem 0.5rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.5rem;
            font-size: 0.6875rem;
            color: #3b82f6;
            font-weight: 600;
        }
        .shift-action-compact {
            width: 100%;
            padding: 0.5rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 0.5rem;
            color: white;
            font-weight: 600;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .shift-action-compact:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* ========== SHIFT CARD ULTRA-COMPATTE ========== */
        .shift-card-ultra-compact {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.75rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            margin-bottom: 0.75rem;
        }
        .shift-card-ultra-compact:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
            border-color: rgba(255, 255, 255, 0.2);
        }
        .shift-card-ultra-compact.activation {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .shift-card-ultra-compact.deactivation {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .shift-main-ultra {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            gap: 0.75rem;
        }
        .shift-icon-ultra {
            width: 2rem;
            height: 2rem;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.875rem;
            color: white;
            flex-shrink: 0;
        }

        .shift-card-ultra-compact.activation .shift-icon-ultra {
            background: linear-gradient(135deg, #10b981, #059669);
        }

        .shift-card-ultra-compact.deactivation .shift-icon-ultra {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        .shift-content-ultra {
            flex: 1;
            min-width: 0;
        }

        .shift-title-ultra {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        .title-text {
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 700;
        }

        .status-badge-ultra {
            padding: 0.25rem 0.5rem;
            border-radius: 0.5rem;
            font-size: 0.625rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-badge-ultra.active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-badge-ultra.completed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .shift-info-ultra {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.375rem;
            font-size: 0.6875rem;
            color: #e2e8f0;
            white-space: nowrap;
        }

        .info-item i {
            color: #94a3b8;
            font-size: 0.625rem;
            width: 0.625rem;
        }

        .operators-ultra {
            display: flex;
            align-items: center;
            gap: 0.375rem;
            flex-wrap: wrap;
        }

        .ops-label {
            font-size: 0.625rem;
            color: #94a3b8;
            font-weight: 600;
            margin-right: 0.25rem;
        }

        .operator-ultra {
            padding: 0.125rem 0.375rem;
            background: rgba(59, 130, 246, 0.2);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 0.375rem;
            font-size: 0.625rem;
            color: #3b82f6;
            font-weight: 600;
            white-space: nowrap;
        }

        .edit-btn-ultra {
            width: 2rem;
            height: 2rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 0.5rem;
            color: white;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .edit-btn-ultra:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        /* ========== SHIFT CARD VERTICALI ========== */
        .shift-card-vertical {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1rem;
            backdrop-filter: blur(20px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            margin-bottom: 1.5rem;
            width: 100%;
            max-width: 400px;
        }

        .shift-card-vertical:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .shift-card-vertical.activation {
            border-color: rgba(16, 185, 129, 0.3);
        }

        .shift-card-vertical.deactivation {
            border-color: rgba(239, 68, 68, 0.3);
        }

        .shift-card-header {
            display: flex;
            align-items: center;
            padding: 1.25rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.02);
        }

        .shift-icon-vertical {
            width: 3rem;
            height: 3rem;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
            margin-right: 1rem;
        }
        .shift-card-vertical.activation .shift-icon-vertical {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .shift-card-vertical.deactivation .shift-icon-vertical {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        .shift-title-vertical {
            flex: 1;
        }

        .shift-title-vertical h3 {
            color: #ffffff;
            font-size: 1.125rem;
            font-weight: 700;
            margin: 0 0 0.25rem 0;
        }

        .shift-title-vertical p {
            color: #94a3b8;
            font-size: 0.875rem;
            margin: 0;
        }

        .shift-status-vertical {
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .shift-status-vertical.active {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .shift-status-vertical.completed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .shift-card-content {
            padding: 1.25rem;
        }

        .shift-details-vertical {
            margin-bottom: 1.5rem;
        }

        .detail-item-vertical {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 0.75rem;
            margin-bottom: 0.75rem;
            transition: all 0.3s ease;
        }

        .detail-item-vertical:hover {
            background: rgba(255, 255, 255, 0.08);
        }

        .detail-icon-vertical {
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 0.5rem;
            background: rgba(59, 130, 246, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            color: #3b82f6;
            font-size: 1rem;
        }

        .detail-info-vertical {
            flex: 1;
        }

        .detail-label {
            display: block;
            color: #94a3b8;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.25rem;
        }

        .detail-value {
            display: block;
            color: #ffffff;
            font-size: 0.875rem;
            font-weight: 600;
        }
        .operators-vertical {
            margin-bottom: 1.5rem;
        }
        .operators-header-vertical {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            color: #94a3b8;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .operators-list-vertical {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        .operator-card-vertical {
            padding: 0.75rem;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 0.75rem;
            text-align: center;
            transition: all 0.3s ease;
        }
        .operator-card-vertical:hover {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
        }
        .operator-name {
            color: #3b82f6;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .shift-action-vertical {
            width: 100%;
            padding: 0.875rem;
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            border: none;
            border-radius: 0.75rem;
            color: white;
            font-weight: 700;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .shift-action-vertical:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
        }
        /* Responsive */
        @media (max-width: 1024px) {
            .shifts-day-header {
                flex-direction: column;
                gap: 1.5rem;
                text-align: center;
            }

            .day-stats {
                justify-content: center;
            }

            .shifts-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .shifts-page-container {
                padding: 1rem;
            }

            .shifts-day-header {
                padding: 1.5rem;
            }

            .day-info {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }

            .day-stats {
                flex-direction: column;
                gap: 1rem;
            }

            .shifts-content {
                padding: 1.5rem;
            }

            .detail-row {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .operators-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }
            /* ========== MODERN LOGIN SCREEN ========== */
        .login-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
                background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
                background-attachment: fixed;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
                overflow: hidden;
            }

            /* Animated background particles for login */
            .login-sidebar::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: radial-gradient(circle at 20% 50%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                            radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.15) 0%, transparent 50%),
                            radial-gradient(circle at 40% 80%, rgba(139, 92, 246, 0.15) 0%, transparent 50%);
                animation: backgroundShift 20s ease-in-out infinite;
                pointer-events: none;
                z-index: -1;
        }
        .login-content {
            text-align: center;
                padding: 4rem 3rem;
            width: 100%;
                max-width: 450px;
                background: rgba(30, 41, 59, 0.9);
            border-radius: 2rem;
                border: 1px solid rgba(255, 255, 255, 0.15);
                    box-shadow: 
                    0 25px 50px rgba(0, 0, 0, 0.4),
                    0 0 0 1px rgba(255, 255, 255, 0.05),
                    inset 0 1px 0 rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(32px);
                position: relative;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
            }

            .login-content::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: linear-gradient(90deg, transparent, var(--primary), transparent);
                opacity: 0.8;
        }
        .login-logo {
                width: 100px;
                height: 100px;
            border-radius: 50%;
            margin: 0 auto 2rem;
                    box-shadow: 
                    0 0 30px rgba(59, 130, 246, 0.4),
                    0 0 60px rgba(59, 130, 246, 0.2);
                transition: all 0.3s ease;
                animation: logoFloat 3s ease-in-out infinite;
            }

            .login-logo:hover {
                transform: scale(1.05);
                    box-shadow: 
                    0 0 40px rgba(59, 130, 246, 0.6),
                    0 0 80px rgba(59, 130, 246, 0.3);
        }

        .login-content h2 {
            font-size: 2.5rem;
                font-weight: 900;
                margin-bottom: 0.5rem;
            color: #ffffff;
                background: linear-gradient(135deg, #ffffff, #e2e8f0);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
        }

        .login-content p {
            color: #94a3b8;
                margin-bottom: 3rem;
            font-size: 1.125rem;
                font-weight: 500;
        }
        .login-btn {
            width: 100%;
                padding: 1.5rem 2rem;
            background: linear-gradient(135deg, #5865f2, #4752c4);
            border: none;
            border-radius: 1rem;
            color: white;
            font-weight: 700;
            font-size: 1.125rem;
            cursor: pointer;
                    box-shadow: 
                    0 8px 20px rgba(88, 101, 242, 0.4),
                    0 0 0 1px rgba(255, 255, 255, 0.1);
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                position: relative;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
            }

            .login-btn::before {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
                transition: left 0.5s;
            }

            .login-btn:hover::before {
                left: 100%;
        }
        .login-btn:hover {
                transform: translateY(-3px);
                    box-shadow: 
                    0 15px 35px rgba(88, 101, 242, 0.5),
                    0 0 0 1px rgba(255, 255, 255, 0.2);
            }

            .login-btn:active {
                transform: translateY(-1px);
            }

            .login-btn i {
                font-size: 1.25rem;
        }
        .main-content {
            margin-left: 350px;
            min-height: 100vh;
            width: calc(100% - 350px);
            overflow-x: hidden;
            transition: all 0.5s ease;
        }

        .main-content.hidden {
            display: none;
        }

        .content {
            padding: 2rem;
            max-width: 100%;
            overflow-x: hidden;
            box-sizing: border-box;
        }
        /* Nascondi sidebar dopo login */
        .login-sidebar.hidden {
            transform: translateX(-100%);
            transition: transform 0.5s ease;
        }

        .main-content.full-width {
            margin-left: 0;
            width: 100%;
            transition: margin-left 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .login-sidebar {
                width: 100%;
                position: relative;
                height: auto;
                min-height: 100vh;
            }
            
            .main-content {
                margin-left: 0;
                width: 100%;
            }

            .content {
                padding: 1rem;
            }

            .nav {
                gap: 0.125rem;
            }

            .nav-btn {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }

            table {
                min-width: 600px;
            }

            th, td {
                padding: 0.75rem;
                font-size: 0.875rem;
            }
        }

        @media (max-width: 480px) {
            .content {
                padding: 0.5rem;
            }

            .nav-btn {
                padding: 0.375rem 0.5rem;
                font-size: 0.75rem;
            }

            table {
                min-width: 500px;
            }

            th, td {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
        }
            /* ========== MOBILE OPTIMIZATIONS ========== */
            @media (max-width: 640px) {
            .header {
                padding: 0.125rem 0.25rem;
                flex-direction: column;
                gap: 0.25rem;
                align-items: stretch;
                min-height: auto;
            }

                .logo-section {
                    justify-content: center;
                    gap: 0.5rem;
                    flex-wrap: wrap;
                }

                .logo {
                    width: 2rem;
                    height: 2rem;
                }

                .brand h1 {
                    font-size: 1rem;
                    margin: 0;
                }

                .brand p {
                    font-size: 0.625rem;
                    margin: 0;
                }

                .nav {
                    overflow-x: auto;
                    padding: 0.125rem 0;
                    scrollbar-width: none;
                    -ms-overflow-style: none;
                    gap: 0.25rem;
                }

                .nav::-webkit-scrollbar {
                    display: none;
                }

                .nav-btn {
                    padding: 0.375rem 0.5rem;
                    font-size: 0.75rem;
                    white-space: nowrap;
                    flex-shrink: 0;
                    min-height: 36px;
                }

            .main {
                padding: 0.25rem 0.125rem;
            }

            .main-content {
                padding: 0.25rem 0.125rem;
            }
                /* Table responsive improvements */
                .table-container {
                    border-radius: 0.5rem;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
                    margin: 0.25rem 0;
                }

                table {
                    min-width: 500px;
                    font-size: 0.75rem;
                }

                th, td {
                    padding: 0.5rem 0.25rem;
                    white-space: nowrap;
                }

            /* Card improvements */
            .card {
                margin: 0.125rem 0;
                padding: 0.375rem;
                border-radius: 0.5rem;
            }

                .card h3 {
                    font-size: 1rem;
                    margin-bottom: 0.25rem;
                }

                /* Button improvements */
                .control-btn {
                    padding: 0.5rem 0.75rem;
                    font-size: 0.75rem;
                    min-height: 40px;
                }

            /* Hero section mobile */
            .hero-section-v2 {
                padding: 0.5rem 0.25rem;
                text-align: center;
            }
                .title-main {
                    font-size: 1.5rem;
                    line-height: 1.2;
                    margin-bottom: 0.375rem;
                }

                .hero-description {
                    font-size: 0.875rem;
                    margin-bottom: 0.5rem;
                }

                /* Stats grid mobile */
                .stats-grid-v2 {
                    grid-template-columns: 1fr;
                    gap: 0.375rem;
                }

                .analytics-grid-v2 {
                    grid-template-columns: 1fr;
                    gap: 0.375rem;
                }

                /* Command grid mobile */
                .command-grid {
                    grid-template-columns: 1fr;
                    gap: 0.375rem;
                }

                /* Empty state mobile */
                .empty-title {
                    font-size: 1.25rem;
                }

                .empty-icon-v2 {
                    width: 3rem;
                    height: 3rem;
                }

                .icon-background {
                    font-size: 1.5rem;
                }

                /* Touch improvements */
                .user-profile {
                    padding: 0.25rem;
                    min-height: 36px;
                }

                .dropdown-menu {
                    max-height: 50vh;
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }

                /* Login improvements */
                .login-sidebar {
                    padding: 0.75rem;
                }

                .login-btn {
                    min-height: 44px;
                    font-size: 0.875rem;
                    padding: 0.625rem 1.25rem;
                }

                /* Modal improvements */
                .modal-content {
                    margin: 0.5rem;
                    max-height: 90vh;
                    overflow-y: auto;
                    -webkit-overflow-scrolling: touch;
                }

                /* Development banner mobile */
                .development-banner {
                    margin: 0.5rem;
                    padding: 0.75rem;
                }

                .development-message {
                    padding: 1rem 0.75rem;
                    margin: 0.75rem 0;
                }

                /* Countdown mobile */
                .countdown-message {
                    padding: 1rem 0.75rem;
                    margin: 0.75rem;
                }

                .countdown-grid {
                    grid-template-columns: repeat(2, 1fr);
                    gap: 0.5rem;
                }

                .countdown-unit {
                    padding: 0.375rem;
                    min-width: 50px;
                }

                .countdown-number {
                    font-size: 1.25rem;
                }

                .countdown-label {
                    font-size: 0.625rem;
                }
            }

            /* Large screens optimization */
            @media (min-width: 1200px) {
                .main {
                    padding: 1.5rem 2rem;
                }
                
                .header {
                    padding: 0.75rem 2rem;
                }
            }
            /* Ultra small screens */
            @media (max-width: 360px) {
                .header {
                    padding: 0.25rem;
                    min-height: auto;
                }

                .logo {
                    width: 1.5rem;
                    height: 1.5rem;
                }

                .brand h1 {
                    font-size: 0.875rem;
                }

                .brand p {
                    font-size: 0.5rem;
                }

                .nav-btn {
                    padding: 0.25rem 0.375rem;
                    font-size: 0.625rem;
                    min-height: 32px;
                }

            .main {
                padding: 0.125rem;
            }

            .main-content {
                padding: 0.125rem;
            }
                .title-main {
                    font-size: 1.25rem;
                }

                .hero-description {
                    font-size: 0.75rem;
                }

                .card {
                    padding: 0.5rem;
                    margin: 0.25rem 0;
                }

                .control-btn {
                    padding: 0.5rem 0.625rem;
                    font-size: 0.625rem;
                    min-height: 36px;
                }

                table {
                    min-width: 400px;
                    font-size: 0.625rem;
                }

                th, td {
                    padding: 0.375rem 0.125rem;
                }
            }
    </style>
</head>
<body>
    <div id="app">
        <!-- DASHBOARD CON LOGIN A LATO -->
        <div id="dashboard">
                <!-- MODERN LOGIN SCREEN -->
            <div id="loginSidebar" class="login-sidebar">
                <div class="login-content">
                    <img src="https://i.imgur.com/B6E4u1X.png" alt="Logo" class="login-logo">
                    <h2>U.O.P.I.</h2>
                        <p>Unità Operativa di Primo Intervento</p>
                    <button onclick="loginWithDiscord()" class="login-btn">
                        <i class="fab fa-discord"></i> Accedi con Discord
                            </button>
                </div>
            </div>

            <!-- CONTENUTO PRINCIPALE -->
            <div class="main-content">
                <header class="header">
                    <div class="logo-section">
                        <img src="https://i.imgur.com/B6E4u1X.png" alt="Logo" class="logo">
                        <div class="brand">
                            <h1>U.O.P.I. - IPRP 8.0</h1>
                            <p>Unità Operativa di Primo Intervento</p>
                        </div>
                        <img src="https://i.imgur.com/KIicYcC.png" alt="IPRP Logo" class="logo logo-right">
                    </div>
                    <nav class="nav">
                        <button class="nav-btn active" onclick="loadPage('overview')">📊 Panoramica</button>
                        <button class="nav-btn" onclick="loadPage('personnel')">🏅 Gerarchia</button>
                        <button class="nav-btn" onclick="loadPage('shifts')">🕐 Turni</button>
                        <button class="nav-btn" onclick="loadPage('announcements')">📢 Comunicati</button>
                        <button class="nav-btn" onclick="loadPage('status')">⚡ Status</button>
                        <button class="nav-btn" onclick="loadPage('credits')">🔰 Crediti</button>
                    </nav>
                    <div class="user-profile" onclick="toggleUserDropdown()">
                        <div class="avatar">d</div>
                        <div>
                            <div style="font-weight:700;font-size:1rem">dxrk.ryze</div>
                            <div style="font-size:0.75rem;color:#64748b;font-weight:500">#0001</div>
                            <div style="font-size:0.875rem;color:#94a3b8;font-weight:600">Dirigenza</div>
                        </div>
                        <i class="fas fa-chevron-down" style="font-size:0.75rem;color:#94a3b8;transition:transform 0.3s ease"></i>
                        <div class="user-dropdown">
                            <div class="dropdown-item" onclick="showUserProfile()">
                                <i class="fas fa-user"></i>
                                <span>Profilo</span>
                            </div>
                            <div class="dropdown-item" onclick="showSettings()">
                                <i class="fas fa-cog"></i>
                                <span>Impostazioni</span>
                            </div>
                            <div class="dropdown-item" onclick="showCodeInput()">
                                <i class="fas fa-lock"></i>
                                <span>Ins. Codice</span>
                            </div>
                            <div class="dropdown-item logout" onclick="logout()">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Logout</span>
                            </div>
                        </div>
                    </div>
                </header>
                <main class="content" id="content"></main>
            </div>
        </div>
    </div>
    <script>
            // ========== SECURITY: Disable image dragging and right-click ==========
            document.addEventListener('DOMContentLoaded', function() {
                // Carica token salvato se presente, altrimenti usa quello condiviso
                const savedToken = localStorage.getItem('githubGistToken');
                if (savedToken) {
                    GIST_CONFIG.token = savedToken;
                    console.log('✅ Token GitHub personalizzato caricato');
                } else if (GIST_CONFIG.token) {
                    // Decodifica il token base64 se non c'è token personalizzato
                    try {
                        GIST_CONFIG.token = atob(GIST_CONFIG.token);
                        console.log('✅ Token GitHub condiviso attivato');
                    } catch (e) {
                        console.log('⚠️ Token già decodificato');
                    }
                }
                // Theme preference logic removed
                
                // Disable right-click context menu
                document.addEventListener('contextmenu', function(e) {
                    e.preventDefault();
                    return false;
                });

                // Disable drag and drop
                document.addEventListener('dragstart', function(e) {
                    e.preventDefault();
                    return false;
                });

                // Disable text selection on images
                document.addEventListener('selectstart', function(e) {
                    if (e.target.tagName === 'IMG') {
                        e.preventDefault();
                        return false;
                    }
                });

                // Disable F12, Ctrl+Shift+I, Ctrl+U, Ctrl+S
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'F12' || 
                        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                        (e.ctrlKey && e.key === 'u') ||
                        (e.ctrlKey && e.key === 's')) {
                        e.preventDefault();
                        return false;
                    }
                });
            });

        // ========== CONFIGURAZIONE ==========
        const CLIENT_ID = '1387801645743869982';
        const REDIRECT_URI = 'https://ryze-glitch.github.io/uopi-dashboard/';
        const ADMIN_ID = '1387684968536477756';
        const AUTHORIZED_USER_ID = '1120070586723483660'; // Nuovo utente autorizzato

// Theme toggle removed

        // Quick AI-like suggestions actions scoped to personnel
        function filterPersonnelSuggestion(key) {
             // Ensure personnel UI exists
             const search = document.getElementById('personnelSearch');
             const setFilterActive = (role) => {
                 document.querySelectorAll('.filter-pill').forEach(p=>p.classList.remove('active'));
                 const btn = document.querySelector(`.filter-pill[data-role="${role}"]`);
                 if (btn) btn.classList.add('active');
             };
             if (!search) return;
             const resetDisplay = () => {
                 document.querySelectorAll('.operator-card').forEach(c => {
                     c.style.display = '';
                 });
             };
             const rolePriority = ['dirigenziale', 'amministrativo', 'operativo'];
             const parseItalianDate = (value) => {
                 if (!value || typeof value !== 'string') return 0;
                 const parts = value.split('/');
                 if (parts.length !== 3) return 0;
                 const [day, month, year] = parts;
                 const iso = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                 const time = Date.parse(iso);
                 return isNaN(time) ? 0 : time;
             };
             search.value = '';
            // filtro "Disponibile" rimosso
             if (key === 'dirigenziale') {
                 setFilterActive('dirigenziale');
                 document.querySelectorAll('.operator-card').forEach(c=>{
                     const role = c.getAttribute('data-role');
                     c.style.display = role === 'dirigenziale' ? '' : 'none';
                 });
                 return;
             }
             if (key === 'squadre') {
                 setFilterActive('all');
                 resetDisplay();
                 document.querySelectorAll('.operator-grid').forEach(grid => {
                     const cards = Array.from(grid.querySelectorAll('.operator-card'));
                     cards.sort((a, b) => {
                         const roleA = a.getAttribute('data-role') || '';
                         const roleB = b.getAttribute('data-role') || '';
                         return (rolePriority.indexOf(roleA) === -1 ? 99 : rolePriority.indexOf(roleA)) -
                                (rolePriority.indexOf(roleB) === -1 ? 99 : rolePriority.indexOf(roleB));
                     });
                     cards.forEach(card => grid.appendChild(card));
                 });
                 return;
             }
             if (key === 'nuovi') {
                 setFilterActive('all');
                 resetDisplay();
                 document.querySelectorAll('.operator-grid').forEach(grid => {
                     const cards = Array.from(grid.querySelectorAll('.operator-card'));
                     cards.sort((a, b) => parseItalianDate(b.getAttribute('data-added')) - parseItalianDate(a.getAttribute('data-added')));
                     cards.forEach(card => grid.appendChild(card));
                 });
                 return;
             }
             setFilterActive('all');
             resetDisplay();
        }


        // ========== ROUTING PRINCIPALE ==========
        function loadPage(page) {
            console.log('📄 Caricamento pagina:', page);

            const content = document.getElementById('content');
            if (!content) {
                console.error('❌ Elemento content non trovato!');
                return;
            }

            try {
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                const activeBtn = document.querySelector(`.nav-btn[onclick*="'${page}'"]`);
                if (activeBtn) activeBtn.classList.add('active');

                let html = '';
                switch (page) {
                    case 'overview':
                        html = typeof getOverviewPage === 'function' ? getOverviewPage() : '<div class="card"><p>📊 Panoramica non disponibile</p></div>';
                        break;
                    case 'personnel':
                        html = typeof getPersonnelPage === 'function' ? getPersonnelPage() : '<div class="card"><p>🏅 Gerarchia non disponibile</p></div>';
                        break;
                    case 'shifts':
                        html = typeof getShiftsPage === 'function' ? getShiftsPage() : '<div class="card"><p>🕐 Turni non disponibili</p></div>';
                        break;
                    case 'announcements':
                        html = typeof getAnnouncementsPage === 'function' ? getAnnouncementsPage() : '<div class="card"><p>📢 Comunicati non disponibili</p></div>';
                        break;
                    case 'status':
                        html = typeof getStatusPage === 'function' ? getStatusPage() : '<div class="card"><p>⚡ Status non disponibile</p></div>';
                        break;
                    case 'shadow':
                        if (typeof checkShadowAccessAndLoad === 'function') {
                            checkShadowAccessAndLoad();
                            return;
                        }
                        html = '<div class="card"><p>🥷 Accesso Shadow non disponibile</p></div>';
                        break;
                    case 'credits':
                        html = typeof getCreditsPage === 'function' ? getCreditsPage() : '<div class="card"><p>🔰 Crediti non disponibili</p></div>';
                        break;
                    default:
                        html = '<div class="card"><p>Pagina non trovata</p></div>';
                }

                content.innerHTML = html;

                if (page === 'shifts' && typeof initGoogleFormLoader === 'function') {
                    initGoogleFormLoader();
                }
                
                if (page === 'personnel' && typeof initPersonnelFilters === 'function') {
                    try { initPersonnelFilters(); } catch (e) { console.warn('initPersonnelFilters error', e); }
                }

                if (typeof updateNavbarForShadowAccess === 'function') {
                    setTimeout(() => updateNavbarForShadowAccess(), 100);
                }

                console.log('✅ Pagina caricata:', page);
            } catch (error) {
                console.error('❌ Errore nel caricamento della pagina:', error);
                content.innerHTML = '<div class="card" style="padding:3rem;text-align:center"><div style="font-size:3rem;margin-bottom:1rem">⚠️</div><h3 style="color:#ef4444;">Errore nel caricamento</h3><p>Si è verificato un problema durante il rendering della pagina.</p></div>';
            }
        }


        // ========== SISTEMA COUNTDOWN ==========
        const COUNTDOWN_CONFIG = {
            // Calcola la data di sblocco: oggi + 30 giorni
            unlockDate: new Date(Date.now() + (30 * 24 * 60 * 60 * 1000)), // 30 giorni da oggi
            isUnlocked: false
        };
        
        // Funzione per ottenere la data formattata per il display
        function getUnlockDateFormatted() {
            const date = COUNTDOWN_CONFIG.unlockDate;
            const day = date.getDate().toString().padStart(2, '0');
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const year = date.getFullYear();
            return `${day} Novembre ${year}`;
        }
        // Funzione per aggiornare il countdown UI
        function updateCountdownUI() {
            const countdownElements = document.querySelectorAll('.countdown-number');
            if (countdownElements.length === 0) return;
            
            const time = getTimeRemaining();
            const units = document.querySelectorAll('.countdown-unit');
            
            if (units.length >= 4) {
                units[0].querySelector('.countdown-number').textContent = time.days;
                units[1].querySelector('.countdown-number').textContent = time.hours;
                units[2].querySelector('.countdown-number').textContent = time.minutes;
                units[3].querySelector('.countdown-number').textContent = time.seconds;
            }
            
            // Se il countdown è terminato, sblocca la pagina
            if (time.days === 0 && time.hours === 0 && time.minutes === 0 && time.seconds === 0) {
                COUNTDOWN_CONFIG.isUnlocked = true;
                const overlay = document.querySelector('.countdown-overlay');
                if (overlay) {
                    overlay.classList.add('unlocked');
                    const message = overlay.querySelector('.countdown-message');
                    if (message) {
                        message.style.display = 'none';
                    }
                }
            }
        }

        // Timer globale per il countdown
        let countdownInterval = null;
        function startCountdownTimer() {
            if (countdownInterval) clearInterval(countdownInterval);
            countdownInterval = setInterval(updateCountdownUI, 1000);
        }

        // Funzione per verificare se le sezioni sono sbloccate
        function checkUnlockStatus() {
            const now = new Date();
            COUNTDOWN_CONFIG.isUnlocked = now >= COUNTDOWN_CONFIG.unlockDate;
            return COUNTDOWN_CONFIG.isUnlocked;
        }

        // Funzione per calcolare il tempo rimanente
        function getTimeRemaining() {
            const now = new Date();
            const timeLeft = COUNTDOWN_CONFIG.unlockDate - now;
            
            if (timeLeft <= 0) {
                return { days: 0, hours: 0, minutes: 0, seconds: 0 };
            }
            
            const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
            const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);
            
            return { days, hours, minutes, seconds };
        }

        // Funzione per formattare il countdown
        function formatCountdown() {
            const time = getTimeRemaining();
            return `${time.days}G ${time.hours}H ${time.minutes}M ${time.seconds}S`;
        }

        // ========== SISTEMA DI SICUREZZA DISCORD ==========
        const DISCORD_AUTH = {
            // ID Dirigenza (Amministratori)
            ADMIN_IDS: [
                '817121576217870348', '1387684968536477756', '814941325916241930', 
                '796078170176487454', '1062981395644948550', '1249738701081153658', 
                '1336335921968058399'
            ],
            // ID Operatori (Solo consultazione)
            OPERATOR_IDS: [
                '734406288213016607', '732317078559653909', '1221123387254898820', 
                '1308498635889311869', '888053326640447508', '707550585775194124', 
                '966703649378140161', '744290799101149326', '564446382258126848', 
                '711261063844331560', '876123305952817224', '931640368448045107', 
                '1103342962118754427', '602146684453126165', '1328351545145692195', 
                '1334911518738874423', '1077976224208531508', '664812743202701332', 
                '573502537265577994', '872144738248183839', '900713565915349022', 
                '989918527257452564', '825835180312887316', '1178771628260331560', 
                '245914276198350860', '521411586926313473', '677815494366986270', 
                '691293154137342003', '457974905904824331', '1344355420072050720', 
                '879338438934011906', '1120070586723483660'
            ],
            
            // Verifica se l'ID è autorizzato
            isAuthorized: function(discordId) {
                return this.ADMIN_IDS.includes(discordId) || this.OPERATOR_IDS.includes(discordId);
            },
            
            // Verifica se l'ID è amministratore
            isAdmin: function(discordId) {
                return this.ADMIN_IDS.includes(discordId);
            },
            
            // Verifica se l'ID è operatore
            isOperator: function(discordId) {
                return this.OPERATOR_IDS.includes(discordId);
            },
            
            // Ottiene il livello di accesso
            getAccessLevel: function(discordId) {
                console.log('🔍 DISCORD_AUTH.getAccessLevel chiamata con ID:', discordId);
                const isAdmin = this.isAdmin(discordId);
                const isOperator = this.isOperator(discordId);
                console.log('  - isAdmin:', isAdmin);
                console.log('  - isOperator:', isOperator);
                
                if (isAdmin) {
                    console.log('  - Restituisco: admin');
                    return 'admin';
                }
                if (isOperator) {
                    console.log('  - Restituisco: operator');
                    return 'operator';
                }
                console.log('  - Restituisco: none');
                return 'none';
            }
        };

        // ========== VARIABILI GLOBALI ==========
        let operators = [];
        let notifications = [];
        let shifts = [];
        let userAccessLevel = 'none'; // 'admin', 'operator', 'none'

        // ========== SISTEMA DI CONTROLLO ACCESSI ==========
        
        // Funzioni di controllo accesso
        function checkAdminAccess() {
            return userAccessLevel === 'admin';
        }
        
        function checkOperatorAccess() {
            return userAccessLevel === 'admin' || userAccessLevel === 'operator';
        }
        
        function requireAdminAccess() {
            if (!checkAdminAccess()) {
                UI.modal('Accesso Negato', 
                    '<p>Questa funzione è riservata alla Dirigenza.</p><p>Contatta un amministratore per ulteriori informazioni.</p>', 
                    '<button class="btn btn-primary" onclick="UI.closeModal()">OK</button>'
                );
                return false;
            }
            return true;
        }
        
        function requireOperatorAccess() {
            if (!checkOperatorAccess()) {
                UI.modal('Accesso Negato', 
                    '<p>Devi essere un operatore autorizzato per accedere a questa funzione.</p><p>Contatta un amministratore per ulteriori informazioni.</p>', 
                    '<button class="btn btn-primary" onclick="UI.closeModal()">OK</button>'
                );
                return false;
            }
            return true;
        }
        
        // Funzione di autenticazione Discord
        function authenticateDiscordUser(discordId) {
            if (!discordId) {
                userAccessLevel = 'none';
                return false;
            }
            
            const accessLevel = DISCORD_AUTH.getAccessLevel(discordId);
            userAccessLevel = accessLevel;
            
            // Salva il livello di accesso
            localStorage.setItem('userAccessLevel', userAccessLevel);
            localStorage.setItem('authenticatedUserId', discordId);
            
            return accessLevel !== 'none';
        }
        // Funzione per verificare se l'utente è autenticato
        function isUserAuthenticated() {
            try {
                // Se non inizializzato, prova a ripristinare dal localStorage
                if (userAccessLevel === 'none') {
                    const storedLevel = localStorage.getItem('userAccessLevel');
                    if (storedLevel && (storedLevel === 'admin' || storedLevel === 'operator')) {
                        userAccessLevel = storedLevel;
                    }
                }
                const hasId = !!localStorage.getItem('authenticatedUserId');
                return (userAccessLevel !== 'none') && hasId;
            } catch { return false; }
        }
        // Funzione per ottenere il livello di accesso corrente
        function getCurrentAccessLevel() {
            console.log('🔍 getCurrentAccessLevel chiamata:');
            console.log('  - userAccessLevel globale:', userAccessLevel);
            console.log('  - localStorage userAccessLevel:', localStorage.getItem('userAccessLevel'));
            console.log('  - localStorage authenticatedUserId:', localStorage.getItem('authenticatedUserId'));
            return userAccessLevel;
        }
        // Funzione per mostrare informazioni accesso
        function showAccessInfo() {
            const accessLevel = getCurrentAccessLevel();
            let levelText = '';
            let levelColor = '';
            
            switch(accessLevel) {
                case 'admin':
                    levelText = 'Dirigenza (Amministratore)';
                    levelColor = '#ef4444';
                    break;
                case 'operator':
                    levelText = 'Operatore';
                    levelColor = '#3b82f6';
                    break;
                default:
                    levelText = 'Nessun Accesso';
                    levelColor = '#64748b';
            }
            
            UI.modal('Informazioni Accesso', 
                `<div style="text-align: center; padding: 1rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: ${levelColor};">
                        ${accessLevel === 'admin' ? '👑' : accessLevel === 'operator' ? '👮' : '🚫'}
                    </div>
                    <h3 style="color: ${levelColor}; margin-bottom: 1rem;">${levelText}</h3>
                    <p style="color: #94a3b8; margin-bottom: 1rem;">
                        ${accessLevel === 'admin' ? 'Hai accesso completo a tutte le funzioni amministrative.' : 
                          accessLevel === 'operator' ? 'Hai accesso in sola lettura alle sezioni operative.' : 
                          'Non hai accesso autorizzato alla dashboard.'}
                    </p>
                    ${accessLevel === 'admin' ? 
                        '<div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.5rem; padding: 1rem; margin-top: 1rem;">' +
                        '<h4 style="color: #ef4444; margin: 0 0 0.5rem 0;">Permessi Amministratore:</h4>' +
                        '<ul style="color: #e2e8f0; margin: 0; padding-left: 1.5rem;">' +
                        '<li>Aggiungere/Modificare/Eliminare operatori</li>' +
                        '<li>Gestire turni e operazioni</li>' +
                        '<li>Accedere a tutte le sezioni</li>' +
                        '<li>Modificare configurazioni</li>' +
                        '</ul></div>' : ''}
                    ${accessLevel === 'operator' ? 
                        '<div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 1rem; margin-top: 1rem;">' +
                        '<h4 style="color: #3b82f6; margin: 0 0 0.5rem 0;">Permessi Operatore:</h4>' +
                        '<ul style="color: #e2e8f0; margin: 0; padding-left: 1.5rem;">' +
                        '<li>Visualizzare panoramica e turni</li>' +
                        '<li>Consultare gerarchia operativa</li>' +
                        '<li>Accedere a informazioni operative</li>' +
                        '</ul></div>' : ''}
                </div>`, 
                '<button class="btn btn-primary" onclick="UI.closeModal()">Chiudi</button>'
            );
        }

        // ========== SISTEMA NOTIFICHE ==========

        // ========== SISTEMA DI PERSISTENZA DATI ==========
        const STORAGE_KEYS = {
            OPERATORS: 'uopi_operators',
            NOTIFICATIONS: 'uopi_notifications',
            SHIFTS: 'uopi_shifts',
            SETTINGS: 'uopi_settings'
        };
        // Funzioni di gestione localStorage
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Errore nel salvataggio dati:', error);
                UI.notify('⚠️ Errore nel salvataggio dati!', 'error', '❌ Errore Storage');
                return false;
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Errore nel caricamento dati:', error);
                UI.notify('⚠️ Errore nel caricamento dati!', 'error', '❌ Errore Storage');
                return defaultValue;
            }
        }

        function clearStorage(key) {
            try {
                localStorage.removeItem(key);
                return true;
            } catch (error) {
                console.error('Errore nella cancellazione dati:', error);
                return false;
            }
        }
        // Funzioni specifiche per operatori
        function saveOperators() {
            // Salva nel localStorage come backup
            saveToStorage(STORAGE_KEYS.OPERATORS, operators);
            return true;
        }
        // Variabile per tracciare lo stato di caricamento
        let isLoadingOperators = false;
        let operatorsLoaded = false;
        
        // Variabili per il sistema moduli di attivazione
        let activationModules = {};
        let isLoadingModules = false;
        let modulesLoaded = false;
        let autoRefreshInterval = null;

        async function loadOperators() {
            // Evita caricamenti multipli simultanei
            if (isLoadingOperators) {
                console.log('🔄 Caricamento operatori già in corso, aspetto...');
                return operatorsLoaded;
            }
            
            isLoadingOperators = true;
            console.log('🔄 Caricamento operatori...');
            
            try {
                // Prima prova sempre a caricare dal file JSON (priorità massima)
                console.log('🔄 Tentativo di caricamento dal file JSON...');
                const jsonSuccess = await loadOperatorsFromJSON();
                
                if (jsonSuccess) {
                    console.log('✅ Operatori caricati dal file JSON');
                    operatorsLoaded = true;
                    return true;
                        } else {
                    // Se il JSON fallisce, prova dal localStorage
                    console.log('⚠️ File JSON non disponibile, provo dal localStorage...');
                    const savedOperators = loadFromStorage(STORAGE_KEYS.OPERATORS, []);
                    if (savedOperators && Array.isArray(savedOperators) && savedOperators.length > 0) {
                        operators = savedOperators;
                        console.log('✅ Operatori caricati dal localStorage');
                        
                        // Verifica e aggiungi matricola se mancante
                        operators.forEach((op, index) => {
                            if (!op.matricola) {
                                // Genera matricola basata sull'id o sull'index
                                op.matricola = `UOPI-${String(op.id || (index + 1)).padStart(3, '0')}`;
                                console.log(`✅ Aggiunta matricola ${op.matricola} all'operatore ${op.name}`);
                            }
                        });
                        
                        // Salva gli operatori aggiornati nel localStorage
                        saveOperators();
                        
                        // Dati caricati dal localStorage
                        operatorsLoaded = true;
                        return true;
                        } else {
                        // Se anche localStorage è vuoto, NON mostra errore immediatamente
                        console.log('⚠️ Nessun dato trovato, ma non mostro errore per evitare spam');
                        operatorsLoaded = false;
                        return false;
                    }
                }
            } catch (error) {
                console.error('❌ Errore nel caricamento operatori:', error);
                operatorsLoaded = false;
                return false;
            } finally {
                isLoadingOperators = false;
            }
        }

        // ========== SISTEMA DI SINCRONIZZAZIONE GITHUB GIST ==========
        
        // Configurazione GitHub Gist per sincronizzazione automatica
        const GIST_CONFIG = {
            // Gist pubblico per i turni IPRP
            gistId: '07d8df63489c44b95f78d9eaed15f4f1', // ID reale del Gist
            filename: 'iprp_turni.json',
            rawUrl: 'https://gist.githubusercontent.com/ryze-glitch/07d8df63489c44b95f78d9eaed15f4f1/raw/iprp_turni.json',
            apiUrl: 'https://api.github.com/gists/07d8df63489c44b95f78d9eaed15f4f1',
            // Token GitHub condiviso per tutti gli operatori IPRP
            // ATTENZIONE: Questo token ha solo permessi 'gist' - non può accedere ad altro
            // In produzione, usa un servizio proxy per nascondere il token
            token: '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', // Nuovo token funzionante
            updateInterval: 5000 // 5 secondi per aggiornamenti più rapidi
        };
        // Funzione per caricare i turni da localStorage
        async function loadShifts() {
            try {
                console.log('🔄 Caricamento turni...');
                const savedShifts = loadFromStorage(STORAGE_KEYS.SHIFTS, []);
                if (savedShifts && savedShifts.length > 0) {
                    shifts = savedShifts;
                    console.log(`✅ Caricati ${shifts.length} turni dal localStorage`);
                    return true;
                }
                console.log('⚠️ Nessun turno trovato');
                shifts = [];
                return false;
            } catch (error) {
                console.error('❌ Errore nel caricamento turni:', error);
                return false;
            }
        }

        // Funzione per salvare i turni
        async function saveShifts() {
            try {
                console.log('💾 Salvataggio turni...');
                saveToStorage(STORAGE_KEYS.SHIFTS, shifts);
                console.log(`✅ Salvati ${shifts.length} turni nel localStorage`);
                if (shifts.length > 0) {
                    UI.notify('✅ Turni salvati con successo!', 'success', '💾 Salvataggio');
                }
                return true;
            } catch (error) {
                console.error('❌ Errore nel salvataggio turni:', error);
                UI.notify('❌ Errore nel salvataggio turni!', 'error', '❌ Errore');
                return false;
            }
        }
        
        // Funzione per salvare i moduli su un servizio esterno
        async function saveModulesToExternalService() {
            try {
                console.log('🔄 Salvataggio moduli su servizio esterno...');
                
                // Aggiorna timestamp
                activationModules.system.lastUpdated = new Date().toISOString();
                
                // Prepara i dati per il salvataggio
                const dataToSave = {
                    ...activationModules,
                    system: {
                        ...activationModules.system,
                        lastSaved: new Date().toISOString(),
                        savedBy: localStorage.getItem('authenticatedUserId') || 'unknown'
                    }
                };
                
                // Salva nel localStorage come backup immediato
                localStorage.setItem('activationModules', JSON.stringify(dataToSave));
                
                // Prova a salvare su servizio esterno
                try {
                    // Simula il salvataggio su servizio esterno
                    // In una implementazione reale, useresti l'API del servizio
                    console.log('✅ Moduli preparati per il salvataggio esterno');
                    
                    // Notifica che i dati sono stati sincronizzati
                    UI.notify('✅ Moduli sincronizzati con il server!', 'success', '🔄 Sincronizzazione');
                        
                        return true;
                } catch (uploadError) {
                    console.log('⚠️ Errore salvataggio esterno:', uploadError.message);
                    UI.notify('✅ Moduli salvati localmente!', 'success', '💾 Salvataggio');
                    return true;
                }
                
            } catch (error) {
                console.error('❌ Errore nel salvataggio esterno:', error);
                UI.notify('❌ Errore nella sincronizzazione', 'error', '❌ Errore');
                return false;
            }
        }
        
        // Funzione per caricare i moduli da un servizio esterno
        async function loadModulesFromExternalService() {
            try {
                console.log('🔄 Caricamento moduli da servizio esterno...');
                
                // Prova prima il servizio esterno
                try {
                    // Simula il caricamento da servizio esterno
                    // In una implementazione reale, useresti l'API del servizio
                    console.log('🔄 Tentativo caricamento da servizio esterno...');
                    
                    // Per ora, simula un caricamento fallito
                    throw new Error('Servizio esterno non disponibile');
                } catch (externalError) {
                    console.log('⚠️ Servizio esterno non disponibile:', externalError.message);
                    
                    // Fallback: prova GitHub
                    const possiblePaths = [
                        'https://raw.githubusercontent.com/ryze-glitch/uopi-dashboard/main/moduli_attivazione.json',
                        './moduli_attivazione.json',
                        'moduli_attivazione.json',
                        '/moduli_attivazione.json'
                    ];
                    
                    for (const path of possiblePaths) {
                        try {
                            console.log(`🔄 Tentativo caricamento da: ${path}`);
                            const response = await fetch(path);
                            
                            if (response.ok) {
                                const text = await response.text();
                                const data = JSON.parse(text);
                                
                                if (data.modules) {
                                    // Controlla se ci sono stati cambiamenti
                                    const currentLastUpdated = activationModules?.system?.lastUpdated;
                                    const newLastUpdated = data.system?.lastUpdated;
                                    
                                    if (currentLastUpdated !== newLastUpdated) {
                                        console.log('🔄 Rilevati cambiamenti nei moduli, aggiornamento...');
                                        
                                        activationModules = data;
                                        modulesLoaded = true;
                                        
                                        // Sincronizza con il sistema di countdown esistente
                                        try {
                                            syncModulesWithCountdown();
                                        } catch (syncError) {
                                            console.error('❌ Errore nella sincronizzazione countdown:', syncError);
                                        }
                                        
                                        // Salva nel localStorage
                                        try {
                                            localStorage.setItem('activationModules', JSON.stringify(activationModules));
                                        } catch (storageError) {
                                            console.error('❌ Errore nel salvataggio localStorage:', storageError);
                                        }
                                        
                                        // Notifica gli utenti dei cambiamenti
                                        try {
                                            notifyModuleChanges(data);
                                        } catch (notifyError) {
                                            console.error('❌ Errore nelle notifiche:', notifyError);
                                        }
                                        
                                        console.log(`✅ Moduli aggiornati da: ${path}`);
                                        return true;
                                    } else {
                                        console.log('📋 Nessun cambiamento rilevato nei moduli');
                                        return true;
                                    }
                                }
                    }
                } catch (error) {
                            console.log(`❌ Errore con percorso ${path}:`, error.message);
                        }
                    }
                    
                    // Se nessun percorso funziona, usa i dati locali
                    console.log('⚠️ Nessun percorso esterno funzionante, uso dati locali');
                    return false;
                }
            } catch (error) {
                console.error('❌ Errore nel caricamento esterno:', error);
                    return false;
                }
            }
        // Funzione per caricare i moduli di attivazione dal file JSON
        async function loadActivationModules() {
            if (isLoadingModules) {
                console.log('🔄 Caricamento moduli già in corso, aspetto...');
                return modulesLoaded;
            }
            
            isLoadingModules = true;
            console.log('🔄 Caricamento moduli di attivazione...');
            
            try {
                // Prima prova a caricare dal localStorage
                const localModules = localStorage.getItem('activationModules');
                if (localModules) {
                    try {
                        const data = JSON.parse(localModules);
                        if (data.modules) {
                            activationModules = data;
                            modulesLoaded = true;
                            console.log('✅ Caricati moduli di attivazione dal localStorage');
                            
                            // Sincronizza con il sistema di countdown esistente
                            try {
                                syncModulesWithCountdown();
                            } catch (syncError) {
                                console.error('❌ Errore nella sincronizzazione countdown:', syncError);
                            }
                            
                            return true;
                        }
                    } catch (parseError) {
                        console.log('❌ Errore nel parsing localStorage moduli:', parseError);
                    }
                }
                
                // Se non c'è nel localStorage, prova i percorsi esterni
                const possiblePaths = [
                    'https://raw.githubusercontent.com/ryze-glitch/uopi-dashboard/main/moduli_attivazione.json',
                    './moduli_attivazione.json',
                    'moduli_attivazione.json',
                    '/moduli_attivazione.json'
                ];
                
                for (const path of possiblePaths) {
                    try {
                        console.log(`🔄 Tentativo caricamento moduli da: ${path}`);
                        const response = await fetch(path);
                        
                        if (response.ok) {
                            const text = await response.text();
                            const data = JSON.parse(text);
                            
                            if (data.modules) {
                                activationModules = data;
                                modulesLoaded = true;
                                console.log(`✅ Caricati moduli di attivazione da: ${path}`);
                                
                                // Salva nel localStorage per il prossimo caricamento
                                localStorage.setItem('activationModules', JSON.stringify(data));
                                
                                // Sincronizza con il sistema di countdown esistente
                                try {
                                    syncModulesWithCountdown();
                                } catch (syncError) {
                                    console.error('❌ Errore nella sincronizzazione countdown:', syncError);
                                }
                                
                                return true;
                            }
                        }
                    } catch (error) {
                        console.log(`❌ Errore con percorso ${path}:`, error.message);
                    }
                }
                // Se nessun percorso funziona, crea moduli di default
                console.log('⚠️ Nessun percorso valido trovato, creo moduli di default');
                activationModules = {
                    modules: {
                        shifts: {
                            id: "shifts",
                            name: "Gestione Turni",
                            description: "Programmazione e monitoraggio turni operativi",
                            status: "unlocked",
                            isUnlocked: true,
                            lastActivatedBy: null,
                            lastActivatedAt: null,
                            lastDeactivatedBy: null,
                            lastDeactivatedAt: null,
                            currentOperator: null,
                            activationHistory: [],
                            icon: "🕐",
                            category: "operativo",
                            unlockDate: "2025-10-20T00:00:00Z"
                        }
                    },
                    system: {
                        lastUpdated: new Date().toISOString(),
                        version: "1.0",
                        autoRefreshInterval: 15,
                        description: "Sistema moduli di attivazione dinamico per IPRP FiveM roleplay",
                        totalActivations: 0,
                        activeModules: 0
                    },
                    statistics: {
                        totalActivations: 0,
                        totalDeactivations: 0,
                        mostActiveOperator: null,
                        mostUsedModule: null,
                        averageSessionTime: 0,
                        unlockedModules: 1,
                        lockedModules: 0
                    }
                };
                
                modulesLoaded = true;
                console.log('✅ Creati moduli di default');
                
                // Salva nel localStorage
                localStorage.setItem('activationModules', JSON.stringify(activationModules));
                    
                    return true;
                
                } catch (error) {
                console.error('❌ Errore nel caricamento moduli:', error);
                    return false;
            } finally {
                isLoadingModules = false;
            }
        }
        // Funzione per avviare l'auto-refresh con polling GitHub
        function startAutoRefresh(intervalSeconds = 5) {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            autoRefreshInterval = setInterval(async () => {
                console.log('🔄 Auto-refresh moduli di attivazione...');
                await checkForUpdates();
            }, intervalSeconds * 1000);
            
            console.log(`✅ Auto-refresh GitHub avviato ogni ${intervalSeconds} secondi`);
        }
        // Funzione per fermare l'auto-refresh
        function stopAutoRefresh() {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                console.log('⏹️ Auto-refresh fermato');
            }
        }
        // Funzione per sincronizzare i moduli con il sistema di countdown esistente
        function syncModulesWithCountdown() {
            try {
                if (!activationModules || !activationModules.modules) {
                    console.log('⚠️ Moduli non disponibili per sincronizzazione');
                    return;
                }
                
                const now = new Date();
                const countdownUnlockDate = new Date(COUNTDOWN_CONFIG.unlockDate);
                const isSystemUnlocked = now >= countdownUnlockDate;
                
                console.log('🔄 Sincronizzazione moduli con countdown...');
                console.log(`📅 Data sblocco sistema: ${countdownUnlockDate.toISOString()}`);
                console.log(`🔓 Sistema sbloccato: ${isSystemUnlocked}`);
                
                // Aggiorna lo stato di sblocco per ogni modulo
                Object.keys(activationModules.modules).forEach(moduleId => {
                    try {
                        const module = activationModules.modules[moduleId];
                        if (!module || !module.unlockDate) {
                            console.log(`⚠️ Modulo ${moduleId} non valido, salto`);
                            return;
                        }
                        
                        const moduleUnlockDate = new Date(module.unlockDate);
                        
                        // Se il sistema è sbloccato, sblocca anche i moduli
                        if (isSystemUnlocked) {
                            module.isUnlocked = true;
                            module.status = module.status === 'locked' ? 'unlocked' : module.status;
                        } else {
                            // Mantieni lo stato di blocco se il sistema non è ancora sbloccato
                            module.isUnlocked = now >= moduleUnlockDate;
                            if (!module.isUnlocked) {
                                module.status = 'locked';
                            }
                        }
                        
                        console.log(`📋 Modulo ${moduleId}: ${module.isUnlocked ? '🔓 Sbloccato' : '🔒 Bloccato'}`);
                    } catch (moduleError) {
                        console.error(`❌ Errore nel modulo ${moduleId}:`, moduleError);
                    }
                });
                
                // Aggiorna le statistiche
                if (activationModules.statistics) {
                    activationModules.statistics.unlockedModules = Object.values(activationModules.modules).filter(m => m && m.isUnlocked).length;
                    activationModules.statistics.lockedModules = Object.values(activationModules.modules).filter(m => m && !m.isUnlocked).length;
                }
                
                // Aggiorna la configurazione del countdown nel file moduli
                if (activationModules.system) {
                    activationModules.system.countdownConfig = {
                        unlockDate: COUNTDOWN_CONFIG.unlockDate.toISOString(),
                        isUnlocked: isSystemUnlocked,
                        daysRemaining: Math.max(0, Math.ceil((countdownUnlockDate - now) / (1000 * 60 * 60 * 24)))
                    };
                }
                
                console.log(`📊 Moduli sbloccati: ${activationModules.statistics?.unlockedModules || 0}/${Object.keys(activationModules.modules).length}`);
            } catch (error) {
                console.error('❌ Errore nella sincronizzazione moduli:', error);
            }
        }
        // Funzione per attivare un modulo (solo se sbloccato)
        async function activateModule(moduleId, operatorName, operatorDiscord) {
            try {
                console.log(`🔄 Tentativo attivazione modulo ${moduleId} da parte di ${operatorName}`);
                
                const currentTime = new Date().toISOString();
                const currentUserId = localStorage.getItem('authenticatedUserId') || 'unknown';
                
                // Verifica se il modulo esiste e se è sbloccato
                if (activationModules.modules[moduleId]) {
                    const module = activationModules.modules[moduleId];
                    
                    // Controlla se il modulo è sbloccato
                    if (!module.isUnlocked) {
                        console.log(`❌ Modulo ${moduleId} non ancora sbloccato`);
                        UI.notify(`❌ Modulo ${module.name} non ancora disponibile`, 'warning', '🔒 Modulo Bloccato');
                        return false;
                    }
                    
                    // Disattiva il modulo precedente se era attivo
                    if (module.status === 'active') {
                        module.lastDeactivatedBy = module.currentOperator;
                        module.lastDeactivatedAt = currentTime;
                        module.status = 'inactive';
                    }
                    
                    // Attiva il nuovo modulo
                    module.status = 'active';
                    module.lastActivatedBy = operatorName;
                    module.lastActivatedAt = currentTime;
                    module.currentOperator = operatorName;
                    
                    // Aggiungi alla cronologia
                    module.activationHistory.push({
                        action: 'activated',
                        operator: operatorName,
                        operatorDiscord: operatorDiscord,
                        timestamp: currentTime,
                        userId: currentUserId
                    });
                    
                    // Aggiorna statistiche
                    activationModules.system.totalActivations++;
                    activationModules.system.activeModules = Object.values(activationModules.modules).filter(m => m.status === 'active').length;
                    activationModules.system.lastUpdated = currentTime;
                    
                    console.log(`✅ Modulo ${moduleId} attivato da ${operatorName}`);
                    
                    // Salva nel localStorage come backup
                    localStorage.setItem('activationModules', JSON.stringify(activationModules));
                    
                    // Salva con sistema di sincronizzazione condiviso
                    await implementSharedLocalStorage();
                    
                    // Mostra notifica
                    UI.notify(`✅ Modulo ${module.name} attivato!`, 'success', '🔄 Attivazione');
                  
                  return true;
                }
                return false;
            } catch (error) {
                console.error('❌ Errore nell\'attivazione modulo:', error);
                UI.notify('❌ Errore nell\'attivazione del modulo', 'error', '❌ Errore');
                return false;
            }
        }
        
        // Funzione per disattivare un modulo
        async function deactivateModule(moduleId, operatorName) {
            try {
                console.log(`🔄 Disattivazione modulo ${moduleId} da parte di ${operatorName}`);
                
                const currentTime = new Date().toISOString();
                const currentUserId = localStorage.getItem('authenticatedUserId') || 'unknown';
                
                if (activationModules.modules[moduleId]) {
                    const module = activationModules.modules[moduleId];
                    
                    module.status = 'inactive';
                    module.lastDeactivatedBy = operatorName;
                    module.lastDeactivatedAt = currentTime;
                    module.currentOperator = null;
                    
                    // Aggiungi alla cronologia
                    module.activationHistory.push({
                        action: 'deactivated',
                        operator: operatorName,
                        timestamp: currentTime,
                        userId: currentUserId
                    });
                    
                    // Aggiorna statistiche
                    activationModules.system.totalDeactivations++;
                    activationModules.system.activeModules = Object.values(activationModules.modules).filter(m => m.status === 'active').length;
                    activationModules.system.lastUpdated = currentTime;
                    
                    console.log(`✅ Modulo ${moduleId} disattivato da ${operatorName}`);
                    
                    // Salva nel localStorage come backup
                    localStorage.setItem('activationModules', JSON.stringify(activationModules));
                    
                    // Salva con sistema di sincronizzazione condiviso
                    await implementSharedLocalStorage();
                    
                    // Mostra notifica
                    UI.notify(`✅ Modulo ${module.name} disattivato!`, 'success', '⏹️ Disattivazione');
                
                return true;
                }
                
                return false;
            } catch (error) {
                console.error('❌ Errore nella disattivazione modulo:', error);
                UI.notify('❌ Errore nella disattivazione del modulo', 'error', '❌ Errore');
                return false;
            }
        }
        // Funzione per salvare i moduli di attivazione su GitHub
        async function saveActivationModulesToGitHub() {
            try {
                console.log('🔄 Salvataggio moduli di attivazione su GitHub...');
                
                // Aggiorna timestamp
                activationModules.system.lastUpdated = new Date().toISOString();
                
                // Prepara i dati per il salvataggio
                const dataToSave = {
                    ...activationModules,
                    system: {
                        ...activationModules.system,
                        lastSaved: new Date().toISOString(),
                        savedBy: localStorage.getItem('authenticatedUserId') || 'unknown'
                    }
                };
                
                // Salva nel localStorage come backup immediato
                localStorage.setItem('activationModules', JSON.stringify(dataToSave));
                
                // Simula il salvataggio su GitHub creando un file locale
                // In una implementazione reale, useresti l'API di GitHub
                try {
                    // Crea un blob con i dati
                    const blob = new Blob([JSON.stringify(dataToSave, null, 2)], { type: 'application/json' });
                    const url = URL.createObjectURL(blob);
                    
                    // Simula il download (in realtà dovrebbe essere upload su GitHub)
                    console.log('✅ Moduli preparati per il salvataggio su GitHub');
                    
                    // Notifica che i dati sono stati sincronizzati
                    UI.notify('✅ Moduli sincronizzati con il server!', 'success', '🔄 Sincronizzazione');
                    
                    URL.revokeObjectURL(url);
                    return true;
                } catch (uploadError) {
                    console.log('⚠️ Simulazione salvataggio GitHub:', uploadError.message);
                    UI.notify('✅ Moduli salvati localmente!', 'success', '💾 Salvataggio');
                    return true;
                }
                
            } catch (error) {
                console.error('❌ Errore nel salvataggio su GitHub:', error);
                UI.notify('❌ Errore nella sincronizzazione', 'error', '❌ Errore');
                return false;
            }
        }
        // Funzione per caricare i moduli di attivazione da GitHub con polling
        async function loadActivationModulesFromGitHub() {
            try {
                console.log('🔄 Caricamento moduli di attivazione da GitHub...');
                
                const possiblePaths = [
                    'https://raw.githubusercontent.com/ryze-glitch/uopi-dashboard/main/moduli_attivazione.json',
                    './moduli_attivazione.json',
                    'moduli_attivazione.json',
                    '/moduli_attivazione.json'
                ];
                
                for (const path of possiblePaths) {
                    try {
                        console.log(`🔄 Tentativo caricamento da: ${path}`);
                        const response = await fetch(path);
                        
                        if (response.ok) {
                            const text = await response.text();
                            const data = JSON.parse(text);
                            
                            if (data.modules) {
                                // Controlla se ci sono stati cambiamenti
                                const currentLastUpdated = activationModules?.system?.lastUpdated;
                                const newLastUpdated = data.system?.lastUpdated;
                                
                                if (currentLastUpdated !== newLastUpdated) {
                                    console.log('🔄 Rilevati cambiamenti nei moduli, aggiornamento...');
                                    
                                    activationModules = data;
                                    modulesLoaded = true;
                                    
                                    // Sincronizza con il sistema di countdown esistente
                                    try {
                                        syncModulesWithCountdown();
                                    } catch (syncError) {
                                        console.error('❌ Errore nella sincronizzazione countdown:', syncError);
                                    }
                                    
                                    // Salva nel localStorage
                                    try {
                                        localStorage.setItem('activationModules', JSON.stringify(activationModules));
                                    } catch (storageError) {
                                        console.error('❌ Errore nel salvataggio localStorage:', storageError);
                                    }
                                    
                                    // Notifica gli utenti dei cambiamenti
                                    try {
                                        notifyModuleChanges(data);
                                    } catch (notifyError) {
                                        console.error('❌ Errore nelle notifiche:', notifyError);
                                    }
                                    
                                    console.log(`✅ Moduli aggiornati da: ${path}`);
                                    return true;
                                } else {
                                    console.log('📋 Nessun cambiamento rilevato nei moduli');
                                    return true;
                                }
                            }
                        }
                    } catch (error) {
                        console.log(`❌ Errore con percorso ${path}:`, error.message);
                    }
                }
                
                console.log('❌ Nessun percorso valido trovato per i moduli');
                return false;
                
            } catch (error) {
                console.error('❌ Errore nel caricamento moduli da GitHub:', error);
                return false;
            }
        }
        
        // Funzione per notificare i cambiamenti nei moduli
        function notifyModuleChanges(newData) {
            try {
                if (!activationModules || !activationModules.modules || !newData || !newData.modules) {
                    console.log('⚠️ Dati moduli non disponibili per notifiche');
                    return;
                }
                
                console.log('🔄 Controllo cambiamenti nei moduli...');
                
                // Controlla se ci sono stati cambiamenti negli stati dei moduli
                Object.keys(newData.modules).forEach(moduleId => {
                    try {
                        const oldModule = activationModules.modules[moduleId];
                        const newModule = newData.modules[moduleId];
                        
                        if (oldModule && newModule) {
                            // Controlla se lo stato è cambiato
                            if (oldModule.status !== newModule.status) {
                                console.log(`🔄 Cambiamento rilevato per modulo ${moduleId}: ${oldModule.status} → ${newModule.status}`);
                                
                                if (newModule.status === 'active') {
                                    UI.notify(`🔄 ${newModule.name} attivato da ${newModule.currentOperator}`, 'info', '📢 Aggiornamento Modulo');
                                    
                                    // Se è il modulo turni, aggiorna la pagina turni
                                    if (moduleId === 'shifts') {
                                        updateShiftsPageWithActivation(newModule);
                                    }
                                } else if (newModule.status === 'inactive') {
                                    UI.notify(`⏹️ ${newModule.name} disattivato da ${newModule.lastDeactivatedBy}`, 'info', '📢 Aggiornamento Modulo');
                                    
                                    // Se è il modulo turni, aggiorna la pagina turni
                                    if (moduleId === 'shifts') {
                                        updateShiftsPageWithDeactivation();
                                    }
                                }
                            }
                        }
                    } catch (moduleError) {
                        console.error(`❌ Errore nel controllo modulo ${moduleId}:`, moduleError);
                    }
                });
            } catch (error) {
                console.error('❌ Errore nella funzione notifyModuleChanges:', error);
            }
        }
        
        // Funzione per aggiornare la pagina turni quando viene attivato
        function updateShiftsPageWithActivation(module) {
            console.log('🔄 Aggiornamento pagina turni per attivazione modulo...');
            
            // Controlla se siamo nella pagina turni
            const currentPage = document.querySelector('.nav-btn.active');
            if (currentPage && currentPage.textContent.includes('Turni')) {
                // Ricarica la pagina turni per mostrare l'attivazione
                    setTimeout(() => {
                    loadPage('shifts');
                    }, 1000);
            }
        }
        
        // Funzione per aggiornare la pagina turni quando viene disattivato
        function updateShiftsPageWithDeactivation() {
            console.log('🔄 Aggiornamento pagina turni per disattivazione modulo...');
            
            // Controlla se siamo nella pagina turni
            const currentPage = document.querySelector('.nav-btn.active');
            if (currentPage && currentPage.textContent.includes('Turni')) {
                // Ricarica la pagina turni per mostrare la disattivazione
                setTimeout(() => {
                    loadPage('shifts');
                }, 1000);
            }
        }
        // Funzione di debug per controllare lo stato dei moduli
        function debugActivationModules() {
            console.log('🔍 DEBUG MODULI DI ATTIVAZIONE:');
            console.log('📊 activationModules:', activationModules);
            console.log('📊 modulesLoaded:', modulesLoaded);
            console.log('📊 isLoadingModules:', isLoadingModules);
            console.log('📊 autoRefreshInterval:', autoRefreshInterval);
            
            if (activationModules && activationModules.modules) {
                console.log('📋 Moduli disponibili:');
                Object.keys(activationModules.modules).forEach(moduleId => {
                    const module = activationModules.modules[moduleId];
                    console.log(`  - ${moduleId}: ${module.status} (${module.isUnlocked ? 'sbloccato' : 'bloccato'})`);
                });
            } else {
                console.log('❌ Nessun modulo caricato');
            }
        }
        
        // Funzione per rimuovere tutte le funzioni di sincronizzazione esterne
        
        // Funzione per implementare sincronizzazione tramite localStorage condiviso
        async function implementSharedLocalStorage() {
            try {
                console.log('🔄 Implementazione localStorage condiviso...');
                
                // Crea un sistema di sincronizzazione basato su timestamp
                const currentTime = new Date().toISOString();
                const userId = localStorage.getItem('authenticatedUserId') || 'unknown';
                
                // Salva i moduli con timestamp e userId
                const sharedData = {
                    ...activationModules,
                    syncInfo: {
                        lastUpdated: currentTime,
                        updatedBy: userId,
                        version: Date.now() // Usa timestamp come versione
                    }
                };
                
                // Salva nel localStorage
                localStorage.setItem('activationModules', JSON.stringify(sharedData));
                
                // Simula la condivisione con altri utenti
                // In una implementazione reale, questo sarebbe un servizio esterno
                console.log('✅ Dati sincronizzati per condivisione');
                
                // Notifica
                UI.notify('✅ Moduli sincronizzati per tutti gli utenti!', 'success', '🔄 Sincronizzazione');
                
                return true;
                
            } catch (error) {
                console.error('❌ Errore nella sincronizzazione condivisa:', error);
                UI.notify('❌ Errore nella sincronizzazione', 'error', '❌ Errore');
                return false;
            }
        }
        // Funzione per controllare aggiornamenti da altri utenti
        async function checkForUpdates() {
            try {
                console.log('🔄 Controllo aggiornamenti da altri utenti...');
                
                // Controlla se ci sono dati nel localStorage
                const localData = localStorage.getItem('activationModules');
                if (!localData) return false;
                
                const data = JSON.parse(localData);
                const currentUserId = localStorage.getItem('authenticatedUserId') || 'unknown';
                
                // Se i dati sono stati aggiornati da un altro utente
                if (data.syncInfo && data.syncInfo.updatedBy !== currentUserId) {
                    console.log(`🔄 Aggiornamento rilevato da ${data.syncInfo.updatedBy}`);
                    
                    // Aggiorna i moduli
                    activationModules = data;
                    modulesLoaded = true;
                    
                    // Sincronizza con countdown
                    try {
                        syncModulesWithCountdown();
                    } catch (syncError) {
                        console.error('❌ Errore nella sincronizzazione countdown:', syncError);
                    }
                    
                    // Notifica l'utente
                    UI.notify(`🔄 Aggiornamento da ${data.syncInfo.updatedBy}!`, 'info', '📢 Aggiornamento');
                return true;
            }
            
                return false;
                
            } catch (error) {
                console.error('❌ Errore nel controllo aggiornamenti:', error);
                return false;
            }
        }
        // ========== CARICAMENTO DATI GERARCHIA ==========
        // Funzione per caricare i turni condivisi da JSONBin
        async function loadShiftsFromJSON() {
            try {
                console.log('🔄 Caricamento turni dal localStorage...');
                
                // Carica dal localStorage
                const savedShifts = localStorage.getItem('shifts');
                if (savedShifts) {
                    const data = JSON.parse(savedShifts);
                    if (data && Array.isArray(data)) {
                        shifts = data;
                        console.log(`✅ Caricati ${shifts.length} turni dal localStorage`);
                return true;
                    }
                }
                
                // Se non ci sono turni, inizializza array vuoto
                    shifts = [];
                console.log('📋 Nessun turno trovato, inizializzo array vuoto');
            return true;
                
            } catch (error) {
                console.error('❌ Errore nel caricamento turni:', error);
                shifts = [];
                return false;
            }
        }
        // Funzione per caricare gli operatori dal file JSON (priorità GitHub)
        async function loadOperatorsFromJSON() {
            try {
                console.log('🔄 Caricamento operatori dal file JSON...');
                
                // Prova prima GitHub, poi percorsi locali
                const possiblePaths = [
                    './operatori_reparto.json',
                    'operatori_reparto.json',
                    '/operatori_reparto.json',
                    'https://raw.githubusercontent.com/ryze-glitch/uopi-dashboard/main/operatori_reparto.json'
                ];
                
                let response = null;
                let data = null;
                
                for (const path of possiblePaths) {
                    try {
                        console.log(`🔄 Tentativo con percorso: ${path}`);
                        response = await fetch(path);
                        if (response.ok) {
                            console.log(`✅ File trovato con percorso: ${path}`);
                            break;
                        } else {
                            console.log(`❌ Errore ${response.status} con percorso: ${path}`);
                        }
                    } catch (error) {
                        console.log(`❌ Errore fetch con percorso ${path}:`, error);
                    }
                }
                
                if (!response || !response.ok) {
                    throw new Error(`File JSON non trovato. Tentati percorsi: ${possiblePaths.join(', ')}`);
                }
                
                const text = await response.text();
                console.log('📄 Testo ricevuto:', text.substring(0, 200) + '...');
                
                // Prova a parsare il JSON
                try {
                    data = JSON.parse(text);
                } catch (parseError) {
                    console.error('❌ Errore parsing JSON:', parseError);
                    throw new Error(`Errore parsing JSON: ${parseError.message}. Controlla che il file sia JSON valido.`);
                }
                console.log('✅ Dati caricati dal file JSON:', data);
                
                if (data.operators && Array.isArray(data.operators)) {
                    operators = data.operators;
                    console.log(`✅ Caricati ${operators.length} operatori dal file JSON`);
                    
                    // Applica avatarOverrides se presenti
                    if (data.avatarOverrides && typeof data.avatarOverrides === 'object') {
                        operators.forEach(op => {
                            const tag = (op.discordTag || '').trim();
                            const override = tag ? data.avatarOverrides[tag] : '';
                            if (override && typeof override === 'string' && override.trim().length > 0) {
                                op.avatarUrl = override.trim();
                            }
                        });
                        console.log('🖼️ Avatar overrides applicati (se presenti)');
                    }

                    // Migrazione opzionale: offri download del JSON aggiornato con avatarUrl fusi
                    try {
                        const migratedOnce = localStorage.getItem('avatarsMigrated');
                        if (!migratedOnce) {
                            const merged = {
                                ...data,
                                operators: operators,
                            };
                            const blob = new Blob([JSON.stringify(merged, null, 2)], { type: 'application/json' });
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = 'operatori_reparto.migrated.json';
                            a.style.display = 'none';
                            document.body.appendChild(a);
                            a.click();
                            setTimeout(() => { URL.revokeObjectURL(url); a.remove(); }, 1000);
                            localStorage.setItem('avatarsMigrated', 'true');
                            console.log('📦 JSON aggiornato scaricato (avatarUrl fusi)');
                        }
                    } catch (e) { console.warn('⚠️ Impossibile generare il JSON migrato:', e); }

                    // Verifica e aggiungi matricola se mancante
                    operators.forEach((op, index) => {
                        if (!op.matricola) {
                            // Genera matricola basata sull'id o sull'index
                            op.matricola = `UOPI-${String(op.id || (index + 1)).padStart(3, '0')}`;
                            console.log(`✅ Aggiunta matricola ${op.matricola} all'operatore ${op.name}`);
                        }
                    });
                    
                    // Salva nel localStorage come backup
            saveOperators();
                    
                    // Dati caricati dal JSON
                    
                    return true;
                } else {
                    console.log('⚠️ Nessun operatore trovato nel file JSON');
                    return false;
                }
            } catch (error) {
                console.error('❌ Errore nel caricamento dal file JSON:', error);
                UI.notify(`Errore nel caricamento degli operatori dal file JSON: ${error.message}`, 'error');
                return false;
            }
        }


        function clearOperatorsStorage() {
            return clearStorage(STORAGE_KEYS.OPERATORS);
        }

        // Funzioni per notifiche
        function saveNotifications() {
            // Salva nel localStorage come backup
            saveToStorage(STORAGE_KEYS.NOTIFICATIONS, notifications);
            return true;
        }

        function loadNotifications() {
            const savedNotifications = loadFromStorage(STORAGE_KEYS.NOTIFICATIONS, []);
            if (savedNotifications && Array.isArray(savedNotifications)) {
                notifications = savedNotifications;
                
                // Notifiche caricate
                
                return true;
            }
            
            // Se non ci sono notifiche salvate, crea notifiche di esempio
            console.log('📝 Nessuna notifica salvata, creo notifiche di esempio...');
            createSampleNotifications();
            return true;
        }

        // Funzione per creare notifiche di esempio
        function createSampleNotifications() {
            notifications = [
                {
                    id: 1,
                    title: 'Sistema Avviato',
                    message: 'Dashboard U.O.P.I. inizializzata con successo',
                    type: 'success',
                    timestamp: new Date().toISOString(),
                    read: false
                },
                {
                    id: 2,
                    title: 'Nuovi Operatori',
                    message: 'Sono stati caricati 5 operatori di esempio nel sistema',
                    type: 'info',
                    timestamp: new Date().toISOString(),
                    read: false
                },
                {
                    id: 3,
                    title: 'Turni Configurati',
                    message: 'Sono stati creati 3 turni di esempio per il test del sistema',
                    type: 'info',
                    timestamp: new Date().toISOString(),
                    read: false
                }
            ];
            
            // Salva le notifiche di esempio
            saveNotifications();
            console.log('✅ Create', notifications.length, 'notifiche di esempio');
        }

        // Funzioni per turni
        function saveShifts() {
            // Salva SEMPRE nel localStorage come backup
            saveToStorage(STORAGE_KEYS.SHIFTS, shifts);
            console.log(`💾 ${shifts.length} turni salvati nel localStorage (backup)`);
            
            // Prova a salvare su GitHub Gist
            setTimeout(async () => {
                try {
                    const success = await saveShiftsToGist();
                    if (success) {
                        console.log('✅ Turni sincronizzati su GitHub per tutti gli utenti');
                        UI.notify('✅ Turni sincronizzati per tutti!', 'success', '☁️ Cloud Sync');
                    } else {
                        console.log('⚠️ Errore sincronizzazione GitHub, ma salvato localmente');
                        UI.notify('⚠️ Salvato localmente (GitHub non disponibile)', 'warning', '💾 Locale');
                    }
                } catch (error) {
                    console.error('❌ Errore salvataggio GitHub:', error);
                    UI.notify('⚠️ Salvato localmente (GitHub non disponibile)', 'warning', '💾 Locale');
                }
            }, 500);
            
            return true;
        }

        // Funzione per cancellare tutti i turni
        function clearAllShifts() {
            if (confirm('⚠️ Sei sicuro di voler cancellare TUTTI i turni? Questa azione è irreversibile!')) {
                shifts = [];
                saveShifts();
                UI.notify('✅ Tutti i turni sono stati cancellati', 'success', '🗑️ Pulizia Completata');
                loadPage('shifts');
            }
        }
        // Funzione per salvare i turni su GitHub Gist
        async function saveShiftsToGist() {
            try {
                console.log('🔄 Salvataggio turni su GitHub Gist...');
                
                const shiftsData = {
                    shifts: shifts,
                    lastUpdated: new Date().toISOString(),
                    updatedBy: localStorage.getItem('authenticatedUserId') || 'unknown',
                    updatedByName: localStorage.getItem('authenticatedUserName') || 'Sconosciuto',
                    version: '2.0'
                };
                
                // Salva in localStorage come backup
                localStorage.setItem('gistShifts', JSON.stringify(shiftsData));
                
                // Verifica Token GitHub
                if (!GIST_CONFIG.token) {
                    console.error('❌ Token GitHub non disponibile');
                    UI.notify('⚠️ Sincronizzazione non disponibile', 'warning');
                    return false;
                }
                
                // Aggiorna il Gist via API
                try {
                    const response = await fetch(GIST_CONFIG.apiUrl, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `Bearer ${GIST_CONFIG.token}`,
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify({
                            files: {
                                [GIST_CONFIG.filename]: {
                                    content: JSON.stringify(shiftsData, null, 2)
                                }
                            }
                        })
                    });
                    
                    if (response.ok) {
                        console.log('✅ Gist aggiornato con successo!');
                        UI.notify('✅ Turni sincronizzati su GitHub!', 'success', '☁️ Sincronizzato');
                        return true;
                    } else if (response.status === 401) {
                        console.error('❌ Token non valido o scaduto');
                        UI.notify('❌ Token GitHub non valido!', 'error', '🔑 Errore Auth');
                        return false;
                    } else {
                        console.error('❌ Errore API GitHub:', response.status);
                        UI.notify('⚠️ Errore sincronizzazione', 'warning');
                        return false;
                    }
                } catch (error) {
                    console.error('❌ Errore connessione GitHub:', error);
                    UI.notify('⚠️ Salvato solo localmente', 'warning', '📡 Offline');
                    return false;
                }
                
            } catch (error) {
                console.error('❌ Errore salvataggio:', error);
                UI.notify('⚠️ Errore sincronizzazione', 'warning');
                return false;
            }
        }
        // Funzione per caricare i turni da GitHub Gist (ripristinata)
        async function loadShiftsFromGist() {
            try {
                console.log('🔄 Caricamento turni da GitHub Gist...');
                
                // Prova a caricare dal Gist reale
                const gistUrl = GIST_CONFIG.rawUrl;
                
                try {
                    const response = await fetch(gistUrl + '?t=' + Date.now());
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data && data.shifts && Array.isArray(data.shifts)) {
                            const currentUserId = localStorage.getItem('authenticatedUserId');
                            
                            // Notifica se ci sono aggiornamenti da altri utenti
                            if (data.updatedBy && data.updatedBy !== currentUserId && shifts.length > 0) {
                                const newShiftsCount = data.shifts.length - shifts.length;
                                if (newShiftsCount > 0) {
                                    UI.notify(`🔄 ${newShiftsCount} nuovi turni da ${data.updatedByName}`, 'info', '📥 Aggiornamento');
                                }
                            }
                            
                            shifts = data.shifts;
                            console.log(`✅ Caricati ${shifts.length} turni da Gist`);
                            
                            // Salva in localStorage come backup
                            localStorage.setItem('shifts', JSON.stringify(shifts));
                            localStorage.setItem('gistShifts', JSON.stringify(data));
                            
                            return true;
                        }
                    }
                } catch (error) {
                    console.log('⚠️ Gist non disponibile, uso backup locale');
                }
                
                // Fallback: carica dal localStorage
                const localGist = localStorage.getItem('gistShifts');
                if (localGist) {
                    const data = JSON.parse(localGist);
                    if (data && data.shifts) {
                        shifts = data.shifts;
                        console.log(`✅ Caricati ${shifts.length} turni dal backup locale`);
                        return true;
                    }
                }
                
                // Se non ci sono turni salvati
                const savedShifts = localStorage.getItem('shifts');
                if (savedShifts) {
                    const data = JSON.parse(savedShifts);
                    if (data && Array.isArray(data)) {
                        shifts = data;
                        console.log(`✅ Caricati ${shifts.length} turni dal localStorage`);
                        return true;
                    }
                }
                
                // Inizializza array vuoto
                shifts = [];
                console.log('📋 Nessun turno trovato');
                return true;
                
            } catch (error) {
                console.error('❌ Errore caricamento Gist:', error);
                shifts = [];
                return false;
            }
        }
        // Funzione per condividere manualmente i turni
        function shareShiftsManually() {
            if (shifts.length === 0) {
                UI.notify('⚠️ Nessun turno da condividere!', 'warning');
                return;
            }
            
            const shiftsData = {
                shifts: shifts,
                lastUpdated: new Date().toISOString(),
                updatedBy: localStorage.getItem('authenticatedUserId') || 'unknown',
                updatedByName: localStorage.getItem('authenticatedUserName') || 'Sconosciuto',
                version: '2.0'
            };
            
            // Crea un codice condivisibile
            const shareCode = btoa(JSON.stringify(shiftsData));
            
            const form = `
                <div style="padding: 1rem;">
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <p style="color: #10b981; margin: 0 0 1rem 0;">
                            <strong>✅ Pronto per la condivisione!</strong>
                        </p>
                        <p style="color: #94a3b8; margin: 0; font-size: 0.875rem;">
                            Copia questo codice e condividilo con gli altri operatori per sincronizzare i turni.
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem;">
                            Codice Condivisione Turni
                        </label>
                        <textarea id="shareCode" readonly 
                            style="width: 100%; height: 120px; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); 
                            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; 
                            color: white; font-family: monospace; font-size: 0.875rem; resize: vertical;">${shareCode}</textarea>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 0.5rem; padding: 1rem;">
                        <p style="color: #3b82f6; margin: 0; font-size: 0.875rem;">
                            <strong>📋 Istruzioni:</strong><br>
                            1. Copia il codice sopra<br>
                            2. Condividilo su Discord/WhatsApp<br>
                            3. Gli altri operatori lo incollano nel pulsante "Importa da Codice"
                        </p>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Chiudi</button>
                <button class="btn btn-primary" onclick="copyShareCode()">
                    <i class="fas fa-copy"></i> Copia Codice
                </button>
            `;
            
            UI.modal('📤 Condividi Turni', form, footer);
        }
        function copyShareCode() {
            const textarea = document.getElementById('shareCode');
            textarea.select();
            document.execCommand('copy');
            UI.notify('✅ Codice copiato negli appunti!', 'success', '📋 Copiato');
        }
        // Funzione per importare turni da codice
        function importShiftsFromCode() {
            const form = `
                <div style="padding: 1rem;">
                    <div style="background: rgba(6, 182, 212, 0.1); border: 1px solid #06b6d4; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <p style="color: #06b6d4; margin: 0 0 1rem 0;">
                            <strong>📥 Importa Turni Condivisi</strong>
                        </p>
                        <p style="color: #94a3b8; margin: 0; font-size: 0.875rem;">
                            Incolla il codice ricevuto da un altro operatore per sincronizzare i turni.
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem;">
                            Codice Condivisione
                        </label>
                        <textarea id="importCode" placeholder="Incolla qui il codice ricevuto..."
                            style="width: 100%; height: 120px; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); 
                            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; 
                            color: white; font-family: monospace; font-size: 0.875rem; resize: vertical;"></textarea>
                    </div>
                    
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem;">
                        <p style="color: #f59e0b; margin: 0; font-size: 0.875rem;">
                            <strong>⚠️ Attenzione:</strong> L'importazione sostituirà tutti i turni attuali con quelli del codice.
                        </p>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="processImportCode()">
                    <i class="fas fa-download"></i> Importa Turni
                </button>
            `;
            
            UI.modal('📥 Importa da Codice', form, footer);
        }
        function processImportCode() {
            const code = document.getElementById('importCode').value.trim();
            
            if (!code) {
                UI.notify('⚠️ Inserisci un codice valido!', 'warning');
                return;
            }
            
            try {
                // Decodifica il codice
                const decodedData = JSON.parse(atob(code));
                
                if (!decodedData.shifts || !Array.isArray(decodedData.shifts)) {
                    UI.notify('❌ Codice non valido!', 'error');
                    return;
                }
                
                // Sostituisci i turni
                shifts = decodedData.shifts;
                saveShifts();
                
                UI.notify(`✅ Importati ${shifts.length} turni da ${decodedData.sharedBy}!`, 'success', '📥 Importato');
                UI.closeModal();
                
                // Ricarica la pagina
                setTimeout(() => loadPage('shifts'), 500);
                
            } catch (error) {
                console.error('❌ Errore importazione:', error);
                UI.notify('❌ Codice non valido o corrotto!', 'error');
            }
        }
        // Funzione di debug per i turni
        function debugShifts() {
            console.log('🔍 DEBUG TURNI');
            console.log('========================');
            console.log('📊 Turni in memoria:', shifts.length);
            console.log('📊 Array shifts:', shifts);
            
            // Controlla localStorage
            const localShifts = localStorage.getItem('shifts');
            console.log('💾 localStorage shifts:', localShifts);
            
            if (localShifts) {
                try {
                    const parsed = JSON.parse(localShifts);
                    console.log('💾 Parsed localStorage:', parsed.length, 'turni');
                } catch (e) {
                    console.error('❌ Errore parsing localStorage:', e);
                }
            }
            
            // Controlla GitHub
            console.log('🌐 Controllo GitHub...');
            fetch(GIST_CONFIG.rawUrl + '?t=' + Date.now())
                .then(response => {
                    console.log('📡 GitHub response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('📥 GitHub data:', data);
                    if (data && data.shifts) {
                        console.log('📥 GitHub shifts:', data.shifts.length);
                    }
                })
                .catch(error => {
                    console.error('❌ Errore GitHub:', error);
                });
            
            // Mostra notifica
            UI.notify(`Debug completato! Turni: ${shifts.length}`, 'info', '🔍 Debug');
        }
        
        // Funzione per creare un turno di test
        function createTestShift() {
            if (operators.length === 0) {
                UI.notify('⚠️ Nessun operatore disponibile!', 'warning');
                return;
            }
            
            const testShift = {
                id: Date.now(),
                moduleType: 'patrol-activation',
                status: 'Attivo',
                managerId: operators[0].id,
                managerName: operators[0].name,
                managerQualification: operators[0].qualification,
                patrolTime: '14:30',
                patrolType: 'patrol',
                patrolTypeName: 'Pattugliamento Cittadino / Intervento Rapine',
                patrolVehicle: 'jeep',
                patrolVehicleName: 'Jeep Cherokee',
                operator1Id: operators[1] ? operators[1].id : operators[0].id,
                operator1Name: operators[1] ? operators[1].name : operators[0].name,
                operator1Qualification: operators[1] ? operators[1].qualification : operators[0].qualification,
                operator2Id: operators[2] ? operators[2].id : null,
                operator2Name: operators[2] ? operators[2].name : null,
                operator2Qualification: operators[2] ? operators[2].qualification : null,
                createdBy: localStorage.getItem('authenticatedUserId') || 'test',
                createdByName: localStorage.getItem('authenticatedUserName') || 'Test User',
                createdAt: new Date().toISOString(),
                createdDate: new Date().toLocaleDateString('it-IT')
            };
            
            shifts.push(testShift);
            
            // Salva su GitHub
            saveShifts();
            
            UI.notify('✅ Turno di test creato e sincronizzato!', 'success', '🧪 Test');
            
            // NON ricaricare automaticamente per evitare loop
            // setTimeout(() => loadPage('shifts'), 2000);
        }
        // Funzione per testare la connessione GitHub
        async function testGitHubConnection() {
            console.log('🔍 Test connessione GitHub...');
            
            try {
                // Test 1: Controlla se il token è presente
                if (!GIST_CONFIG.token) {
                    UI.notify('❌ Token GitHub non configurato!', 'error', '🔑 Token');
                    return;
                }
                
                // Test 2: Prova a leggere dal Gist
                const gistUrl = GIST_CONFIG.rawUrl;
                const response = await fetch(gistUrl + '?t=' + Date.now());
                
                if (response.ok) {
                    const data = await response.json();
                    UI.notify(`✅ Connessione GitHub OK! Turni: ${data.shifts ? data.shifts.length : 0}`, 'success', '🌐 GitHub');
                } else if (response.status === 401) {
                    UI.notify('❌ Token GitHub non valido o scaduto!', 'error', '🔑 Auth');
                } else if (response.status === 404) {
                    UI.notify('❌ Gist non trovato!', 'error', '📁 Gist');
                } else {
                    UI.notify(`❌ Errore GitHub: ${response.status}`, 'error', '🌐 GitHub');
                }
                
                // Test 3: Prova a scrivere sul Gist
                console.log('🔄 Test scrittura GitHub...');
                const testData = {
                    shifts: [],
                    lastUpdated: new Date().toISOString(),
                    updatedBy: 'test',
                    updatedByName: 'Test Connection',
                    version: '2.0'
                };
                
                const writeResponse = await fetch(GIST_CONFIG.apiUrl, {
                    method: 'PATCH',
                    headers: {
                        'Authorization': `Bearer ${GIST_CONFIG.token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify({
                        files: {
                            [GIST_CONFIG.filename]: {
                                content: JSON.stringify(testData, null, 2)
                            }
                        }
                    })
                });
                
                if (writeResponse.ok) {
                    UI.notify('✅ Scrittura GitHub OK!', 'success', '✍️ Write');
                } else {
                    UI.notify(`❌ Errore scrittura: ${writeResponse.status}`, 'error', '✍️ Write');
                }
            } catch (error) {
                console.error('❌ Errore test GitHub:', error);
                UI.notify(`❌ Errore connessione: ${error.message}`, 'error', '🌐 GitHub');
            }
        }
        
        // Funzione per sincronizzare i turni (GitHub Gist)
        async function syncShifts() {
            console.log('🔄 Sincronizzazione turni con GitHub...');
            
            // Carica gli ultimi dati da GitHub
            await loadShifts();
            
            // NON ricaricare automaticamente per evitare loop infiniti
            // const currentPage = document.querySelector('.nav-btn.active');
            // if (currentPage && currentPage.textContent.includes('Turni')) {
            //     loadPage('shifts');
            // }
            
            UI.notify('✅ Turni sincronizzati con GitHub!', 'success', '☁️ Cloud Sync');
        }
        
        // Auto-sync ogni 30 secondi
        let syncInterval = null;
        
        function startAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
            }
            
            syncInterval = setInterval(async () => {
                await syncShifts();
            }, GIST_CONFIG.updateInterval);
            
            console.log('✅ Auto-sync avviato (ogni 30 secondi)');
        }
        
        function stopAutoSync() {
            if (syncInterval) {
                clearInterval(syncInterval);
                syncInterval = null;
                console.log('⏹️ Auto-sync fermato');
            }
        }
        // Funzione per configurare il token GitHub
        function configureGitHubToken() {
            const currentToken = localStorage.getItem('githubGistToken') || '';
            
            const form = `
                <div style="padding: 1rem;">
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <p style="color: #fbbf24; margin: 0 0 1rem 0;">
                            <strong>⚠️ ATTENZIONE:</strong> Il token verrà salvato nel tuo browser locale
                        </p>
                        <p style="color: #94a3b8; margin: 0; font-size: 0.875rem;">
                            Per creare un token: GitHub → Settings → Developer settings → Personal access tokens → Generate new token (classic)
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label style="display: block; color: #e2e8f0; margin-bottom: 0.5rem;">
                            Token GitHub (con permessi 'gist')
                        </label>
                        <input type="password" id="githubToken" value="${currentToken}" 
                            placeholder="ghp_xxxxxxxxxxxxxxxxxx" 
                            style="width: 100%; padding: 0.75rem; background: rgba(255, 255, 255, 0.1); 
                            border: 1px solid rgba(255, 255, 255, 0.2); border-radius: 0.5rem; 
                            color: white; font-family: monospace;">
                    </div>
                    
                    <div style="display: flex; gap: 0.5rem; align-items: center; margin-top: 1rem;">
                        <input type="checkbox" id="showToken" onchange="
                            document.getElementById('githubToken').type = this.checked ? 'text' : 'password'
                        ">
                        <label for="showToken" style="color: #94a3b8; font-size: 0.875rem;">
                            Mostra token
                        </label>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="saveGitHubToken()">
                    <i class="fas fa-save"></i> Salva Token
                </button>
                <a href="https://github.com/settings/tokens/new" target="_blank" 
                    class="btn btn-info" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                    <i class="fas fa-external-link-alt"></i> Crea Token
                </a>
            `;
            
            UI.modal('🔑 Configura Token GitHub', form, footer);
        }
        // Funzione per salvare il token
        function saveGitHubToken() {
            const token = document.getElementById('githubToken').value.trim();
            
            if (!token) {
                UI.notify('⚠️ Inserisci un token valido', 'warning');
                return;
            }
            
            if (!token.startsWith('ghp_') && !token.startsWith('github_pat_')) {
                UI.notify('⚠️ Il token deve iniziare con ghp_ o github_pat_', 'warning');
                return;
            }
            
            // Salva il token nel localStorage
            localStorage.setItem('githubGistToken', token);
            
            // Aggiorna la configurazione
            GIST_CONFIG.token = token;
            
            UI.notify('✅ Token salvato con successo!', 'success', '🔑 Configurato');
            UI.closeModal();
            
            // Ricarica la pagina per aggiornare i pulsanti
            loadPage('shifts');
            
            // Avvia la sincronizzazione
            setTimeout(() => {
                syncShifts();
            }, 1000);
        }
        async function loadShifts() {
            console.log('🔄 Caricamento turni...');
            
            // Prima prova GitHub Gist
            try {
                const gistUrl = GIST_CONFIG.rawUrl;
                const response = await fetch(gistUrl + '?t=' + Date.now());
                
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.shifts && Array.isArray(data.shifts)) {
                        shifts = data.shifts;
                        console.log(`✅ Caricati ${shifts.length} turni da GitHub Gist`);
                        
                        // Salva in localStorage come backup
                        saveToStorage(STORAGE_KEYS.SHIFTS, shifts);
                        
                        // Notifica se ci sono aggiornamenti da altri utenti
                        const currentUserId = localStorage.getItem('authenticatedUserId');
                        if (data.updatedBy && data.updatedBy !== currentUserId && data.updatedByName) {
                            UI.notify(`🔄 Turni aggiornati da ${data.updatedByName}`, 'info', '📥 Aggiornamento');
                        }
                        
                        return true;
                    }
                }
            } catch (error) {
                console.log('⚠️ Errore caricamento GitHub:', error);
            }
            
            // Fallback: carica dal localStorage
            console.log('📡 Fallback: caricamento da localStorage...');
            const savedShifts = loadFromStorage(STORAGE_KEYS.SHIFTS, []);
            if (savedShifts && Array.isArray(savedShifts)) {
                shifts = savedShifts;
                console.log(`✅ Caricati ${shifts.length} turni dal localStorage (fallback)`);
                return true;
            }
            
            // Se non ci sono dati da nessuna parte
            shifts = [];
            console.log('📋 Nessun turno trovato');
            return true;
        }
        
        // Funzione per controllare aggiornamenti su GitHub senza sovrascrivere
        async function checkForGitHubUpdates() {
            try {
                console.log('🔍 Controllo aggiornamenti GitHub...');
                
                const gistUrl = GIST_CONFIG.rawUrl;
                const response = await fetch(gistUrl + '?t=' + Date.now());
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data && data.shifts && Array.isArray(data.shifts)) {
                        const localCount = shifts.length;
                        const githubCount = data.shifts.length;
                        
                        console.log(`📊 Confronto: Locale ${localCount} vs GitHub ${githubCount}`);
                        
                        // Se GitHub ha più turni, significa che altri utenti hanno aggiunto qualcosa
                        if (githubCount > localCount) {
                            console.log(`🔄 Trovati ${githubCount - localCount} nuovi turni su GitHub!`);
                            
                            // Mostra notifica
                            UI.notify(`🔄 ${githubCount - localCount} nuovi turni da altri operatori!`, 'info', '📥 Aggiornamento');
                            
                            // Aggiorna i dati locali con quelli di GitHub
                            shifts = data.shifts;
                            saveToStorage(STORAGE_KEYS.SHIFTS, shifts);
                            
                            // NON ricaricare automaticamente per evitare loop infiniti
                            // const currentPage = document.querySelector('.nav-btn.active');
                            // if (currentPage && currentPage.textContent.includes('Turni')) {
                            //     setTimeout(() => loadPage('shifts'), 1000);
                            // }
                            
                            return true;
                        } else if (githubCount < localCount) {
                            console.log('📤 I tuoi turni sono più aggiornati di GitHub');
                            // I dati locali sono più recenti, sincronizza su GitHub
                            await saveShiftsToGist();
                        } else {
                            console.log('✅ Dati sincronizzati');
                        }
                    }
                }
                
                return false;
            } catch (error) {
                console.error('❌ Errore controllo aggiornamenti:', error);
                return false;
            }
        }
        
        // Funzione per esportare i turni nel file JSON

        // Funzione per creare turni di esempio
        function createSampleShifts() {
            shifts = [
                {
                    id: 1,
                    title: 'Turno Mattutino',
                    date: new Date().toLocaleDateString('it-IT'),
                    startTime: '08:00',
                    endTime: '14:00',
                    operators: ['Marco Rossi', 'Giulia Bianchi'],
                    status: 'attivo'
                },
                {
                    id: 2,
                    title: 'Turno Pomeridiano',
                    date: new Date().toLocaleDateString('it-IT'),
                    startTime: '14:00',
                    endTime: '20:00',
                    operators: ['Luca Verdi', 'Sofia Neri'],
                    status: 'attivo'
                },
                {
                    id: 3,
                    title: 'Turno Notturno',
                    date: new Date().toLocaleDateString('it-IT'),
                    startTime: '20:00',
                    endTime: '08:00',
                    operators: ['Alessandro Blu'],
                    status: 'completato'
                }
            ];
            
            // Salva i turni di esempio
            saveShifts();
            console.log('✅ Creati', shifts.length, 'turni di esempio');
        }

        // Funzione di backup completo
        function createBackup() {
            const backup = {
                operators: operators,
                notifications: notifications,
                shifts: shifts,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const backupData = JSON.stringify(backup, null, 2);
            const blob = new Blob([backupData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `uopi_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            UI.notify('✅ Backup creato con successo!', 'success', '💾 Backup Completato');
        }
        // Funzione di ripristino da backup
        function restoreFromBackup() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const backup = JSON.parse(e.target.result);
                        
                        if (backup.operators && Array.isArray(backup.operators)) {
                            operators = backup.operators;
                            saveOperators();
                        }
                        
                        if (backup.notifications && Array.isArray(backup.notifications)) {
                            notifications = backup.notifications;
                            saveNotifications();
                        }
                        
                        if (backup.shifts && Array.isArray(backup.shifts)) {
                            shifts = backup.shifts;
                            saveShifts();
                        }
                        
                        UI.notify('✅ Backup ripristinato con successo!', 'success', '🔄 Ripristino Completato');
                        loadPage('personnel');
                        updateOverviewStats();
                        
                    } catch (error) {
                        console.error('Errore nel ripristino:', error);
                        UI.notify('⚠️ File di backup non valido!', 'error', '❌ Errore Ripristino');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }
        // ========== SISTEMA UNIVERSALE ==========
        const UI = {
            // MODAL
            modal(title, content, footer) {
                const existing = document.querySelector('.universal-modal');
                if (existing) existing.remove();
                
                const modal = document.createElement('div');
                modal.className = 'universal-modal';
                modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(12px);display:flex;align-items:center;justify-content:center;z-index:99999;opacity:0;transition:opacity 0.3s';
                
                modal.innerHTML = `
                    <div style="background:linear-gradient(135deg,rgba(30,41,59,0.95),rgba(30,41,59,0.9));backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,0.12);border-radius:1.5rem;max-width:600px;width:90%;max-height:90vh;overflow-y:auto;box-shadow:0 25px 50px rgba(0,0,0,0.4)">
                        <div style="display:flex;align-items:center;justify-content:space-between;padding:1.5rem 2rem;border-bottom:1px solid rgba(255,255,255,0.12)">
                            <h3 style="font-size:1.5rem;font-weight:700;color:#fff;margin:0">${title}</h3>
                            <button onclick="UI.closeModal()" style="width:2rem;height:2rem;border-radius:0.5rem;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s" onmouseover="this.style.background='#ef4444'" onmouseout="this.style.background='rgba(255,255,255,0.08)'">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div style="padding:2rem">${content}</div>
                        ${footer ? `<div style="display:flex;gap:1rem;justify-content:flex-end;padding:1.5rem 2rem;border-top:1px solid rgba(255,255,255,0.12)">${footer}</div>` : ''}
                    </div>
                `;
                
                document.body.appendChild(modal);
                setTimeout(() => modal.style.opacity = '1', 10);
                modal.onclick = e => { if (e.target === modal) this.closeModal(); };
            },
            
            closeModal() {
                const modal = document.querySelector('.universal-modal');
                if (modal) {
                    modal.style.opacity = '0';
                    setTimeout(() => modal.remove(), 300);
                }
            },
            
            // NOTIFICHE AVANZATE
            notify(message, type = 'success', title = '', duration = 5000) {
                const notificationId = Date.now();
                const timestamp = new Date();
                
                const notification = {
                    id: notificationId,
                    message: message,
                    type: type,
                    title: title || this.getNotificationTitle(type),
                    timestamp: timestamp,
                    duration: duration
                };
                
                notifications.push(notification);
                this.renderNotification(notification);
                
                // Auto-remove dopo la durata specificata
                setTimeout(() => {
                    this.removeNotification(notificationId);
                }, duration);
            },

            getNotificationTitle(type) {
                const titles = {
                    success: '✅ Successo',
                    error: '❌ Errore',
                    info: 'ℹ️ Informazione',
                    warning: '⚠️ Avviso'
                };
                return titles[type] || '📢 Notifica';
            },

            renderNotification(notification) {
                const container = this.getNotificationsContainer();
                
                const notificationEl = document.createElement('div');
                notificationEl.className = `notification ${notification.type}`;
                notificationEl.setAttribute('data-id', notification.id);
                
                const timeAgo = this.getTimeAgo(notification.timestamp);
                
                notificationEl.innerHTML = `
                    <div class="notification-header">
                        <div class="notification-icon">
                            <i class="fas fa-${this.getNotificationIcon(notification.type)}"></i>
                        </div>
                        <div class="notification-content-wrapper">
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-content">${notification.message}</div>
                            <div class="notification-time">${timeAgo}</div>
                        </div>
                        <button class="notification-close" onclick="UI.removeNotification(${notification.id})">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="notification-progress" style="width: 100%;"></div>
                `;
                
                container.appendChild(notificationEl);
                
                // Animazione di entrata
                setTimeout(() => {
                    notificationEl.classList.add('show');
                    
                    // Animazione barra di progresso
                    const progressBar = notificationEl.querySelector('.notification-progress');
                    setTimeout(() => {
                        progressBar.style.width = '0%';
                        progressBar.style.transition = `width ${notification.duration}ms linear`;
                    }, 100);
                }, 10);
            },

            getNotificationIcon(type) {
                const icons = {
                    success: 'check-circle',
                    error: 'exclamation-triangle',
                    info: 'info-circle',
                    warning: 'exclamation-circle'
                };
                return icons[type] || 'bell';
            },

            getNotificationsContainer() {
                let container = document.querySelector('.notifications-container');
                if (!container) {
                    container = document.createElement('div');
                    container.className = 'notifications-container';
                    document.body.appendChild(container);
                }
                return container;
            },

            removeNotification(notificationId) {
                const notificationEl = document.querySelector(`[data-id="${notificationId}"]`);
                if (notificationEl) {
                    // Animazione di uscita più fluida
                    notificationEl.style.transform = 'translateX(500px) scale(0.8)';
                    notificationEl.style.opacity = '0';
                    
                setTimeout(() => {
                        notificationEl.remove();
                    }, 600);
                }
                
                // Rimuovi dall'array
                notifications = notifications.filter(n => n.id !== notificationId);
            },

            getTimeAgo(timestamp) {
                const now = new Date();
                const diff = now - timestamp;
                const seconds = Math.floor(diff / 1000);
                const minutes = Math.floor(seconds / 60);
                const hours = Math.floor(minutes / 60);
                
                if (seconds < 60) return 'Ora';
                if (minutes < 60) return minutes + 'm fa';
                if (hours < 24) return hours + 'h fa';
                return timestamp.toLocaleDateString('it-IT');
            },
            
            // LOADING
            loading(text = 'Caricamento...', show = true) {
                const existing = document.querySelector('.loading-overlay');
                if (existing) existing.remove();
                
                if (!show) return;
                
                const overlay = document.createElement('div');
                overlay.className = 'loading-overlay';
                overlay.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;z-index:999998;opacity:0;transition:opacity 0.3s';
                
                overlay.innerHTML = `
                    <div style="background:linear-gradient(135deg,rgba(30,41,59,0.95),rgba(30,41,59,0.9));backdrop-filter:blur(24px);border:1px solid rgba(255,255,255,0.12);border-radius:1.5rem;padding:2.5rem;text-align:center;box-shadow:0 25px 50px rgba(0,0,0,0.4);min-width:320px">
                        <div style="width:4rem;height:4rem;border:3px solid rgba(255,255,255,0.1);border-top-color:#3b82f6;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1.5rem"></div>
                        <div style="font-size:1.125rem;font-weight:600;color:#fff">${text}</div>
                    </div>
                `;
                
                document.body.appendChild(overlay);
                setTimeout(() => overlay.style.opacity = '1', 10);
            }
        };

        // ========== LOGIN ==========
        function loginWithDiscord() {
            UI.loading('Reindirizzamento...', true);
            setTimeout(() => {
                const url = `https://discord.com/api/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=identify`;
                window.location.href = url;
            }, 500);
        }

        // Funzione di test per admin
        function testLoginAdmin() {
            console.log('🧪 Test login Admin attivato');
            UI.loading('Accesso Admin di test...', true);
            
            setTimeout(() => {
                const adminUser = {
                    id: '1387684968536477756', // ID admin autorizzato
                    username: 'TestAdmin',
                    discriminator: '1234',
                    avatar: null,
                    email: null
                };
                
                UI.loading('', false);
                showDashboard(adminUser);
                console.log('✅ Test login Admin completato');
            }, 1000);
        }

        // Funzione di test per operatore
        function testLoginOperator() {
            console.log('🧪 Test login Operatore attivato');
            UI.loading('Accesso Operatore di test...', true);
            
            setTimeout(() => {
                const operatorUser = {
                    id: '734406288213016607', // ID operatore autorizzato
                    username: 'TestOperator',
                    discriminator: '5678',
                    avatar: null,
                    email: null
                };
                
                UI.loading('', false);
                showDashboard(operatorUser);
                console.log('✅ Test login Operatore completato');
            }, 1000);
        }
        // Funzione di debug per testare il controllo accessi
        function debugAccessControlDetailed() {
            console.log('🔍 DEBUG ACCESS CONTROL DETTAGLIATO');
            console.log('=====================================');
            
            // Test ID operatore
            const operatorId = '734406288213016607';
            console.log('🧪 Test ID Operatore:', operatorId);
            console.log('  - Tipo:', typeof operatorId);
            console.log('  - È admin?', DISCORD_AUTH.isAdmin(operatorId));
            console.log('  - È operatore?', DISCORD_AUTH.isOperator(operatorId));
            console.log('  - Access level:', DISCORD_AUTH.getAccessLevel(operatorId));
            
            // Test ID admin
            const adminId = '1387684968536477756';
            console.log('🧪 Test ID Admin:', adminId);
            console.log('  - Tipo:', typeof adminId);
            console.log('  - È admin?', DISCORD_AUTH.isAdmin(adminId));
            console.log('  - È operatore?', DISCORD_AUTH.isOperator(adminId));
            console.log('  - Access level:', DISCORD_AUTH.getAccessLevel(adminId));
            
            // Mostra le liste
            console.log('📋 ADMIN_IDS:', DISCORD_AUTH.ADMIN_IDS);
            console.log('📋 OPERATOR_IDS (primi 5):', DISCORD_AUTH.OPERATOR_IDS.slice(0, 5));
            
            // Test includes
            console.log('🔍 Test includes:');
            console.log('  - ADMIN_IDS.includes("734406288213016607"):', DISCORD_AUTH.ADMIN_IDS.includes('734406288213016607'));
            console.log('  - OPERATOR_IDS.includes("734406288213016607"):', DISCORD_AUTH.OPERATOR_IDS.includes('734406288213016607'));
            
            UI.notify('Debug accesso completato! Controlla la console.', 'info', '🔍 Debug');
        }
        function debugAccessControl() {
            console.log('🐛 DEBUG ACCESS CONTROL');
            console.log('========================');
            
            // Test admin
            console.log('🔴 Test Admin:');
            const adminId = '1387684968536477756';
            const adminLevel = DISCORD_AUTH.getAccessLevel(adminId);
            console.log('  - ID:', adminId);
            console.log('  - Livello:', adminLevel);
            console.log('  - È admin?', DISCORD_AUTH.isAdmin(adminId));
            console.log('  - È operatore?', DISCORD_AUTH.isOperator(adminId));
            
            // Test operatore
            console.log('🟢 Test Operatore:');
            const operatorId = '734406288213016607';
            const operatorLevel = DISCORD_AUTH.getAccessLevel(operatorId);
            console.log('  - ID:', operatorId);
            console.log('  - Livello:', operatorLevel);
            console.log('  - È admin?', DISCORD_AUTH.isAdmin(operatorId));
            console.log('  - È operatore?', DISCORD_AUTH.isOperator(operatorId));
            
            // Stato globale
            console.log('🌍 Stato Globale:');
            console.log('  - userAccessLevel:', userAccessLevel);
            console.log('  - getCurrentAccessLevel():', getCurrentAccessLevel());
            console.log('  - localStorage:', localStorage.getItem('userAccessLevel'));
            
            // Test ID non autorizzato
            console.log('🔴 Test ID Non Autorizzato:');
            const unauthorizedId = '999999999999999999';
            const unauthorizedLevel = DISCORD_AUTH.getAccessLevel(unauthorizedId);
            console.log('  - ID:', unauthorizedId);
            console.log('  - Livello:', unauthorizedLevel);
            
            UI.notify('Debug completato! Controlla la console per i dettagli.', 'info', '🐛 Debug Access Control');
        }

        // Funzione per resettare i dati di esempio
        function resetSampleData() {
            console.log('🔄 Reset dati di esempio...');
            
            // Pulisci tutti i dati salvati
            localStorage.removeItem('uopi_operators');
            localStorage.removeItem('uopi_notifications');
            localStorage.removeItem('uopi_shifts');
            
            // Non ricreare dati di esempio, mostra errore
            UI.notify('❌ Impossibile ricreare dati. Controlla la connessione.', 'error', '❌ Errore');
        }
        // Funzione per gestire il callback di ritorno da Discord
        function handleDiscordCallback() {
            const hash = window.location.hash;
            if (hash) {
                const params = new URLSearchParams(hash.substring(1));
                const accessToken = params.get('access_token');
                
                if (accessToken) {
                    console.log('🔐 Token Discord ricevuto:', accessToken);
                    UI.loading('Autenticazione...', true);
                    
                    // Timeout di sicurezza per evitare che rimanga bloccato
                    const timeoutId = setTimeout(() => {
                        console.log('⏰ Timeout autenticazione, procedo con login simulato');
                        UI.loading('', false);
                        
                            // Simula un utente NON autorizzato per testare il sistema
                        const testUser = {
                                id: '999999999999999999', // ID NON autorizzato per test
                                username: 'TestUser',
                                discriminator: '0000',
                            avatar: null,
                            email: null
                        };
                        
                        showDashboard(testUser);
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }, 10000); // 10 secondi di timeout
                    
                    // Ottieni i dati dell'utente da Discord
                    fetch('https://discord.com/api/users/@me', {
                        headers: {
                            'Authorization': `Bearer ${accessToken}`
                        }
                    })
                    .then(response => {
                        clearTimeout(timeoutId); // Cancella il timeout se la risposta arriva
                        return response.json();
                    })
                    .then(userData => {
                        console.log('👤 Dati utente ricevuti:', userData);
                        
                        // Chiudi il loading
                        UI.loading('', false);
                        
                        // Simula un utente completo
                        const fullUserData = {
                            id: userData.id,
                            username: userData.username,
                            discriminator: userData.discriminator,
                            avatar: userData.avatar,
                            email: userData.email || null
                        };
                        
                        // Mostra la dashboard
                        showDashboard(fullUserData);
                        
                        // Rimuovi il token dall'URL
                        window.history.replaceState({}, document.title, window.location.pathname);
                    })
                    .catch(error => {
                        console.error('❌ Errore nel recupero dati utente:', error);
                        clearTimeout(timeoutId); // Cancella il timeout
                        UI.loading('', false); // Chiudi il loading
                        UI.notify('Errore nell\'autenticazione', 'error', '❌ Errore');
                        
                        // Fallback con utente di test
                        console.log('🔄 Fallback con utente di test');
                        const testUser = {
                            id: '734406288213016607', // ID operatore di test
                            username: 'TestOperator',
                            discriminator: '8888',
                            avatar: null,
                            email: null
                        };
                        showDashboard(testUser);
                    });
                } else {
                    // Token non trovato, mostra messaggio di errore
                    console.log('❌ Token Discord non trovato nell\'URL');
                    UI.notify('Errore nell\'autenticazione Discord', 'error', '❌ Errore');
                }
            } else {
                // Nessun hash nell'URL, utente non autorizzato o errore
                console.log('❌ Nessun token nell\'URL, utente potrebbe non essere autorizzato');
            }
        }
        // ========== DASHBOARD ==========
        // Funzione rimossa - usa quella corretta più sotto che fa il controllo degli ID
        // ========== SISTEMA LOGOUT ==========
        function toggleUserDropdown() {
            const dropdown = document.querySelector('.user-dropdown');
            const chevron = document.querySelector('.user-profile i.fa-chevron-down');
            
            if (dropdown.classList.contains('active')) {
                dropdown.classList.remove('active');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                dropdown.classList.add('active');
                chevron.style.transform = 'rotate(180deg)';
            }
        }

        function showUserProfile() {
            UI.closeModal();
            UI.notify('Funzionalità profilo in sviluppo', 'info', '👤 Profilo Utente');
        }

        function showSettings() {
            UI.closeModal();
            UI.notify('Funzionalità impostazioni in sviluppo', 'info', '⚙️ Impostazioni');
        }
        function showCodeInput() {
            const codeInputContent = `
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1.5rem; color: #3b82f6;">🔐</div>
                    <h3 style="color: #fff; margin-bottom: 1rem; font-size: 1.5rem;">Inserimento Codice di Accesso</h3>
                    <p style="color: #94a3b8; margin-bottom: 2rem;">Inserisci il codice di accesso per sbloccare funzionalità speciali</p>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 2px solid rgba(59, 130, 246, 0.3); border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                        <div style="color: #3b82f6; font-weight: 600; margin-bottom: 0.75rem;">Formato Codice:</div>
                        <div style="color: #e2e8f0; font-family: 'Courier New', monospace; font-size: 1.25rem; font-weight: 700; letter-spacing: 0.1em;">
                            UOPI-XXXX-XXXX-XXXX
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <input type="text" id="accessCode" placeholder="UOPI-XXXX-XXXX-XXXX" 
                               style="width: 100%; padding: 1rem; border: 2px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1.125rem; font-family: 'Courier New', monospace; text-align: center; letter-spacing: 0.1em; transition: all 0.3s ease;" 
                               onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" 
                               onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'"
                               oninput="formatCodeInput(this)"
                               maxlength="19">
                    </div>
                    
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="color: #10b981; font-weight: 600; margin-bottom: 0.5rem;">💡 Suggerimento:</div>
                        <div style="color: #e2e8f0; font-size: 0.875rem;">
                            Il codice viene formattato automaticamente. Inserisci solo numeri e lettere.
                        </div>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="validateAccessCode()" style="background: linear-gradient(135deg, #3b82f6, #1d4ed8);">
                    <i class="fas fa-check"></i> Verifica Codice
                </button>
            `;
            
            UI.modal('🔐 Inserimento Codice di Accesso', codeInputContent, footer);
            
            // Focus automatico sul campo input
            setTimeout(() => {
                const input = document.getElementById('accessCode');
                if (input) {
                    input.focus();
                }
            }, 300);
        }

        function formatCodeInput(input) {
            let value = input.value.replace(/[^A-Z0-9]/g, '').toUpperCase();
            
            // Limita a 16 caratteri (4 gruppi da 4)
            if (value.length > 16) {
                value = value.substring(0, 16);
            }
            
            // Formatta con trattini
            let formatted = '';
            for (let i = 0; i < value.length; i++) {
                if (i === 4 || i === 8 || i === 12) {
                    formatted += '-';
                }
                formatted += value[i];
            }
            
            input.value = formatted;
        }
        function validateAccessCode() {
            const codeInput = document.getElementById('accessCode');
            const enteredCode = codeInput.value.trim().toUpperCase();
            const validCode = 'UOPI-6794-2122-5676';
            
            if (!enteredCode) {
                UI.notify('⚠️ Inserisci un codice prima di verificare!', 'warning', '⚠️ Codice Mancante');
                return;
            }
            
            if (enteredCode === validCode) {
                // Codice valido - mostra schermata di successo
                showCodeAcceptedScreen();
            } else {
                // Codice non valido
                UI.notify('❌ Codice non valido! Controlla il formato e riprova.', 'error', '❌ Codice Errato');
                
                // Evidenzia il campo con errore
                codeInput.style.borderColor = '#ef4444';
                codeInput.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                
                setTimeout(() => {
                    codeInput.style.borderColor = 'var(--border)';
                    codeInput.style.boxShadow = 'none';
                }, 2000);
            }
        }

        function showCodeAcceptedScreen() {
            const successContent = `
                <div style="text-align: center; padding: 3rem 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 2rem; color: #10b981; animation: bounce 1s ease-in-out infinite;">✅</div>
                    <h2 style="color: #fff; margin-bottom: 1rem; font-size: 2rem; font-weight: 700;">CODICE ACCETTATO</h2>
                    <p style="color: #94a3b8; margin-bottom: 2rem; font-size: 1.125rem;">Il codice di accesso è stato verificato con successo!</p>
                    
                    <div style="background: rgba(16, 185, 129, 0.1); border: 2px solid rgba(16, 185, 129, 0.3); border-radius: 1rem; padding: 2rem; margin-bottom: 2rem;">
                        <div style="color: #10b981; font-weight: 600; margin-bottom: 1rem; font-size: 1.125rem;">🎉 Accesso Speciale Sbloccato!</div>
                        <div style="color: #e2e8f0; font-size: 1rem;">
                            La sezione <strong style="color: #10b981;">🥷 Shadow</strong> è stata aggiunta alla tua navbar.
                        </div>
                    </div>
                    
                    <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.75rem; padding: 1.5rem; margin-bottom: 2rem;">
                        <div style="color: #3b82f6; font-weight: 600; margin-bottom: 0.75rem;">📋 Prossimi Passi:</div>
                        <div style="color: #e2e8f0; font-size: 0.875rem; text-align: left;">
                            <div style="margin-bottom: 0.5rem;">1. Chiudi questa finestra</div>
                            <div style="margin-bottom: 0.5rem;">2. Aggiorna la pagina (F5 o Ctrl+R)</div>
                            <div>3. Troverai la nuova sezione nella navbar</div>
                        </div>
                    </div>
                    
                    <div style="color: #f59e0b; font-size: 0.875rem; font-weight: 600;">
                        ⚠️ L'accesso sarà mantenuto per le sessioni future
                    </div>
                </div>
                
                <style>
                    @keyframes bounce {
                        0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
                        40% { transform: translateY(-10px); }
                        60% { transform: translateY(-5px); }
                    }
                </style>
            `;
            
            const footer = `
                <button class="btn btn-primary" onclick="closeCodeModalAndSave()" style="background: linear-gradient(135deg, #10b981, #059669); width: 100%;">
                    <i class="fas fa-check-circle"></i> Perfetto! Chiudi e Aggiorna
                </button>
            `;
            
            UI.modal('✅ Codice Accettato', successContent, footer);
        }

        async function closeCodeModalAndSave() {
            // Salva solo su localStorage
            const currentUserId = localStorage.getItem('authenticatedUserId') || 'unknown';
            
            // Salva su localStorage (immediato e affidabile)
            localStorage.setItem('shadowAccessGranted', 'true');
            localStorage.setItem('shadowAccessUser', currentUserId);
            localStorage.setItem('shadowAccessDate', new Date().toISOString());
            console.log('✅ Accesso Shadow salvato su localStorage');
            
            // Salva anche su cloud per persistenza
            try {
                await saveShadowAccessToCloud();
                console.log('✅ Accesso Shadow salvato anche su cloud');
            } catch (error) {
                console.log('⚠️ Errore cloud, ma localStorage salvato:', error);
            }
            
            UI.closeModal();
            
            // Mostra notifica finale
            UI.notify('🎉 Accesso Shadow sbloccato! La sezione è ora disponibile.', 'success', '🥷 Shadow Unlocked');
            
            // Forza il refresh della navbar immediatamente
            setTimeout(() => {
                updateNavbarForShadowAccess();
            }, 500);
            
            // Controllo aggiuntivo dopo 2 secondi
            setTimeout(() => {
                updateNavbarForShadowAccess();
            }, 2000);
        }

        // Funzione per salvare l'accesso Shadow (solo localStorage)
        async function saveShadowAccessToCloud() {
            try {
                console.log('💾 Salvataggio accesso Shadow su localStorage...');
                
                const currentUserId = localStorage.getItem('authenticatedUserId') || 'unknown';
                console.log('👤 User ID:', currentUserId);
                
                // Salva solo su localStorage
                const shadowAccessData = {
                    shadowAccessGranted: true,
                    shadowAccessCode: 'UOPI-6794-2122-5676',
                    shadowAccessDate: new Date().toISOString(),
                    shadowAccessUser: currentUserId
                };
                
                console.log('💾 Dati Shadow da salvare:', shadowAccessData);
                
                // Salva su localStorage
                localStorage.setItem('shadowAccessGranted', 'true');
                localStorage.setItem('shadowAccessUser', currentUserId);
                localStorage.setItem('shadowAccessDate', shadowAccessData.shadowAccessDate);
                localStorage.setItem('shadowAccessCode', shadowAccessData.shadowAccessCode);
                
                console.log('✅ Accesso Shadow salvato su localStorage con successo!');
                    
                    // Mostra notifica di conferma
                UI.notify('💾 Accesso Shadow salvato localmente!', 'success', '💾 Salvataggio Completato');
                
            } catch (error) {
                console.error('❌ Errore nel salvataggio accesso Shadow:', error);
                UI.notify('❌ Errore nel salvataggio. Riprova.', 'error', '❌ Errore');
            }
        }
        // Funzione per caricare l'accesso Shadow (solo localStorage)
        async function loadShadowAccessFromCloud() {
            try {
                const currentUserId = localStorage.getItem('authenticatedUserId');
                
                // Controlla solo localStorage
                const localShadowAccess = localStorage.getItem('shadowAccessGranted');
                const localShadowUser = localStorage.getItem('shadowAccessUser');
                
                console.log('🔍 Controllo localStorage Shadow:', {
                    shadowAccessGranted: localShadowAccess,
                    shadowAccessUser: localShadowUser,
                    currentUserId: currentUserId
                });
                
                if (localShadowAccess === 'true' && localShadowUser === currentUserId) {
                    console.log('✅ Accesso Shadow trovato su localStorage per utente:', currentUserId);
                        return true;
                    } else {
                        console.log('ℹ️ Nessun accesso Shadow trovato per utente:', currentUserId);
                    return false;
                }
                
            } catch (error) {
                console.error('❌ Errore nel caricamento accesso Shadow:', error);
                return false;
            }
        }
        async function updateNavbarForShadowAccess() {
            try {
                // Controlla solo localStorage
                console.log('🔍 Controllo accesso Shadow (localStorage)...');
                console.log('🔍 User ID corrente:', localStorage.getItem('authenticatedUserId'));
                
                const shadowAccess = await loadShadowAccessFromCloud();
                
                if (shadowAccess) {
                    console.log('✅ Accesso Shadow confermato, aggiungo pulsante alla navbar...');
                    
                    // Trova la navbar e aggiungi il pulsante Shadow
                    const nav = document.querySelector('.nav');
                    if (nav) {
                        console.log('📋 Navbar trovata:', nav);
                        
                        // Controlla se il pulsante Shadow esiste già
                        const existingShadowBtn = nav.querySelector('[onclick*="shadow"]');
                        if (existingShadowBtn) {
                            console.log('ℹ️ Pulsante Shadow già presente nella navbar');
                            // Assicurati che sia visibile
                            existingShadowBtn.style.display = '';
                            return;
                        }
                        
                        // Trova il pulsante Status per inserire Shadow dopo
                        const statusBtn = nav.querySelector('[onclick*="status"]');
                        if (statusBtn) {
                            console.log('📍 Pulsante Status trovato:', statusBtn);
                            
                            // Crea il nuovo pulsante Shadow
                            const shadowBtn = document.createElement('button');
                            shadowBtn.className = 'nav-btn';
                            shadowBtn.setAttribute('onclick', "loadPage('shadow')");
                            shadowBtn.innerHTML = '🥷 Shadow';
                            shadowBtn.style.display = '';
                            
                            // Inserisci dopo Status e prima di Crediti
                            statusBtn.parentNode.insertBefore(shadowBtn, statusBtn.nextSibling.nextSibling);
                            
                            console.log('✅ Pulsante Shadow aggiunto alla navbar con successo!');
                        } else {
                            console.error('❌ Pulsante Status non trovato nella navbar');
                            console.log('🔍 Navbar HTML:', nav.innerHTML);
                        }
                    } else {
                        console.error('❌ Navbar non trovata');
                        console.log('🔍 Document body:', document.body);
                    }
                } else {
                    console.log('ℹ️ Nessun accesso Shadow trovato nel cloud per questo utente');
                }
            } catch (error) {
                console.error('❌ Errore in updateNavbarForShadowAccess:', error);
            }
        }
        async function checkShadowAccessAndLoad() {
            const content = document.getElementById('content');
            if (!content) return;
            
            // Controlla SOLO localStorage
            console.log('💾 Controllo accesso Shadow da localStorage...');
            const shadowAccess = await loadShadowAccessFromCloud();
            
            if (shadowAccess) {
                content.innerHTML = getShadowPage();
                console.log('✅ Accesso Shadow confermato da localStorage, caricamento pagina');
            } else {
                content.innerHTML = '<div class="card"><p>❌ Accesso negato. Questa sezione richiede un codice di accesso speciale.</p></div>';
                console.log('❌ Accesso Shadow negato - non trovato nel localStorage');
            }
        }
        function confirmLogout() {
            UI.closeModal();
            
            const confirmContent = `
                <div style="text-align: center; padding: 1rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: #ef4444;">🚪</div>
                    <h3 style="color: #fff; margin-bottom: 1rem;">Conferma Logout</h3>
                    <p style="color: #94a3b8; margin-bottom: 1.5rem;">Sei sicuro di voler disconnetterti dal sistema U.O.P.I.?</p>
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="color: #ef4444; font-weight: 600; margin-bottom: 0.5rem;">⚠️ Attenzione:</div>
                        <div style="color: #e2e8f0; font-size: 0.875rem;">
                            <div>• Dovrai effettuare nuovamente il login</div>
                            <div>• I dati non salvati potrebbero andare persi</div>
                            <div>• Le notifiche attive verranno chiuse</div>
                        </div>
                    </div>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn" onclick="performLogout()" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none;">
                    <i class="fas fa-sign-out-alt"></i> Disconnetti
                </button>
            `;
            
            UI.modal('🚪 Logout', confirmContent, footer);
        }

        function performLogout() {
            UI.loading('Disconnessione in corso...', true);
            
            setTimeout(() => {
                // Chiudi tutte le notifiche
                notifications.forEach(notification => {
                    UI.removeNotification(notification.id);
                });
                notifications = [];
                
                // Reset dati
                operators = [];
                
                UI.loading('', false);
                UI.notify('Disconnesso con successo', 'success', '👋 Arrivederci');
                
                setTimeout(() => {
                    // Mostra pagina di login
                    document.getElementById('app').innerHTML = `
                        <div id="loginPage" style="min-height: 100vh; display: flex; align-items: center; justify-content: center;">
                            <div style="background: rgba(30, 41, 59, 0.9); backdrop-filter: blur(24px); border: 1px solid rgba(255, 255, 255, 0.12); border-radius: 2rem; padding: 3rem; max-width: 450px; width: 90%; text-align: center; box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);">
                                <img src="https://i.imgur.com/B6E4u1X.png" alt="Logo" style="width: 120px; height: 120px; margin: 0 auto 2rem; border-radius: 50%; box-shadow: 0 0 30px rgba(59, 130, 246, 0.4);">
                                <h1 style="font-size: 2.5rem; font-weight: 800; margin-bottom: 1rem;">U.O.P.I.</h1>
                                <p style="color: #94a3b8; margin-bottom: 2rem;">Unità Operativa di Primo Intervento</p>
                                <button onclick="loginWithDiscord()" style="width: 100%; padding: 1.25rem; background: linear-gradient(135deg, #5865f2, #4752c4); border: none; border-radius: 1rem; color: white; font-weight: 700; font-size: 1.125rem; cursor: pointer; box-shadow: 0 8px 20px rgba(88, 101, 242, 0.4); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 12px 30px rgba(88, 101, 242, 0.5)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 20px rgba(88, 101, 242, 0.4)'">
                                    <i class="fab fa-discord"></i> Accedi con Discord
                                </button>
                            </div>
                        </div>
                    `;
                }, 1000);
            }, 1500);
        }

        // ========== FOOTER INFORMATIVO ==========
        function getFooterDisclaimer() {
            return `
                <div class="footer-disclaimer" style="
                    margin-top: 3rem;
                    padding: 1.5rem 2rem;
                    background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
                    border: 1px solid rgba(255, 255, 255, 0.1);
                    border-radius: 1rem;
                    text-align: center;
                    backdrop-filter: blur(12px);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                ">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                        <div style="
                            width: 3rem;
                            height: 3rem;
                            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            margin-right: 1rem;
                            box-shadow: 0 4px 16px rgba(59, 130, 246, 0.3);
                        ">
                            <i class="fas fa-gamepad" style="color: white; font-size: 1.2rem;"></i>
                        </div>
                        <h3 style="color: #e2e8f0; margin: 0; font-size: 1.25rem; font-weight: 600;">
                            🎮 Disclaimer FiveM Roleplay
                        </h3>
                    </div>
                    
                    <div style="color: #94a3b8; line-height: 1.6; margin-bottom: 1rem;">
                        <p style="margin: 0 0 0.5rem 0; font-size: 1rem;">
                            <strong style="color: #e2e8f0;">⚠️ IMPORTANTE:</strong> Questo sito web è stato sviluppato <strong>unicamente</strong> per un server FiveM roleplay denominato <strong style="color: #3b82f6;">IPRP</strong>.
                        </p>
                        <p style="margin: 0; font-size: 0.9rem;">
                            <strong style="color: #ef4444;">NON è collegato</strong> alle U.O.P.I. reali, alla Polizia di Stato italiana, o a qualsiasi ente governativo. 
                            È puramente un progetto di intrattenimento per il gioco Grand Theft Auto V.
                        </p>
                    </div>
                    
                    <div style="
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 1rem;
                        flex-wrap: wrap;
                        margin-top: 1rem;
                        padding-top: 1rem;
                        border-top: 1px solid rgba(255, 255, 255, 0.1);
                    ">
                        <div style="color: #64748b; font-size: 0.85rem;">
                            <i class="fas fa-code" style="color: #8b5cf6; margin-right: 0.5rem;"></i>
                            Sviluppato da <strong style="color: #3b82f6;">Ryze</strong>
                        </div>
                        <div style="color: #64748b; font-size: 0.85rem;">
                            <i class="fas fa-server" style="color: #10b981; margin-right: 0.5rem;"></i>
                            Per server <strong style="color: #10b981;">IPRP</strong>
                        </div>
                        <div style="color: #64748b; font-size: 0.85rem;">
                            <i class="fas fa-calendar" style="color: #f59e0b; margin-right: 0.5rem;"></i>
                            Versione <strong style="color: #f59e0b;">8.0</strong>
                        </div>
                    </div>
                </div>
            `;
        }

        // Funzione per ricaricare automaticamente la pagina quando il caricamento è completato
        function checkAndReloadPage() {
            if (isLoadingOperators) {
                // Se stiamo ancora caricando, ricontrolla tra 500ms
                setTimeout(checkAndReloadPage, 500);
            } else if (operatorsLoaded && operators && operators.length > 0) {
                // Se il caricamento è completato e abbiamo operatori, ricarica la pagina corrente
                const currentPage = document.querySelector('.nav-btn.active');
                if (currentPage && currentPage.textContent.includes('Gerarchia')) {
                    console.log('🔄 Caricamento completato, ricarico pagina Gerarchia...');
                    loadPage('personnel');
                }
            }
        }

        // ========== FUNZIONI UTILITY ==========
        function updateOverviewStats() {
            // Aggiorna automaticamente la panoramica SOLO se è attualmente visualizzata
            const currentPage = document.querySelector('.nav-btn.active');
            if (currentPage && currentPage.textContent.includes('Panoramica')) {
                loadPage('overview');
            }
            // NON forzare il ricaricamento della pagina gerarchia per evitare reindirizzamenti indesiderati
        }

        function testNotifications() {
            // Test sequenziale di tutti i tipi di notifiche
            UI.notify('Operazione completata con successo!', 'success', '✅ Successo', 4000);
            
            setTimeout(() => {
                UI.notify('Si è verificato un errore durante il salvataggio', 'error', '❌ Errore', 5000);
            }, 1000);
            
            setTimeout(() => {
                UI.notify('Nuova versione disponibile per il download', 'info', 'ℹ️ Informazione', 6000);
            }, 2000);
            
            setTimeout(() => {
                UI.notify('Attenzione: memoria quasi piena', 'warning', '⚠️ Avviso', 7000);
            }, 3000);
        }
        function getSystemStats() {
            const totalOperators = operators.length;
            const availableOperators = operators.filter(op => op.status === 'Disponibile').length;
            const dirigenzialeCount = operators.filter(op => op.role === 'dirigenziale').length;
            const amministrativoCount = operators.filter(op => op.role === 'amministrativo').length;
            const operativoCount = operators.filter(op => op.role === 'operativo').length;
            const lastRefresh = new Date().toLocaleString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            return {
                totalOperators,
                availableOperators,
                dirigenzialeCount,
                amministrativoCount,
                operativoCount,
                lastRefresh,
                teamStats: {
                    alpha: operators.filter(op => op.team === 'Alpha').length,
                    beta: operators.filter(op => op.team === 'Beta').length,
                    gamma: operators.filter(op => op.team === 'Gamma').length
                }
            };
        }
        // ========== GESTIONE PAGINE ==========

        function getOverviewPage() {
            // Calcola statistiche reali basate sui dati
            const totalOperators = operators.length;
            const availableOperators = operators.filter(op => op.status === 'Disponibile').length;
            const activeShifts = 0; // Sarà implementato quando avremo i turni
            const efficiency = totalOperators > 0 ? Math.round((availableOperators / totalOperators) * 100) : 0;
            
            // Statistiche avanzate per il nuovo design
            const dirigenzialeOps = operators.filter(op => op.role === 'dirigenziale').length;
            const amministrativoOps = operators.filter(op => op.role === 'amministrativo').length;
            const operativoOps = operators.filter(op => op.role === 'operativo').length;
            const alphaTeam = operators.filter(op => op.team === 'Alpha').length;
            const betaTeam = operators.filter(op => op.team === 'Beta').length;
            // HomePage Ultra-Moderna 4.0 - Design completamente nuovo
            const lastRefresh = new Date().toLocaleString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            return `
                <div class="home-ultra">
                    <!-- Hero Section con gradiente animato -->
                    <section class="hero-ultra">
                        <div class="hero-ultra-content">
                            <div class="hero-ultra-left">
                                <div class="hero-ultra-badge">
                                    <i class="fas fa-circle"></i>
                                    <span>Sistema Operativo</span>
                                </div>
                                <h1>Dashboard U.O.P.I.</h1>
                                <p>Controllo centralizzato per gestione personale, turni operativi e coordinamento attività della tua unità.</p>
                                <div class="hero-ultra-actions">
                                    <button class="btn btn-primary" onclick="loadPage('personnel')">
                                        <i class="fas fa-users"></i>
                                        <span>Gestisci Personale</span>
                                    </button>
                                    <button class="btn btn-secondary" onclick="loadPage('shifts')">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>Vedi Turni</span>
                                    </button>
                                </div>
                            </div>
                            <div class="hero-ultra-right">
                                <div class="hero-ultra-status">
                                    <span class="pulse-dot"></span>
                                    <span>Aggiornato alle ${lastRefresh}</span>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- KPI Cards principali -->
                    <section class="kpi-ultra-grid">
                        <div class="kpi-ultra-card primary">
                            <div class="kpi-ultra-header">
                                <div class="kpi-ultra-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="kpi-ultra-trend">
                                    <i class="fas fa-arrow-up"></i>
                                    <span>+${totalOperators}</span>
                                </div>
                            </div>
                            <div class="kpi-ultra-body">
                                <span class="kpi-ultra-label">Operatori Totali</span>
                                <span class="kpi-ultra-value">${totalOperators}</span>
                            </div>
                            <div class="kpi-ultra-progress">
                                <div class="kpi-ultra-progress-fill" style="width: ${totalOperators > 0 ? 85 : 0}%;"></div>
                            </div>
                        </div>

                        <div class="kpi-ultra-card success">
                            <div class="kpi-ultra-header">
                                <div class="kpi-ultra-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="kpi-ultra-trend">
                                    <i class="fas fa-check"></i>
                                    <span>${totalOperators > 0 ? Math.round((availableOperators/totalOperators)*100) : 0}%</span>
                                </div>
                            </div>
                            <div class="kpi-ultra-body">
                                <span class="kpi-ultra-label">Disponibili</span>
                                <span class="kpi-ultra-value">${availableOperators}</span>
                            </div>
                            <div class="kpi-ultra-progress">
                                <div class="kpi-ultra-progress-fill" style="width: ${totalOperators > 0 ? (availableOperators/totalOperators)*100 : 0}%;"></div>
                            </div>
                        </div>

                        <div class="kpi-ultra-card warning">
                            <div class="kpi-ultra-header">
                                <div class="kpi-ultra-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="kpi-ultra-trend">
                                    <i class="fas fa-minus"></i>
                                    <span>0</span>
                                </div>
                            </div>
                            <div class="kpi-ultra-body">
                                <span class="kpi-ultra-label">Turni Attivi</span>
                                <span class="kpi-ultra-value">${activeShifts}</span>
                            </div>
                            <div class="kpi-ultra-progress">
                                <div class="kpi-ultra-progress-fill" style="width: ${activeShifts > 0 ? 50 : 0}%;"></div>
                            </div>
                        </div>

                        <div class="kpi-ultra-card info">
                            <div class="kpi-ultra-header">
                                <div class="kpi-ultra-icon">
                                    <i class="fas fa-percentage"></i>
                                </div>
                                <div class="kpi-ultra-trend">
                                    <i class="fas fa-bolt"></i>
                                    <span>${efficiency}%</span>
                                </div>
                            </div>
                            <div class="kpi-ultra-body">
                                <span class="kpi-ultra-label">Efficienza</span>
                                <span class="kpi-ultra-value">${efficiency}%</span>
                            </div>
                            <div class="kpi-ultra-progress">
                                <div class="kpi-ultra-progress-fill" style="width: ${efficiency}%;"></div>
                            </div>
                        </div>
                    </section>

                    ${totalOperators > 0 ? `
                    <!-- Quick Info Cards -->
                    <section class="quick-info-grid">
                        <div class="info-ultra-card">
                            <div class="info-ultra-header">
                                <div class="info-ultra-icon">
                                    <i class="fas fa-layer-group"></i>
                                </div>
                                <h3>Distribuzione Nuclei</h3>
                            </div>
                            <div class="info-ultra-list">
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="info-badge red">Dirigenziale</span>
                                    </div>
                                    <span class="info-number">${dirigenzialeOps}</span>
                                </div>
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="info-badge green">Amministrativo</span>
                                    </div>
                                    <span class="info-number">${amministrativoOps}</span>
                                </div>
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="info-badge blue">Operativo</span>
                                    </div>
                                    <span class="info-number">${operativoOps}</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-ultra-card">
                            <div class="info-ultra-header">
                                <div class="info-ultra-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <h3>Squadre Operative</h3>
                            </div>
                            <div class="info-ultra-list">
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="info-badge violet">Alpha</span>
                                    </div>
                                    <span class="info-number">${alphaTeam}</span>
                                </div>
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="info-badge amber">Beta</span>
                                    </div>
                                    <span class="info-number">${betaTeam}</span>
                                </div>
                            </div>
                        </div>

                        <div class="info-ultra-card">
                            <div class="info-ultra-header">
                                <div class="info-ultra-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                                    <i class="fas fa-chart-line"></i>
                                </div>
                                <h3>Status Sistema</h3>
                            </div>
                            <div class="info-ultra-list">
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <span class="status-dot active"></span>
                                        <span style="color: #e2e8f0; font-weight: 700;">Operativo</span>
                                    </div>
                                </div>
                                <div class="info-ultra-item">
                                    <div class="info-ultra-item-left">
                                        <i class="fas fa-database" style="color: #3b82f6; font-size: 0.875rem;"></i>
                                        <span style="color: #94a3b8; font-size: 0.875rem;">Dati sincronizzati</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                    ` : `
                    <!-- Empty State -->
                    <section class="ultra-empty">
                        <div class="ultra-empty-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <h2>Inizia da Qui</h2>
                        <p>Non ci sono ancora operatori nel sistema. Aggiungi il primo membro per iniziare a utilizzare la dashboard.</p>
                        <button class="btn btn-primary" onclick="openAddOperator()" style="padding: 1.125rem 2rem; font-size: 1.125rem;">
                            <i class="fas fa-user-plus"></i>
                            <span>Aggiungi Primo Operatore</span>
                        </button>
                    </section>
                    `}

                    <!-- Action Cards per accesso rapido -->
                    <section class="actions-ultra-grid">
                        <div class="action-ultra-card primary" onclick="loadPage('personnel')">
                            <div class="action-ultra-icon">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="action-ultra-content">
                                <h3>Gerarchia</h3>
                                <p>Visualizza e gestisci la struttura operativa</p>
                            </div>
                            <i class="fas fa-arrow-right action-ultra-arrow"></i>
                        </div>

                        <div class="action-ultra-card success" onclick="loadPage('shifts')">
                            <div class="action-ultra-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="action-ultra-content">
                                <h3>Turni</h3>
                                <p>Programma e monitora i turni operativi</p>
                            </div>
                            <i class="fas fa-arrow-right action-ultra-arrow"></i>
                        </div>

                        <div class="action-ultra-card warning" onclick="loadPage('announcements')">
                            <div class="action-ultra-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <div class="action-ultra-content">
                                <h3>Comunicati</h3>
                                <p>Gestisci annunci e comunicazioni</p>
                            </div>
                            <i class="fas fa-arrow-right action-ultra-arrow"></i>
                        </div>

                        <div class="action-ultra-card info" onclick="loadPage('status')">
                            <div class="action-ultra-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <div class="action-ultra-content">
                                <h3>Status</h3>
                                <p>Monitora lo stato del sistema</p>
                            </div>
                            <i class="fas fa-arrow-right action-ultra-arrow"></i>
                        </div>
                    </section>
                </div>
                ${getFooterDisclaimer()}
            `;
            return `
                <!-- PANORAMICA RIVOLUZIONARIA 2.0 -->
                <div class="revolutionary-overview">
                    <!-- Hero Section Ultra-Moderna -->
                    <div class="hero-section-v2">
                        <div class="hero-background">
                            <div class="hero-particles"></div>
                            <div class="hero-grid"></div>
                        </div>
                        <div class="hero-content-v2">
                            <div class="hero-badge">
                                <div class="badge-icon">
                                    <i class="fas fa-rocket"></i>
                                </div>
                                <span>SISTEMA ATTIVO</span>
                            </div>
                            <h1 class="hero-title-v2">
                                <span class="title-main">Panoramica Operativa</span>
                                <span class="title-sub">Sintesi Stato Sistema</span>
                            </h1>
                            <p class="hero-description-v2">Vista sintetica e moderna su personale, turni e prontezza operativa.</p>
                            <div class="hero-stats-mini">
                                <div class="mini-stat">
                                    <span class="mini-value">${totalOperators}</span>
                                    <span class="mini-label">Operatori</span>
                                </div>
                                <div class="mini-stat">
                                    <span class="mini-value">${efficiency}%</span>
                                    <span class="mini-label">Efficienza</span>
                                </div>
                                <div class="mini-stat">
                                    <span class="mini-value">24/7</span>
                                    <span class="mini-label">Monitoraggio</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Stats Dashboard Avanzata -->
                    <div class="stats-dashboard-v2">
                        <div class="dashboard-header">
                            <h2>Metriche Operative</h2>
                            <div class="dashboard-controls">
                                <div class="time-selector">
                                    <span class="time-active">Oggi</span>
                                    <span>Settimana</span>
                                    <span>Mese</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="stats-grid-v2">
                            <div class="stat-card-v2 primary-gradient">
                                <div class="stat-background">
                                    <div class="stat-pattern"></div>
                                </div>
                                <div class="stat-content-v2">
                                    <div class="stat-header">
                                        <div class="stat-icon-v2">
                                            <i class="fas fa-helicopter"></i>
                                        </div>
                                        <div class="stat-trend positive">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+12%</span>
                                        </div>
                                    </div>
                                    <div class="stat-value-v2">0</div>
                                    <div class="stat-label-v2">OPERAZIONI ATTIVE</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar-v2">
                                            <div class="progress-fill-v2" style="width: 0%"></div>
                                        </div>
                                        <span class="progress-text">0% Complete</span>
                                    </div>
                                </div>
                            </div>

                            <div class="stat-card-v2 success-gradient">
                                <div class="stat-background">
                                    <div class="stat-pattern"></div>
                                </div>
                                <div class="stat-content-v2">
                                    <div class="stat-header">
                                        <div class="stat-icon-v2">
                                            <i class="fas fa-users"></i>
                                        </div>
                                        <div class="stat-trend positive">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+${totalOperators}</span>
                                        </div>
                                    </div>
                                    <div class="stat-value-v2">${totalOperators}</div>
                                    <div class="stat-label-v2">OPERATORI TOTALI</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar-v2">
                                            <div class="progress-fill-v2" style="width: ${totalOperators > 0 ? 75 : 0}%"></div>
                                        </div>
                                        <span class="progress-text">${totalOperators > 0 ? '75%' : '0%'} Capacity</span>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card-v2 warning-gradient">
                                <div class="stat-background">
                                    <div class="stat-pattern"></div>
                                </div>
                                <div class="stat-content-v2">
                                    <div class="stat-header">
                                        <div class="stat-icon-v2">
                                            <i class="fas fa-clock"></i>
                                        </div>
                                        <div class="stat-trend neutral">
                                            <i class="fas fa-minus"></i>
                                            <span>0%</span>
                                        </div>
                                    </div>
                                    <div class="stat-value-v2">${activeShifts}</div>
                                    <div class="stat-label-v2">TURNI IN CORSO</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar-v2">
                                            <div class="progress-fill-v2" style="width: ${activeShifts > 0 ? 50 : 0}%"></div>
                                        </div>
                                        <span class="progress-text">${activeShifts > 0 ? '50%' : '0%'} Active</span>
                                    </div>
                                </div>
                            </div>
                            <div class="stat-card-v2 info-gradient like-crystal">
                                <div class="stat-background">
                                    <div class="stat-pattern"></div>
                                </div>
                                <div class="stat-content-v2">
                                    <div class="stat-header">
                                        <div class="stat-icon-v2">
                                            <i class="fas fa-percentage"></i>
                                        </div>
                                        <div class="stat-trend positive">
                                            <i class="fas fa-arrow-up"></i>
                                            <span>+${efficiency}%</span>
                                        </div>
                                    </div>
                                    <div class="stat-value-v2">${efficiency}%</div>
                                    <div class="stat-label-v2">DISPONIBILITÀ</div>
                                    <div class="stat-progress">
                                        <div class="progress-bar-v2">
                                            <div class="progress-fill-v2" style="width: ${efficiency}%"></div>
                                        </div>
                                        <span class="progress-text">${efficiency}% Optimal</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Analytics Hub -->
                    ${totalOperators > 0 ? `
                        <div class="analytics-hub">
                            <div class="hub-header">
                                <div class="hub-title">
                                    <div class="hub-icon">
                                        <i class="fas fa-chart-network"></i>
                                    </div>
                                    <div class="hub-text">
                                        <h2>Analytics Hub</h2>
                                        <p>Intelligence operativa avanzata</p>
                                    </div>
                                </div>
                                <div class="hub-status">
                                    <div class="status-dot active"></div>
                                    <span>Operativo</span>
                                </div>
                            </div>

                            <div class="analytics-grid-v2">
                                <!-- Operator Status Matrix -->
                                <div class="analytics-card-v2 operator-matrix">
                                    <div class="card-header-v2">
                                        <h3>Status Matrix</h3>
                                        <div class="card-controls">
                                            <button class="control-toggle active">Real-time</button>
                                        </div>
                                    </div>
                                    <div class="matrix-grid">
                                        <div class="matrix-item available">
                                            <div class="matrix-icon">
                                                <i class="fas fa-check-circle"></i>
                                            </div>
                                            <div class="matrix-content">
                                                <div class="matrix-value">${availableOperators}</div>
                                                <div class="matrix-label">Disponibili</div>
                                                <div class="matrix-percentage">${totalOperators > 0 ? Math.round((availableOperators / totalOperators) * 100) : 0}%</div>
                                            </div>
                                            <div class="matrix-indicator"></div>
                                        </div>
                                        <div class="matrix-item in-service">
                                            <div class="matrix-icon">
                                                <i class="fas fa-user-clock"></i>
                                            </div>
                                            <div class="matrix-content">
                                                <div class="matrix-value">${totalOperators - availableOperators}</div>
                                                <div class="matrix-label">In Servizio</div>
                                                <div class="matrix-percentage">${totalOperators > 0 ? Math.round(((totalOperators - availableOperators) / totalOperators) * 100) : 0}%</div>
                                            </div>
                                            <div class="matrix-indicator"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Team Performance -->
                                <div class="analytics-card-v2 team-performance">
                                    <div class="card-header-v2">
                                        <h3>Team Performance</h3>
                                        <div class="card-controls">
                                            <button class="control-toggle">Analytics</button>
                                        </div>
                                    </div>
                                    <div class="team-chart">
                                        <div class="team-item-v2 alpha">
                                            <div class="team-header">
                                                <div class="team-icon-v2">
                                                    <i class="fas fa-shield-alt"></i>
                                                </div>
                                                <div class="team-info">
                                                    <span class="team-name">Squadra Alpha</span>
                                                    <span class="team-count">${alphaTeam} membri</span>
                                                </div>
                                            </div>
                                            <div class="team-metrics">
                                                <div class="metric">
                                                    <span class="metric-label">Efficienza</span>
                                                    <span class="metric-value">${alphaTeam > 0 ? '95%' : '0%'}</span>
                                                </div>
                                                <div class="metric">
                                                    <span class="metric-label">Disponibilità</span>
                                                    <span class="metric-value">${alphaTeam > 0 ? '88%' : '0%'}</span>
                                                </div>
                                            </div>
                                            <div class="team-chart-bar">
                                                <div class="chart-bar">
                                                    <div class="bar-fill alpha" style="width: ${totalOperators > 0 ? (alphaTeam / totalOperators) * 100 : 0}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="team-item-v2 beta">
                                            <div class="team-header">
                                                <div class="team-icon-v2">
                                                    <i class="fas fa-shield-alt"></i>
                                                </div>
                                                <div class="team-info">
                                                    <span class="team-name">Squadra Beta</span>
                                                    <span class="team-count">${betaTeam} membri</span>
                                                </div>
                                            </div>
                                            <div class="team-metrics">
                                                <div class="metric">
                                                    <span class="metric-label">Efficienza</span>
                                                    <span class="metric-value">${betaTeam > 0 ? '92%' : '0%'}</span>
                                                </div>
                                                <div class="metric">
                                                    <span class="metric-label">Disponibilità</span>
                                                    <span class="metric-value">${betaTeam > 0 ? '85%' : '0%'}</span>
                                                </div>
                                            </div>
                                            <div class="team-chart-bar">
                                                <div class="chart-bar">
                                                    <div class="bar-fill beta" style="width: ${totalOperators > 0 ? (betaTeam / totalOperators) * 100 : 0}%"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Command Structure -->
                                <div class="analytics-card-v2 command-structure">
                                    <div class="card-header-v2">
                                        <h3>Command Structure</h3>
                                        <div class="card-controls">
                                            <button class="control-toggle">Hierarchy</button>
                                        </div>
                                    </div>
                                    <div class="command-hierarchy">
                                        <div class="hierarchy-level-v2 dirigenziale">
                                            <div class="level-icon">
                                                <i class="fas fa-crown"></i>
                                            </div>
                                            <div class="level-info">
                                                <span class="level-name">Dirigenziale</span>
                                                <span class="level-count">${dirigenzialeOps} operatori</span>
                                            </div>
                                            <div class="level-status">
                                                <div class="status-bar">
                                                    <div class="status-fill dirigenziale" style="width: ${totalOperators > 0 ? (dirigenzialeOps / totalOperators) * 100 : 0}%"></div>
                                                </div>
                                                <span class="status-percentage">${totalOperators > 0 ? Math.round((dirigenzialeOps / totalOperators) * 100) : 0}%</span>
                                            </div>
                                        </div>
                                        <div class="hierarchy-level-v2 amministrativo">
                                            <div class="level-icon">
                                                <i class="fas fa-clipboard-list"></i>
                                            </div>
                                            <div class="level-info">
                                                <span class="level-name">Amministrativo</span>
                                                <span class="level-count">${amministrativoOps} operatori</span>
                                            </div>
                                            <div class="level-status">
                                                <div class="status-bar">
                                                    <div class="status-fill amministrativo" style="width: ${totalOperators > 0 ? (amministrativoOps / totalOperators) * 100 : 0}%"></div>
                                                </div>
                                                <span class="status-percentage">${totalOperators > 0 ? Math.round((amministrativoOps / totalOperators) * 100) : 0}%</span>
                                            </div>
                                        </div>
                                        <div class="hierarchy-level-v2 operativo">
                                            <div class="level-icon">
                                                <i class="fas fa-user-shield"></i>
                                            </div>
                                            <div class="level-info">
                                                <span class="level-name">Operativo</span>
                                                <span class="level-count">${operativoOps} operatori</span>
                                            </div>
                                            <div class="level-status">
                                                <div class="status-bar">
                                                    <div class="status-fill operativo" style="width: ${totalOperators > 0 ? (operativoOps / totalOperators) * 100 : 0}%"></div>
                                                </div>
                                                <span class="status-percentage">${totalOperators > 0 ? Math.round((operativoOps / totalOperators) * 100) : 0}%</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <!-- Empty State Revolutionario -->
                        <div class="empty-state-v2">
                            <div class="empty-background">
                                <div class="empty-particles"></div>
                                <div class="empty-grid"></div>
                            </div>
                            <div class="empty-content-v2">
                                <div class="empty-icon-v2">
                                    <div class="icon-background">
                                        <i class="fas fa-rocket"></i>
                                    </div>
                                    <div class="icon-glow"></div>
                                </div>
                                <h2 class="empty-title">Sistema Pronto per il Decollo</h2>
                                <p class="empty-description">Inizializza il sistema aggiungendo operatori per attivare il monitoraggio avanzato e l'intelligence operativa</p>
                                <button class="launch-btn" onclick="loadPage('personnel')">
                                    <div class="btn-background"></div>
                                    <div class="btn-content">
                                        <i class="fas fa-rocket"></i>
                                        <span>Inizializza Sistema</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    `}

                    <!-- Command Center -->
                    <div class="command-center">
                        <div class="center-header">
                            <h2>Command Center</h2>
                            <p>Accesso rapido alle funzionalità principali</p>
                        </div>
                        <div class="command-grid">
                            <div class="command-item" onclick="loadPage('personnel')">
                                <div class="command-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="command-content">
                                    <h3>Gestione Operatori</h3>
                                    <p>Amministrazione del personale</p>
                                    <div class="command-status">
                                        <span class="status-dot active"></span>
                                        <span>Attivo</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="loadPage('shifts')">
                                <div class="command-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="command-content">
                                    <h3>Sistema Turni</h3>
                                    <p>Programmazione operativa</p>
                                    <div class="command-status">
                                        <span class="status-dot active"></span>
                                        <span>Attivo</span>
                                    </div>
                                </div>
                            </div>
                            <div class="command-item" onclick="loadPage('operations')">
                                <div class="command-icon">
                                    <i class="fas fa-helicopter"></i>
                                </div>
                                <div class="command-content">
                                    <h3>Operazioni</h3>
                                    <p>Monitoraggio missioni</p>
                                    <div class="command-status">
                                        <span class="status-dot standby"></span>
                                        <span>Standby</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${getFooterDisclaimer()}
            `;
        }
        // Funzione per mostrare la pagina Gerarchia agli operatori normali
        function getPersonnelPageForOperators() {
            console.log('🔒 getPersonnelPageForOperators - nuova vista limitata');
            if (!operators || !Array.isArray(operators)) operators = [];
            const lastRefresh = new Date().toLocaleString('it-IT', { hour: '2-digit', minute: '2-digit' });
            // Ordine ufficiale per grado (qualification) come nel JSON
            const roleOrder = {
                'Comandante Generale': 1,
                'Comandante': 2,
                'Vice Comandante': 3,
                'Sostituto Vice Comandante': 4,
                'Capitano': 5,
                'Caposquadra': 6,
                'Vice Caposquadra': 7,
                'Coordinatore': 8,
                'Tecnico Esperto': 9,
                'Tecnico Specializzato': 10,
                'Tecnico': 11,
                'Operatore Qualificato': 12,
                'Operatore Scelto': 13,
                'Operatore': 14,
                'Operatore in Prova': 15
            };
            const normalizeGrade = (q)=> (q||'').toString().replace(/^[^A-Za-zÀ-ÿ]+[\s・.-]*/,'').trim();
            const sortByGrade = (list) => list.slice().sort((a,b)=>{
                const aVal = roleOrder[normalizeGrade(a.qualification)] || 999;
                const bVal = roleOrder[normalizeGrade(b.qualification)] || 999;
                if (aVal !== bVal) return aVal - bVal; // più alto prima
                return (a.name||'').localeCompare(b.name||'', 'it', {sensitivity:'base'});
            });
            const cards = operators.map(op => {
                const name = op.name || 'Operatore';
                const tag = op.discordTag || '';
                const qualification = op.qualification || '';
                const direct = (op.avatarUrl || '').trim();
                const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                const roleClass = op.role || '';
                const statusClass = op.status === 'Disponibile' ? 'st-ava' : 'st-busy';
                const roleChip = roleClass === 'dirigenziale' ? 'role-dir' : roleClass === 'amministrativo' ? 'role-amm' : 'role-ope';
                const matricola = op.matricola || 'N/A';
                return `
                    <div class="pu-row operator-card" data-role="${roleClass}" data-name="${(name||'').toLowerCase()}" data-discord="${(tag||'').toLowerCase()}" data-added="${op.addedDate||''}">
                        <img class="pu-r-avatar" src="${avatarPrimary}" data-alt1="${direct}" data-alt2="${avatarFallback}" onerror="avatarFallback(this)" alt="${name}" loading="lazy" />
                        <div class="pu-r-main">
                            <span class="pu-grade">${op.qualification || '—'}</span>
                            <div class="pu-namebox">
                                <div class="pu-r-name">${name}</div>
                                <div class="pu-r-meta">${tag || '—'}</div>
                            </div>
                        </div>
                        <div class="pu-r-tags">
            <span class="op-chip ${roleChip}">${op.roleName || op.role || 'Ruolo'}</span>
            <span class="op-chip mat-chip">${matricola}</span>
                        </div>
                    </div>`;
            }).join('');
            return `
                <div class="personnel-ultra">
                    <div class="pu-hero">
                        <div class="pu-hero-left">
                            <h1>Struttura Operativa</h1>
                            <p>Aggiornato alle ${lastRefresh}</p>
                        </div>
                        <div class="pu-hero-right">
                            <span class="pu-chip"><span class="dot"></span> Vista Operatore</span>
                        </div>
                    </div>
                    <div class="pu-toolbar">
                        <div>
                            <div class="pu-filters">
                                <button class="filter-pill active" data-role="all">Tutti</button>
                                <button class="filter-pill" data-role="dirigenziale">🏅・Dirigenziale</button>
                                <button class="filter-pill" data-role="amministrativo">📋・Amministrativo</button>
                                <button class="filter-pill" data-role="operativo">👮・Operativo</button>
                            </div>
                            <div class="pu-quick">
                                <button class="quick-btn" onclick="filterPersonnelSuggestion('nuovi')"><i class="fas fa-clock"></i> Recenti</button>
                            </div>
                        </div>
                        <div class="pu-search">
                            <div class="pu-sort">
                                <label for="puSort" style="color:#94a3b8; font-weight:800; font-size:.8rem;">Ordina</label>
                                <select id="puSort">
                                    <option value="name">Nome</option>
                                    <option value="status">Status</option>
                                    <option value="matricola">Matricola</option>
                                </select>
                            </div>
                            <input id="personnelSearch" type="text" placeholder="Cerca operatore (nome o Discord)…" />
                        </div>
                    </div>
                    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom: .75rem;">
                        <div class="pu-segments">
                            <button class="segment-btn active" data-target="#panel-dir">🏅・Dirigenziale</button>
                            <button class="segment-btn" data-target="#panel-amm">📋・Amministrativo</button>
                            <button class="segment-btn" data-target="#panel-ope">👮・Operativo</button>
                        </div>
                    </div>
                    <div class="pu-panel-stack">
                    <div class="pu-panel" id="panel-dir">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-crown" style="color:#fca5a5"></i> Dirigenziale</span>
                                <span class="pu-count">${operators.filter(op=>op.role==='dirigenziale').length}</span>
                            </div>
                            <div class="pu-list">${operators.filter(op=>op.role==='dirigenziale').map(op=>{
                                const name = op.name || 'Operatore';
                                const tag = op.discordTag || '';
                                const qualification = op.qualification || '';
                                const direct = (op.avatarUrl || '').trim();
                                const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const statusClass = op.status === 'Disponibile' ? 'st-ava' : 'st-busy';
                                // Design Illustrator: card orizzontale pulita con 2 righe - Nucleo come chip rossa
                                return `
                                <div class=\"op-card operator-card\" data-role=\"dirigenziale\" data-name=\"${(name||'').toLowerCase()}\" data-discord=\"${(tag||'').toLowerCase()}\" data-added=\"${op.addedDate||''}\" style=\"display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(30,41,59,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;\"> 
                                    <img class=\"op-avatar\" src=\"${avatarPrimary}\" data-alt1=\"${direct}\" data-alt2=\"${avatarFallback}\" onerror=\"avatarFallback(this)\" alt=\"${name}\" loading=\"lazy\" style=\"width:64px;height:64px;border-radius:50%;object-fit:cover;flex-shrink:0;background:#000;\" />
                                    <div style=\"flex:1;display:flex;flex-direction:column;gap:0.5rem;\">
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-weight:700;\">
                                            <span>${name}</span>
                                            <span style=\"color:#94a3b8;font-weight:600;\">${op.matricola||'N/A'}</span>
                                        </div>
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;gap:0.5rem;\">
                                            <span style=\"color:#94a3b8;background:rgba(148,163,184,0.15);border:1px solid rgba(148,163,184,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${qualification || '—'}</span>
                                            <span style=\"color:#ef4444;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${op.roleName || 'Dirigenziale'}</span>
                                        </div>
                                    </div>
                                </div>`;}).join('')}
                            </div>
                        </div>
                        <div class="pu-panel hidden" id="panel-amm">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-clipboard-list" style="color:#6ee7b7"></i> Amministrativo</span>
                                <span class="pu-count">${operators.filter(op=>op.role==='amministrativo').length}</span>
                            </div>
                            <div class="pu-list">${operators.filter(op=>op.role==='amministrativo').map(op=>{
                                const name = op.name || 'Operatore';
                                const tag = op.discordTag || '';
                                const qualification = op.qualification || '';
                                const direct = (op.avatarUrl || '').trim();
                                const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const statusClass = op.status === 'Disponibile' ? 'st-ava' : 'st-busy';
                                // Design Illustrator: card orizzontale pulita con 2 righe - Nucleo come chip verde
                                return `
                                <div class=\"op-card operator-card\" data-role=\"amministrativo\" data-name=\"${(name||'').toLowerCase()}\" data-discord=\"${(tag||'').toLowerCase()}\" data-added=\"${op.addedDate||''}\" style=\"display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(30,41,59,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;\"> 
                                    <img class=\"op-avatar\" src=\"${avatarPrimary}\" data-alt1=\"${direct}\" data-alt2=\"${avatarFallback}\" onerror=\"avatarFallback(this)\" alt=\"${name}\" loading=\"lazy\" style=\"width:64px;height:64px;border-radius:50%;object-fit:cover;flex-shrink:0;background:#000;\" />
                                    <div style=\"flex:1;display:flex;flex-direction:column;gap:0.5rem;\">
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-weight:700;\">
                                            <span>${name}</span>
                                            <span style=\"color:#94a3b8;font-weight:600;\">${op.matricola||'N/A'}</span>
                                        </div>
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;gap:0.5rem;\">
                                            <span style=\"color:#94a3b8;background:rgba(148,163,184,0.15);border:1px solid rgba(148,163,184,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${qualification || '—'}</span>
                                            <span style=\"color:#10b981;background:rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${op.roleName || 'Amministrativo'}</span>
                                        </div>
                                    </div>
                                </div>`;}).join('')}
                            </div>
                        </div>
                        <div class="pu-panel hidden" id="panel-ope">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-shield-alt" style="color:#93c5fd"></i> Operativo</span>
                                <span class="pu-count">${operators.filter(op=>op.role==='operativo').length}</span>
                            </div>
                            <div class="pu-list">${operators.filter(op=>op.role==='operativo').map(op=>{
                                const name = op.name || 'Operatore';
                                const tag = op.discordTag || '';
                                const qualification = op.qualification || '';
                                const direct = (op.avatarUrl || '').trim();
                                const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                                const statusClass = op.status === 'Disponibile' ? 'st-ava' : 'st-busy';
                                // Design Illustrator: card orizzontale pulita con 2 righe - Nucleo come chip blu
                                return `
                                <div class=\"op-card operator-card\" data-role=\"operativo\" data-name=\"${(name||'').toLowerCase()}\" data-discord=\"${(tag||'').toLowerCase()}\" data-added=\"${op.addedDate||''}\" style=\"display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(30,41,59,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;\"> 
                                    <img class=\"op-avatar\" src=\"${avatarPrimary}\" data-alt1=\"${direct}\" data-alt2=\"${avatarFallback}\" onerror=\"avatarFallback(this)\" alt=\"${name}\" loading=\"lazy\" style=\"width:64px;height:64px;border-radius:50%;object-fit:cover;flex-shrink:0;background:#000;\" />
                                    <div style=\"flex:1;display:flex;flex-direction:column;gap:0.5rem;\">
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-weight:700;\">
                                            <span>${name}</span>
                                            <span style=\"color:#94a3b8;font-weight:600;\">${op.matricola||'N/A'}</span>
                                        </div>
                                        <div style=\"display:flex;justify-content:space-between;align-items:center;gap:0.5rem;\">
                                            <span style=\"color:#94a3b8;background:rgba(148,163,184,0.15);border:1px solid rgba(148,163,184,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${qualification || '—'}</span>
                                            <span style=\"color:#3b82f6;background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;\">${op.roleName || 'Operativo'}</span>
                                        </div>
                                    </div>
                                </div>`;}).join('')}
                            </div>
                        </div>
                    </div>
                    ${getFooterDisclaimer()}
                </div>`;
        }
        function getPersonnelPage() {
            // Tutti gli utenti autorizzati possono vedere la vista completa della Gerarchia
            console.log('🏅 Accesso Gerarchia - Vista completa per tutti gli utenti autorizzati');
            
            // Controllo di sicurezza per l'array operators
            if (!operators || !Array.isArray(operators)) {
                console.warn('⚠️ Array operators non valido, inizializzo...');
                operators = [];
            }
            
            console.log('📊 DEBUG: operators array:', operators);
            console.log('📊 DEBUG: operators.length:', operators.length);
            
            // Raggruppa operatori per nucleo (solo per admin)
            const roleOrder = {
                'Comandante Generale': 1,
                'Comandante': 2,
                'Vice Comandante': 3,
                'Sostituto Vice Comandante': 4,
                'Capitano': 5,
                'Caposquadra': 6,
                'Vice Caposquadra': 7,
                'Coordinatore': 8,
                'Tecnico Esperto': 9,
                'Tecnico Specializzato': 10,
                'Tecnico': 11,
                'Operatore Qualificato': 12,
                'Operatore Scelto': 13,
                'Operatore': 14,
                'Operatore in Prova': 15
            };
            const normalizeGrade = (q)=> (q||'').toString().replace(/^[^A-Za-zÀ-ÿ]+[\s・.-]*/,'').trim();
            const byGrade = (a,b)=>{
                const aVal = roleOrder[normalizeGrade(a.qualification)] || 999;
                const bVal = roleOrder[normalizeGrade(b.qualification)] || 999;
                if (aVal !== bVal) return aVal - bVal;
                return (a.name||'').localeCompare(b.name||'', 'it', {sensitivity:'base'});
            };
            // Manteniamo l'ordine originale del JSON
            const dirigenzialeOps = operators.filter(op => op.role === 'dirigenziale');
            const amministrativoOps = operators.filter(op => op.role === 'amministrativo');
            const operativoOps = operators.filter(op => op.role === 'operativo');
            
            console.log('📊 Statistiche operatori per admin:');
            console.log('  - Dirigenziali:', dirigenzialeOps.length);
            console.log('  - Amministrativi:', amministrativoOps.length);
            console.log('  - Operativi:', operativoOps.length);

            // Funzione per creare le righe degli operatori
            const createOperatorRows = (operatorsList, showActions = true) => {
                return operatorsList.map(operator => {
                    const statusColor = operator.status === 'Disponibile' ? '#10b981' : '#3b82f6';
                    const statusBg = operator.status === 'Disponibile' ? '#10b98120' : '#3b82f620';
                    
                    // Colori per i ruoli basati sul nucleo
                    const roleColors = {
                        'dirigenziale': { color: '#ef4444', bg: 'rgba(239, 68, 68, 0.1)', border: 'rgba(239, 68, 68, 0.3)' },
                        'amministrativo': { color: '#10b981', bg: 'rgba(16, 185, 129, 0.1)', border: 'rgba(16, 185, 129, 0.3)' },
                        'operativo': { color: '#3b82f6', bg: 'rgba(59, 130, 246, 0.1)', border: 'rgba(59, 130, 246, 0.3)' }
                    };
                    
                    const roleStyle = roleColors[operator.role] || { color: '#94a3b8', bg: 'rgba(148, 163, 184, 0.1)', border: 'rgba(148, 163, 184, 0.3)' };
                    
            return `
                        <tr>
                            <td>
                                <div style="display: flex; flex-direction: column; gap: 0.25rem;">
                                    <strong style="color: var(--text-primary);">${operator.name}</strong>
                                    <span style="font-size: 0.75rem; color: var(--text-muted);">${operator.discordTag}</span>
                                </div>
                            </td>
                            <td>
                                <span style="color: var(--text-secondary); font-weight: 600;">${operator.qualification}</span>
                            </td>
                            <td>
                                <span style="padding: 0.25rem 0.75rem; background: ${roleStyle.bg}; color: ${roleStyle.color}; border-radius: 1rem; font-size: 0.75rem; font-weight: 700; border: 1px solid ${roleStyle.border};">
                                    ${operator.roleName || 'N/A'}
                                </span>
                            </td>
                            <td>
                                <span style="padding: 0.25rem 0.75rem; background: ${statusBg}; color: ${statusColor}; border-radius: 1rem; font-size: 0.75rem; font-weight: 700;">
                                    ${operator.status}
                                </span>
                            </td>
                            <td>
                                <span style="color: var(--text-muted); font-size: 0.875rem;">${operator.addedDate}</span>
                            </td>
                            <td>
                                <span style="padding: 0.5rem 1rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.1)); color: #3b82f6; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 700; border: 1px solid rgba(59, 130, 246, 0.3); font-family: 'Courier New', monospace; letter-spacing: 0.05em;">
                                    ${operator.matricola || 'N/A'}
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('');
            };
            // Funzione per creare una sezione gerarchica moderna (card grid)
            const createHierarchicalSection = (nucleo, operatorsList, icon, description, title, showActions = true) => {
                if (!operatorsList || operatorsList.length === 0) return '';

                const total = operatorsList.length;
                const availableCount = operatorsList.filter(op => op.status === 'Disponibile').length;
                const readiness = total ? Math.round((availableCount / total) * 100) : 0;

                const cardsHtml = operatorsList.map(op => {
                    const name = op.name || op.discordTag || 'Operatore';
                    const tag = op.discordTag || '';
                    const qualification = op.qualification || '';
                    const direct = (op.avatarUrl || '').trim();
                    const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                    const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                    const matricola = op.matricola || 'N/A';
                    const roleClass = op.role || '';
                    const roleLabel = op.roleName || op.role || 'Ruolo';
                    const statusLabel = '';
                    const addedAt = op.addedDate || '';
                    const nameKey = name.toLowerCase();
                    const tagKey = tag.toLowerCase();

                    // Design Illustrator: card orizzontale pulita con 2 righe
                    // Colori chip nucleo: dirigenziale=rosso, amministrativo=verde, operativo=blu
                    const nucleoChipColor = roleClass === 'dirigenziale' ? 'color:#ef4444;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);' : 
                                           roleClass === 'amministrativo' ? 'color:#10b981;background:rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.3);' : 
                                           'color:#3b82f6;background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);';
                    let card = '';
                    card += '<div class="operator-card" data-role="' + roleClass + '" data-name="' + nameKey + '" data-discord="' + tagKey + '" data-added="' + addedAt + '" style="display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(30,41,59,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;">';
                    card +=   '<img class="operator-avatar-img" src="' + avatarPrimary + '" data-alt1="' + direct + '" data-alt2="' + avatarFallback + '" onerror="avatarFallback(this)" alt="' + name + '" referrerpolicy="no-referrer" crossorigin="anonymous" loading="lazy" style="width:64px;height:64px;border-radius:50%;object-fit:cover;flex-shrink:0;background:#000;" />';
                    card +=   '<div style="flex:1;display:flex;flex-direction:column;gap:0.5rem;">';
                    card +=     '<div style="display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-weight:700;">';
                    card +=       '<span>' + name + '</span>';
                    card +=       '<span style="color:#94a3b8;font-weight:600;">' + matricola + '</span>';
                    card +=     '</div>';
                    card +=     '<div style="display:flex;justify-content:space-between;align-items:center;gap:0.5rem;">';
                    card +=       '<span style="color:#94a3b8;background:rgba(148,163,184,0.15);border:1px solid rgba(148,163,184,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;">' + (qualification || '—') + '</span>';
                    card +=       '<span style="' + nucleoChipColor + 'padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;">' + roleLabel + '</span>';
                    card +=     '</div>';
                    card +=   '</div>';
                    card += '</div>';
                    return card;
                }).join('');

                return `
                    <section class="hierarchical-section ${nucleo}">
                        <div class="hierarchy-head">
                            <div class="head-left">
                                <div class="hierarchical-icon ${nucleo}"><i class="fas fa-${icon}"></i></div>
                                <div class="head-copy">
                                    <h2>${title}</h2>
                                    <p>${description}</p>
                                </div>
                            </div>
                            <div class="head-metrics">
                                <div class="head-metric">
                                    <div class="metric-icon"><i class="fas fa-users"></i></div>
                                    <span class="metric-value">${total}</span>
                                    <span class="metric-label">Operatori</span>
                                </div>
                                <div class="head-metric">
                                    <div class="metric-icon"><i class="fas fa-circle-notch"></i></div>
                                    <span class="metric-value">${availableCount}</span>
                                    <span class="metric-label">Disponibili</span>
                                </div>
                                <div class="head-metric">
                                    <div class="metric-icon"><i class="fas fa-bolt"></i></div>
                                    <span class="metric-value">${readiness}%</span>
                                    <span class="metric-label">Prontezza</span>
                                </div>
                            </div>
                        </div>
                        <div class="hierarchy-body">
                            <div class="operator-grid" data-nucleo="${nucleo}">
                                ${cardsHtml}
                            </div>
                        </div>
                    </section>
                `;
            };

            const emptyState = operators.length === 0 ? `
                <div class="hierarchical-section" style="text-align: center; padding: 4rem 2rem;">
                    <div style="font-size: 4rem; margin-bottom: 1.5rem; opacity: 0.6;">👥</div>
                    <h2 style="color: #e2e8f0; margin-bottom: 1rem; font-size: 2rem;">Nessun Operatore Presente</h2>
                    <p style="color: #94a3b8; margin-bottom: 2rem; font-size: 1.125rem;">Inizia aggiungendo il primo operatore al sistema</p>
                    <button class="btn btn-primary" onclick="openAddOperator()" style="padding: 1rem 2rem; font-size: 1.125rem;">
                        <i class="fas fa-user-plus"></i> Aggiungi Primo Operatore
                    </button>
                </div>
            ` : '';
            // Controlla se l'utente è admin per mostrare i pulsanti di gestione
            const currentAccessLevel = getCurrentAccessLevel();
            const isAdmin = currentAccessLevel === 'admin';
            const totalOperators = operators.length;
            const availableOperators = operators.filter(op => op.status === 'Disponibile').length;
            const lastRefresh = new Date().toLocaleString('it-IT', { hour: '2-digit', minute: '2-digit' });
            
            const makeCards = (list) => list.map(op => {
                const name = op.name || op.discordTag || 'Operatore';
                const tag = op.discordTag || '';
                const qualification = op.qualification || '';
                const direct = (op.avatarUrl || '').trim();
                const avatarPrimary = direct ? proxyImage(direct) : `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                const avatarFallback = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=0D1117&color=FFFFFF&bold=true`;
                const roleClass = op.role || '';
                const roleLabel = op.roleName || op.role || 'Nucleo';
                const matricola = op.matricola || 'N/A';
                // Colori chip nucleo: dirigenziale=rosso, amministrativo=verde, operativo=blu
                const nucleoChipColor = roleClass === 'dirigenziale' ? 'color:#ef4444;background:rgba(239,68,68,0.15);border:1px solid rgba(239,68,68,0.3);' : 
                                       roleClass === 'amministrativo' ? 'color:#10b981;background:rgba(16,185,129,0.15);border:1px solid rgba(16,185,129,0.3);' : 
                                       'color:#3b82f6;background:rgba(59,130,246,0.15);border:1px solid rgba(59,130,246,0.3);';
                // Design Illustrator: card orizzontale pulita con 2 righe
                return `
                    <div class="pu-row operator-card" data-role="${roleClass}" data-name="${(name||'').toLowerCase()}" data-discord="${(tag||'').toLowerCase()}" data-added="${op.addedDate||''}" style="display:flex;align-items:center;gap:1rem;padding:1rem;background:rgba(30,41,59,0.6);border:1px solid rgba(255,255,255,0.1);border-radius:0.75rem;">
                        <img class="pu-r-avatar" src="${avatarPrimary}" data-alt1="${direct}" data-alt2="${avatarFallback}" onerror="avatarFallback(this)" alt="${name}" loading="lazy" style="width:64px;height:64px;border-radius:50%;object-fit:cover;flex-shrink:0;background:#000;" />
                        <div style="flex:1;display:flex;flex-direction:column;gap:0.5rem;">
                            <div style="display:flex;justify-content:space-between;align-items:center;color:#ffffff;font-weight:700;">
                                <span>${name}</span>
                                <span style="color:#94a3b8;font-weight:600;">${matricola}</span>
                            </div>
                            <div style="display:flex;justify-content:space-between;align-items:center;gap:0.5rem;">
                                <span style="color:#94a3b8;background:rgba(148,163,184,0.15);border:1px solid rgba(148,163,184,0.3);padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;">${qualification || '—'}</span>
                                <span style="${nucleoChipColor}padding:0.25rem 0.75rem;border-radius:1rem;font-size:0.75rem;font-weight:700;">${roleLabel}</span>
                            </div>
                        </div>
                    </div>`;
            }).join('');

            return `
                <div class="personnel-ultra">
                    <div class="pu-hero">
                        <div class="pu-hero-left">
                            <h1>🏅・Gestione Gerarchia</h1>
                            <p>Operatori: ${totalOperators} · Disponibili: ${availableOperators} · Aggiornato ${lastRefresh}</p>
                        </div>
                        <div class="pu-hero-right">
                            <span class="pu-chip"><i class="fas fa-user-shield"></i> ${isAdmin ? 'Admin' : 'Operatore'}</span>
                            ${isAdmin ? `<button class="pu-chip" onclick="openAddOperator()"><i class="fas fa-user-plus"></i> Aggiungi</button>` : ''}
                            ${isAdmin ? `<button class="pu-chip" onclick="createBackup()"><i class="fas fa-download"></i> Backup</button>` : ''}
                            ${isAdmin ? `<button class="pu-chip" onclick="restoreFromBackup()"><i class="fas fa-upload"></i> Ripristina</button>` : ''}
                        </div>
                    </div>
                    <div class="pu-toolbar">
                        <div>
                            <div class="pu-filters">
                                <button class="filter-pill active" data-role="dirigenziale">🏅・Dirigenziale</button>
                                <button class="filter-pill" data-role="amministrativo">📋・Amministrativo</button>
                                <button class="filter-pill" data-role="operativo">👮・Operativo</button>
                            </div>
                        </div>
                    </div>
                    ${operators.length === 0 ? '<div class="ultra-empty"><div class="ultra-empty-icon"><i class="fas fa-users"></i></div><h2>Nessun Operatore</h2><p>Aggiungi un operatore per iniziare la gestione.</p><button class="btn btn-primary" onclick="openAddOperator()"><i class=\"fas fa-user-plus\"></i> Aggiungi Operatore</button></div>' : ''}
                    <div class="pu-panel-stack">
                        <div class="pu-panel" id="admin-panel-dir">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-crown"></i> Nucleo Dirigenziale</span>
                                <span class="pu-count">${dirigenzialeOps.length}</span>
                            </div>
                            <div class="pu-list">${makeCards(dirigenzialeOps)}</div>
                        </div>
                        <div class="pu-panel hidden" id="admin-panel-amm">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-clipboard-list"></i> Nucleo Amministrativo</span>
                                <span class="pu-count">${amministrativoOps.length}</span>
                            </div>
                            <div class="pu-list">${makeCards(amministrativoOps)}</div>
                        </div>
                        <div class="pu-panel hidden" id="admin-panel-ope">
                            <div class="pu-panel-head">
                                <span class="pu-panel-title"><i class="fas fa-shield-alt"></i> Nucleo Operativo</span>
                                <span class="pu-count">${operativoOps.length}</span>
                            </div>
                            <div class="pu-list">${makeCards(operativoOps)}</div>
                        </div>
                    </div>
                    ${getFooterDisclaimer()}
                </div>
            `;
        }
        function getShiftsPage() {
            const currentAccessLevel = getCurrentAccessLevel();
            const isAdmin = currentAccessLevel === 'admin';
            
            // Modulo unificato per gestione turni
            const activationModule = `
                <div class="unified-form-container" style="margin-bottom: 2rem;">
                    <div class="card" style="background: linear-gradient(135deg, rgba(59,130,246,0.1) 0%, rgba(37,99,235,0.05) 100%); border: 2px solid rgba(59,130,246,0.3); border-radius: 1.5rem; padding: 2rem; position: relative; overflow: hidden;">
                        <div style="position: absolute; top: -50%; right: -20%; width: 60%; height: 200%; background: radial-gradient(circle, rgba(59,130,246,0.1) 0%, transparent 60%); animation: pulse 20s ease-in-out infinite;"></div>
                        
                        <div style="position: relative; z-index: 1;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
                                <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border-radius: 1rem; display: flex; align-items: center; justify-content: center; font-size: 1.75rem; box-shadow: 0 10px 20px rgba(59,130,246,0.3);">
                                    📝
                                </div>
                                <div>
                                    <h2 style="font-size: 1.875rem; font-weight: 800; color: #ffffff; margin: 0;">Modulista Gestione U.O.P.I</h2>
                                    <p style="color: #94a3b8; margin: 0; font-size: 1rem;">Compila il modulo per attivare o disattivare i servizi</p>
                                </div>
                            </div>
                            
                            <div style="background: rgba(15,23,42,0.6); border: 1px solid rgba(255,255,255,0.1); border-radius: 1rem; padding: 1.5rem; margin-bottom: 1.5rem; position: relative; min-height: 700px;">
                                <iframe 
                                    id="googleFormFrame"
                                    src="https://docs.google.com/forms/d/e/1FAIpQLSe-zN2WvqMU_P1Kw2fIVk-VwmhzRo3b07j0XndrVKpuSQQrWg/viewform?embedded=true" 
                                    width="100%" 
                                    height="700" 
                                    frameborder="0" 
                                    marginheight="0" 
                                    marginwidth="0"
                                    scrolling="yes"
                                    allow="fullscreen"
                                    style="border-radius: 0.75rem; background: #ffffff; border: none; display: block;"
                                    ></iframe>
                                <div id="formLoader" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #94a3b8; font-size: 1rem; font-weight: 600; z-index: 10;">
                                    <i class="fas fa-spinner fa-spin"></i> Caricamento modulo in corso...
                                </div>
                                <div id="formError" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); color: #f87171; font-size: 1rem; font-weight: 600; text-align: center; display: none; z-index: 10; background: rgba(15,23,42,0.95); padding: 2rem; border-radius: 1rem; border: 2px solid rgba(248,113,113,0.3); max-width: 500px;">
                                    <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                                    <p style="margin: 0 0 1rem 0;">Il modulo non è accessibile direttamente.</p>
                                    <p style="margin: 0; font-size: 0.875rem; color: #94a3b8;">Clicca il pulsante "Apri in Nuova Finestra" qui sotto per compilare il modulo.</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button class="btn btn-primary" onclick="window.open('https://docs.google.com/forms/d/e/1FAIpQLSe-zN2WvqMU_P1Kw2fIVk-VwmhzRo3b07j0XndrVKpuSQQrWg/viewform', '_blank')" style="padding: 1rem 2rem; font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-external-link-alt"></i> Apri in Nuova Finestra
                                </button>
                                ${isAdmin ? `<button class="btn btn-secondary" onclick="refreshShifts()" style="padding: 1rem 2rem; font-size: 1rem; font-weight: 700; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-sync-alt"></i> Aggiorna Turni
                                </button>` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            if (shifts.length === 0) {
                return activationModule + `
                    <div class="card" style="text-align: center; padding: 3rem; margin-top: 2rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem; opacity: 0.5;">📋</div>
                        <h3 style="color: #e2e8f0; margin-bottom: 1rem;">Nessun Turno Registrato</h3>
                        <p style="color: #94a3b8; margin-bottom: 2rem;">I turni compariranno qui dopo la compilazione del modulo sopra</p>
                    </div>
                    
                    ${getFooterDisclaimer()}
                `;
            }

            // Contenuto dei turni esistenti con il modulo sopra
            const shiftsContent = `<div style="margin-top: 2rem;">`;
            
            // Raggruppa i turni per giorno
            const shiftsByDay = {};
            shifts.forEach(shift => {
                const date = shift.createdDate;
                if (!shiftsByDay[date]) {
                    shiftsByDay[date] = [];
                }
                shiftsByDay[date].push(shift);
            });
            // Ordina le date, filtrando quelle undefined o null
            const sortedDates = Object.keys(shiftsByDay)
                .filter(date => date && date !== 'undefined' && date !== 'null')
                .sort((a, b) => new Date(b) - new Date(a));

            const shiftsHTML = sortedDates.map(date => {
                // Controllo iniziale per date undefined o null
                if (!date || date === 'undefined' || date === 'null') {
                    console.error('❌ Data undefined o null:', date);
                    return `<div class="card"><p>❌ Errore: Data non valida</p></div>`;
                }
                
                const dayShifts = shiftsByDay[date];
                // Converte la data italiana (dd/mm/yyyy) in formato ISO per il parsing
                const dateParts = date.split('/');
                
                // Controlli di sicurezza per evitare errori padStart
                if (!dateParts || dateParts.length !== 3 || !dateParts[0] || !dateParts[1] || !dateParts[2]) {
                    console.error('❌ Formato data non valido:', date);
                    return `<div class="card"><p>❌ Errore formato data: ${date}</p></div>`;
                }
                
                const isoDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
                const dateObj = new Date(isoDate);
                
                // Controlla se la data è valida
                if (isNaN(dateObj.getTime())) {
                    console.error('❌ Data non valida:', isoDate);
                    return `<div class="card"><p>❌ Errore data non valida: ${date}</p></div>`;
                }
                
                const dayNameRaw = dateObj.toLocaleDateString('it-IT', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
                
                // Capitalizza la prima lettera del giorno e del mese
                const dayName = dayNameRaw.replace(/\b\w/g, l => l.toUpperCase());

                // Separa attivazioni e disattivazioni con controlli di sicurezza
                const activations = dayShifts.filter(shift => shift && shift.moduleType === 'patrol-activation');
                const deactivations = dayShifts.filter(shift => shift && shift.moduleType === 'patrol-deactivation');
                return `
                    <div class="shifts-day-container">
                        <!-- Header Giorno -->
                        <div class="shifts-day-header">
                            <div class="day-info">
                                <div class="day-icon">
                                    <i class="fas fa-calendar-day"></i>
                                </div>
                                <div class="day-details">
                                    <h2 class="day-title">${dayName || 'Data non valida'}</h2>
                                    <p class="day-subtitle">${dayShifts ? dayShifts.length : 0} turno${(dayShifts ? dayShifts.length : 0) !== 1 ? 'i' : ''} attivat${(dayShifts ? dayShifts.length : 0) !== 1 ? 'i' : 'o'}</p>
                                </div>
                            </div>
                            <div class="day-stats">
                                <div class="stat-item">
                                    <div class="stat-icon active">
                                        <i class="fas fa-play-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <span class="stat-number">${activations ? activations.length : 0}</span>
                                        <span class="stat-label">Attivi</span>
                                    </div>
                                </div>
                                <div class="stat-item">
                                    <div class="stat-icon completed">
                                        <i class="fas fa-stop-circle"></i>
                                    </div>
                                    <div class="stat-content">
                                        <span class="stat-number">${deactivations ? deactivations.length : 0}</span>
                                        <span class="stat-label">Completati</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contenuto Turni -->
                        <div class="shifts-content">
                            ${activations && activations.length > 0 ? `
                                <div class="shifts-section">
                                    <div class="section-header">
                                        <div class="section-title">
                                            <div class="title-icon active">
                                                <i class="fas fa-play-circle"></i>
                                            </div>
                                            <div class="title-text">
                                                <h3>Attivazioni Pattuglie</h3>
                                                <p>Turni operativi attualmente in corso</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="shifts-grid">
                                        ${activations.map(shift => shift ? createModernShiftCard(shift, false) : '').join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            ${deactivations && deactivations.length > 0 ? `
                                <div class="shifts-section">
                                    <div class="section-header">
                                        <div class="section-title">
                                            <div class="title-icon completed">
                                                <i class="fas fa-stop-circle"></i>
                                            </div>
                                            <div class="title-text">
                                                <h3>Disattivazioni Pattuglie</h3>
                                                <p>Turni completati e archiviati</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="shifts-grid">
                                        ${deactivations.map(shift => shift ? createModernShiftCard(shift, true) : '').join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            return activationModule + `
                <div class="shifts-page-container">
                    ${shiftsHTML}
                </div>
                
                ${getFooterDisclaimer()}
            `;
        }
        
        function refreshShifts() {
            UI.notify('🔄 Aggiornamento turni...', 'info');
            setTimeout(() => {
                loadPage('shifts');
                UI.notify('✅ Turni aggiornati!', 'success');
            }, 1000);
        }
        
        function initGoogleFormLoader() {
            setTimeout(() => {
                const frame = document.getElementById('googleFormFrame');
                const loader = document.getElementById('formLoader');
                const errorDiv = document.getElementById('formError');
                
                if (frame && loader) {
                    let loaded = false;
                    
                    frame.addEventListener('load', function() {
                        loaded = true;
                        setTimeout(() => {
                            if (loader) loader.style.display = 'none';
                            if (errorDiv) errorDiv.style.display = 'none';
                        }, 1500);
                    });
                    
                    setTimeout(() => {
                        try {
                            const frameDoc = frame.contentDocument || (frame.contentWindow && frame.contentWindow.document);
                            if (!frameDoc || !frameDoc.body || frameDoc.body.children.length === 0) {
                                if (!loaded) {
                                    if (loader) loader.style.display = 'none';
                                    if (errorDiv) errorDiv.style.display = 'block';
                                }
                            }
                        } catch (e) {
                            console.log('Frame access check:', e.message);
                        }
                    }, 5000);
                    
                    setTimeout(() => {
                        if (loader && !loaded) {
                            loader.style.display = 'none';
                            if (errorDiv) errorDiv.style.display = 'block';
                        }
                    }, 8000);
                }
            }, 500);
        }
        
            function getStatusPage() {
                console.log('🔧 getStatusPage() chiamata - Verifico stato countdown');
                
                const isUnlocked = checkUnlockStatus();
                const time = getTimeRemaining();
                
                if (isUnlocked) {
                    // Pagina sbloccata - mostra il contenuto normale
                    return `
                        <div class="card" style="text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">✅</div>
                            <h3 style="color: #10b981; margin-bottom: 1rem;">Sezione Sbloccata!</h3>
                            <p style="color: #94a3b8;">Il contenuto di questa sezione è ora disponibile.</p>
                        </div>
                    `;
                }
                // Pagina bloccata con countdown
                setTimeout(() => startCountdownTimer(), 100);
                
                return `
                    <div class="page-content">
                        <div class="card" style="padding: 3rem;">
                            <h3 style="color: #e2e8f0; margin-bottom: 1rem;">🔒 Contenuto Bloccato</h3>
                            <p style="color: #94a3b8;">Questa sezione è attualmente in fase di sviluppo e sarà disponibile tra 30 giorni.</p>
                            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1rem; margin-top: 1rem;">
                                <p style="color: #f59e0b; margin: 0; font-size: 0.875rem;">
                                    ⚠️ <strong>In Sviluppo:</strong> Le funzionalità di questa sezione sono ancora in fase di implementazione.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="countdown-overlay">
                        <div class="countdown-message">
                            <div class="countdown-icon">🔒</div>
                            <h3 class="countdown-title">Sezione Bloccata</h3>
                            <p class="countdown-subtitle">🚧・Questa sezione è in fase di Sviluppo</p>
                            
                            <div class="countdown-timer">
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.days}</div>
                                    <div class="countdown-label">Giorni</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.hours}</div>
                                    <div class="countdown-label">Ore</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.minutes}</div>
                                    <div class="countdown-label">Minuti</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.seconds}</div>
                                    <div class="countdown-label">Secondi</div>
                                </div>
                            </div>
                            
                            <p class="countdown-date">🗓️ Disponibile dal ${getUnlockDateFormatted()}</p>
                        </div>
                    </div>
                    
                    ${getFooterDisclaimer()}
                `;
            }
            function getOperationsPage() {
                console.log('🔧 getOperationsPage() chiamata - Verifico stato countdown');
                
                const isUnlocked = checkUnlockStatus();
                const time = getTimeRemaining();
                
                if (isUnlocked) {
                    // Pagina sbloccata - mostra il contenuto normale
                    return `
                        <div class="card" style="text-align: center; padding: 3rem;">
                            <div style="font-size: 4rem; margin-bottom: 1rem;">✅</div>
                            <h3 style="color: #10b981; margin-bottom: 1rem;">Sezione Sbloccata!</h3>
                            <p style="color: #94a3b8;">Il contenuto di questa sezione è ora disponibile.</p>
                        </div>
                    `;
                }
                
                // Pagina bloccata con countdown
                setTimeout(() => startCountdownTimer(), 100);
                
                return `
                    <div class="page-content">
                        <div class="card" style="padding: 3rem;">
                            <h3 style="color: #e2e8f0; margin-bottom: 1rem;">🔒 Contenuto Bloccato</h3>
                            <p style="color: #94a3b8;">Questa sezione è attualmente in fase di sviluppo e sarà disponibile tra 30 giorni.</p>
                            <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1rem; margin-top: 1rem;">
                                <p style="color: #f59e0b; margin: 0; font-size: 0.875rem;">
                                    ⚠️ <strong>In Sviluppo:</strong> Le funzionalità di questa sezione sono ancora in fase di implementazione.
                                </p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="countdown-overlay">
                        <div class="countdown-message">
                            <div class="countdown-icon">🔒</div>
                            <h3 class="countdown-title">Sezione Bloccata</h3>
                            <p class="countdown-subtitle">🚧・Questa sezione è in fase di Sviluppo</p>
                            
                            <div class="countdown-timer">
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.days}</div>
                                    <div class="countdown-label">Giorni</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.hours}</div>
                                    <div class="countdown-label">Ore</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.minutes}</div>
                                    <div class="countdown-label">Minuti</div>
                                </div>
                                <div class="countdown-unit">
                                    <div class="countdown-number">${time.seconds}</div>
                                    <div class="countdown-label">Secondi</div>
                                </div>
                            </div>
                            
                            <p class="countdown-date">🗓️ Disponibile dal ${getUnlockDateFormatted()}</p>
                        </div>
                    </div>
                    
                    ${getFooterDisclaimer()}
                `;
        }
        function getAnnouncementsPage() {
            console.log('🔧 getAnnouncementsPage() chiamata - Verifico stato countdown');
            
            const isUnlocked = checkUnlockStatus();
            const time = getTimeRemaining();
            
            if (isUnlocked) {
                // Pagina sbloccata - mostra il contenuto normale
                return `
                    <div class="card" style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">✅</div>
                        <h3 style="color: #10b981; margin-bottom: 1rem;">Sezione Sbloccata!</h3>
                        <p style="color: #94a3b8;">Il contenuto di questa sezione è ora disponibile.</p>
                    </div>
                `;
            }
            
            // Pagina bloccata con countdown
            setTimeout(() => startCountdownTimer(), 100);
            
            return `
                <div class="page-content">
                    <div class="card" style="padding: 3rem;">
                        <h3 style="color: #e2e8f0; margin-bottom: 1rem;">🔒 Contenuto Bloccato</h3>
                        <p style="color: #94a3b8;">Questa sezione è attualmente in fase di sviluppo e sarà disponibile tra 30 giorni.</p>
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1rem; margin-top: 1rem;">
                            <p style="color: #f59e0b; margin: 0; font-size: 0.875rem;">
                                ⚠️ <strong>In Sviluppo:</strong> Le funzionalità di questa sezione sono ancora in fase di implementazione.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="countdown-overlay">
                    <div class="countdown-message">
                        <div class="countdown-icon">🔒</div>
                        <h3 class="countdown-title">Sezione Bloccata</h3>
                        <p class="countdown-subtitle">🚧・Questa sezione è in fase di Sviluppo</p>
                        
                        <div class="countdown-timer">
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.days}</div>
                                <div class="countdown-label">Giorni</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.hours}</div>
                                <div class="countdown-label">Ore</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.minutes}</div>
                                <div class="countdown-label">Minuti</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.seconds}</div>
                                <div class="countdown-label">Secondi</div>
                            </div>
                        </div>
                        
                        <p class="countdown-date">🗓️ Disponibile dal ${getUnlockDateFormatted()}</p>
                    </div>
                </div>
                
                ${getFooterDisclaimer()}
            `;
        }
        function getShadowPage() {
            console.log('🔧 getShadowPage() chiamata - Verifico stato countdown');
            
            const isUnlocked = checkUnlockStatus();
            const time = getTimeRemaining();
            
            if (isUnlocked) {
                // Pagina sbloccata - mostra il contenuto normale
                return `
                    <div class="card" style="text-align: center; padding: 3rem;">
                        <div style="font-size: 4rem; margin-bottom: 1rem;">✅</div>
                        <h3 style="color: #10b981; margin-bottom: 1rem;">Sezione Sbloccata!</h3>
                        <p style="color: #94a3b8;">Il contenuto di questa sezione è ora disponibile.</p>
                    </div>
                `;
            }
            
            // Pagina bloccata con countdown
            setTimeout(() => startCountdownTimer(), 100);
            
            return `
                <div class="page-content">
                    <div class="card" style="padding: 3rem;">
                        <h3 style="color: #e2e8f0; margin-bottom: 1rem;">🔒 Contenuto Bloccato</h3>
                        <p style="color: #94a3b8;">Questa sezione è attualmente in fase di sviluppo e sarà disponibile tra 30 giorni.</p>
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 0.75rem; padding: 1rem; margin-top: 1rem;">
                            <p style="color: #f59e0b; margin: 0; font-size: 0.875rem;">
                                ⚠️ <strong>In Sviluppo:</strong> Le funzionalità di questa sezione sono ancora in fase di implementazione.
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="countdown-overlay">
                    <div class="countdown-message">
                        <div class="countdown-icon">🔒</div>
                        <h3 class="countdown-title">Sezione Bloccata</h3>
                        <p class="countdown-subtitle">🚧・Questa sezione è in fase di Sviluppo</p>
                        
                        <div class="countdown-timer">
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.days}</div>
                                <div class="countdown-label">Giorni</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.hours}</div>
                                <div class="countdown-label">Ore</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.minutes}</div>
                                <div class="countdown-label">Minuti</div>
                            </div>
                            <div class="countdown-unit">
                                <div class="countdown-number">${time.seconds}</div>
                                <div class="countdown-label">Secondi</div>
                            </div>
                        </div>
                        
                        <p class="countdown-date">🗓️ Disponibile dal ${getUnlockDateFormatted()}</p>
                    </div>
                </div>
            `;
        }
        function createModernShiftCard(shift, isDeactivation) {
            const statusColor = shift.status === 'Attivo' ? '#10b981' : '#ef4444';
            const statusText = shift.status === 'Attivo' ? 'ATTIVO' : 'COMPLETATO';
            const cardType = isDeactivation ? 'deactivation' : 'activation';
            
            // Trova gli operatori per evitare "undefined"
            const operator1 = operators.find(op => op.id == shift.operator1Id);
            const operator2 = operators.find(op => op.id == shift.operator2Id);
            const manager = operators.find(op => op.id == shift.managerId);
            
            // Gestisci i valori undefined
            const operator1Name = operator1 ? operator1.name : 'Operatore non trovato';
            const operator2Name = operator2 ? operator2.name : 'Operatore non trovato';
            const managerName = manager ? manager.name : 'Manager non trovato';
            const managerDiscordTag = manager ? manager.discordTag : 'N/A';
            const vehicleName = shift.vehicle || 'Veicolo non specificato';
            const patrolType = shift.patrolTypeName || 'Pattugliamento Cittadino';

            return `
                <div class="modern-shift-card ${cardType}" style="
                    background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9));
                    border: 1px solid rgba(59, 130, 246, 0.2);
                    border-radius: 1rem;
                    padding: 1.5rem;
                    margin-bottom: 1.5rem;
                    position: relative;
                    overflow: hidden;
                    backdrop-filter: blur(10px);
                    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
                    transition: all 0.3s ease;
                " onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 40px rgba(0, 0, 0, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 32px rgba(0, 0, 0, 0.3)'">
                    
                    <!-- Header con Icona e Status -->
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <div style="
                                width: 3rem; 
                                height: 3rem; 
                                background: linear-gradient(135deg, ${statusColor}, ${statusColor}dd);
                                border-radius: 0.75rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: white;
                                font-size: 1.25rem;
                                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
                            ">
                                <i class="fas ${isDeactivation ? 'fa-stop-circle' : 'fa-play-circle'}"></i>
                            </div>
                            <div>
                                <h3 style="color: #fff; margin: 0; font-size: 1.25rem; font-weight: 700;">
                                    ${isDeactivation ? 'Disattivazione Pattuglia' : 'Attivazione Pattuglia'}
                                </h3>
                                <p style="color: #94a3b8; margin: 0; font-size: 0.875rem;">
                                    ${patrolType}
                                </p>
                            </div>
                        </div>
                        <div style="
                            background: ${statusColor};
                            color: white;
                            padding: 0.5rem 1rem;
                            border-radius: 0.5rem;
                            font-weight: 600;
                            font-size: 0.875rem;
                            text-transform: uppercase;
                            letter-spacing: 0.05em;
                        ">
                            ${statusText}
                        </div>
                    </div>
                    <!-- Informazioni Principali -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
                        <div style="
                            background: rgba(59, 130, 246, 0.1);
                            border: 1px solid rgba(59, 130, 246, 0.3);
                            border-radius: 0.75rem;
                            padding: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 0.75rem;
                        ">
                            <div style="
                                width: 2.5rem;
                                height: 2.5rem;
                                background: rgba(59, 130, 246, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #3b82f6;
                            ">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                    Orario
                                </div>
                                <div style="color: #fff; font-weight: 600;">
                                    ${isDeactivation ? shift.activationTime : shift.patrolTime}
                                </div>
                            </div>
                        </div>

                        <div style="
                            background: rgba(16, 185, 129, 0.1);
                            border: 1px solid rgba(16, 185, 129, 0.3);
                            border-radius: 0.75rem;
                            padding: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 0.75rem;
                        ">
                            <div style="
                                width: 2.5rem;
                                height: 2.5rem;
                                background: rgba(16, 185, 129, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #10b981;
                            ">
                                <i class="fas fa-calendar"></i>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                    Data
                                </div>
                                <div style="color: #fff; font-weight: 600;">
                                    ${shift.createdDate}
                                </div>
                            </div>
                        </div>

                        <div style="
                            background: rgba(139, 92, 246, 0.1);
                            border: 1px solid rgba(139, 92, 246, 0.3);
                            border-radius: 0.75rem;
                            padding: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 0.75rem;
                        ">
                            <div style="
                                width: 2.5rem;
                                height: 2.5rem;
                                background: rgba(139, 92, 246, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #8b5cf6;
                            ">
                                <i class="fas fa-user"></i>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                    Gestito da
                                </div>
                                <div style="color: #fff; font-weight: 600;">
                                    ${managerName}
                                </div>
                            </div>
                        </div>

                        <div style="
                            background: rgba(245, 158, 11, 0.1);
                            border: 1px solid rgba(245, 158, 11, 0.3);
                            border-radius: 0.75rem;
                            padding: 1rem;
                            display: flex;
                            align-items: center;
                            gap: 0.75rem;
                        ">
                            <div style="
                                width: 2.5rem;
                                height: 2.5rem;
                                background: rgba(245, 158, 11, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #f59e0b;
                            ">
                                <i class="fas fa-car"></i>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                    Veicolo
                                </div>
                                <div style="color: #fff; font-weight: 600;">
                                    ${vehicleName}
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Sezione Operatori -->
                    <div style="margin-bottom: 1.5rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                            <div style="
                                width: 2rem;
                                height: 2rem;
                                background: rgba(59, 130, 246, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #3b82f6;
                            ">
                                <i class="fas fa-users"></i>
                            </div>
                            <h4 style="color: #fff; margin: 0; font-size: 1rem; font-weight: 600;">
                                Operatori ${isDeactivation ? 'in Rientro' : 'in Uscita'}
                            </h4>
                        </div>
                        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                            <div style="
                                background: linear-gradient(135deg, #3b82f6, #2563eb);
                                color: white;
                                padding: 0.75rem 1rem;
                                border-radius: 0.75rem;
                                font-weight: 600;
                                font-size: 0.875rem;
                                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                            ">
                                ${operator1Name}
                            </div>
                            <div style="
                                background: linear-gradient(135deg, #3b82f6, #2563eb);
                                color: white;
                                padding: 0.75rem 1rem;
                                border-radius: 0.75rem;
                                font-weight: 600;
                                font-size: 0.875rem;
                                box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                            ">
                                ${operator2Name}
                            </div>
                        </div>
                    </div>
                    <!-- Footer con Tag Discord -->
                    <div style="
                        margin-bottom: 1rem;
                        padding: 1rem;
                        background: rgba(88, 28, 135, 0.1);
                        border: 1px solid rgba(88, 28, 135, 0.3);
                        border-radius: 0.75rem;
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                    ">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div style="
                                width: 2rem;
                                height: 2rem;
                                background: rgba(88, 28, 135, 0.2);
                                border-radius: 0.5rem;
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                color: #8b5cf6;
                            ">
                                <i class="fab fa-discord"></i>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 0.75rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.05em;">
                                    Creato da
                                </div>
                                <div style="color: #fff; font-weight: 600;">
                                    ${managerName}
                                </div>
                            </div>
                        </div>
                        <div style="
                            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
                            color: white;
                            padding: 0.5rem 1rem;
                            border-radius: 0.5rem;
                            font-weight: 600;
                            font-size: 0.875rem;
                            font-family: 'Courier New', monospace;
                        ">
                            ${managerDiscordTag}
                        </div>
                    </div>

                    <!-- Pulsante Azione -->
                    <button onclick="editShift('${shift.id}')" style="
                        width: 100%;
                        background: linear-gradient(135deg, #3b82f6, #2563eb);
                        color: white;
                        border: none;
                        padding: 1rem;
                        border-radius: 0 0 0.75rem 0.75rem;
                        font-weight: 600;
                        font-size: 1rem;
                        cursor: pointer;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        gap: 0.5rem;
                        transition: all 0.3s ease;
                        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
                    " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'">
                        <i class="fas fa-edit"></i>
                        <span>Modifica Turno</span>
                    </button>
                </div>
            `;
        }
        function getShiftCard(shift) {
            // Design Ultra-Moderno per le Card delle Attivazioni/Disattivazioni
            const isDeactivation = shift.moduleType === 'patrol-deactivation';
            const primaryColor = isDeactivation ? '#ef4444' : '#10b981';
            const secondaryColor = isDeactivation ? '#dc2626' : '#059669';
            const accentColor = isDeactivation ? '#fca5a5' : '#6ee7b7';
            
            return `
                <div class="ultra-modern-card" style="
                    position: relative;
                    background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.98));
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    border-radius: 2rem;
                    backdrop-filter: blur(32px);
                    overflow: hidden;
                    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
                    box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 
                                0 0 0 1px rgba(255, 255, 255, 0.15),
                                inset 0 1px 0 rgba(255, 255, 255, 0.2);
                    max-width: 450px;
                    margin: 1rem;
                " onmouseover="this.style.transform='translateY(-12px) scale(1.03)'; this.style.boxShadow='0 40px 100px rgba(0, 0, 0, 0.6), 0 0 0 1px rgba(255, 255, 255, 0.3)'" 
                   onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 25px 80px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.15)'">
                    
                    <!-- Accent Gradient Line -->
                    <div style="
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        height: 6px;
                        background: linear-gradient(90deg, ${primaryColor}, ${secondaryColor}, ${accentColor}, ${primaryColor});
                        background-size: 200% 100%;
                        animation: gradientShift 3s ease-in-out infinite;
                        border-radius: 2rem 2rem 0 0;
                    "></div>
                    
                    <!-- Header Ultra-Moderno -->
                    <div style="
                        position: relative;
                        padding: 2rem 2rem 1.5rem;
                        background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
                        border-bottom: 1px solid rgba(255, 255, 255, 0.15);
                    ">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                            <div style="display: flex; align-items: center; gap: 1.25rem;">
                                <div style="
                                    width: 4rem;
                                    height: 4rem;
                                    border-radius: 1.25rem;
                                    background: linear-gradient(135deg, ${primaryColor}, ${secondaryColor});
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 12px 40px rgba(${isDeactivation ? '239, 68, 68' : '16, 185, 129'}, 0.4);
                                    position: relative;
                                    overflow: hidden;
                                ">
                                    <div style="
                                        position: absolute;
                                        top: 0;
                                        left: 0;
                                        right: 0;
                                        bottom: 0;
                                        background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
                                        animation: shimmer 4s infinite;
                                    "></div>
                                    <i class="fas ${isDeactivation ? 'fa-stop-circle' : 'fa-play-circle'}" style="color: white; font-size: 1.75rem; z-index: 1;"></i>
                                </div>
                                <div>
                                    <h3 style="font-size: 1.5rem; font-weight: 900; color: #e2e8f0; margin: 0; letter-spacing: 0.05em; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                                        ${isDeactivation ? 'Disattivazione Pattuglia' : 'Attivazione Pattuglia'}
                                    </h3>
                                    <p style="font-size: 1rem; color: #94a3b8; margin: 0.5rem 0 0; font-weight: 600; letter-spacing: 0.025em;">
                                        ${isDeactivation ? 'Turno Completato' : (shift.patrolTypeName || 'Pattugliamento')}
                                    </p>
                                </div>
                            </div>
                            <div style="
                                padding: 0.75rem 1.25rem;
                                background: linear-gradient(135deg, rgba(${isDeactivation ? '239, 68, 68' : '16, 185, 129'}, 0.25), rgba(${isDeactivation ? '239, 68, 68' : '16, 185, 129'}, 0.15));
                                border: 2px solid ${primaryColor};
                                border-radius: 1.25rem;
                                color: ${primaryColor};
                                font-size: 0.875rem;
                                font-weight: 800;
                                text-transform: uppercase;
                                letter-spacing: 0.1em;
                                box-shadow: 0 8px 24px rgba(${isDeactivation ? '239, 68, 68' : '16, 185, 129'}, 0.3);
                                text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                            ">
                                ${shift.status}
                            </div>
                        </div>
                    </div>
                    <!-- Contenuto Ultra-Moderno -->
                    <div style="padding: 2rem;">
                        <!-- Informazioni Principali -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 2rem;">
                            <div style="
                                background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.08));
                                border: 2px solid rgba(59, 130, 246, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(59, 130, 246, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(59, 130, 246, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #3b82f6, #2563eb); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-clock" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">
                                        ${isDeactivation ? 'Disattivazione' : 'Attivazione'}
                                    </span>
                                </div>
                                <div style="font-size: 1.375rem; font-weight: 900; color: #e2e8f0; letter-spacing: 0.05em; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                                    ${isDeactivation ? shift.deactivationTime : shift.patrolTime}
                                </div>
                            </div>
                            
                            ${!isDeactivation ? `
                            <div style="
                                background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
                                border: 2px solid rgba(16, 185, 129, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(16, 185, 129, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(16, 185, 129, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #10b981, #059669); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-user-tie" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Gestito da</span>
                                </div>
                                <div style="font-size: 1rem; font-weight: 800; color: #e2e8f0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                    ${shift.managerName}
                                </div>
                            </div>
                            ` : `
                            <div style="
                                background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.08));
                                border: 2px solid rgba(239, 68, 68, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(239, 68, 68, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(239, 68, 68, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #ef4444, #dc2626); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-stopwatch" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Durata</span>
                                </div>
                                <div style="font-size: 1.375rem; font-weight: 900; color: #e2e8f0; letter-spacing: 0.05em; text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);">
                                    ${shift.duration || 'N/A'}
                                </div>
                            </div>
                            `}
                        </div>

                        <!-- Informazioni Secondarie -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; margin-bottom: 2rem;">
                            ${!isDeactivation ? `
                            <div style="
                                background: linear-gradient(135deg, rgba(245, 158, 11, 0.15), rgba(245, 158, 11, 0.08));
                                border: 2px solid rgba(245, 158, 11, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(245, 158, 11, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(245, 158, 11, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #f59e0b, #d97706); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-car-side" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Veicolo</span>
                                </div>
                                <div style="font-size: 1rem; font-weight: 800; color: #e2e8f0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                    ${shift.patrolVehicleName}
                                </div>
                            </div>
                            ` : `
                            <div style="
                                background: linear-gradient(135deg, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.08));
                                border: 2px solid rgba(16, 185, 129, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(16, 185, 129, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(16, 185, 129, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #10b981, #059669); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-play" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Inizio</span>
                                </div>
                                <div style="font-size: 1rem; font-weight: 800; color: #e2e8f0; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                    ${shift.activationTime || 'N/A'}
                                </div>
                            </div>
                            `}
                            
                            <div style="
                                background: linear-gradient(135deg, rgba(139, 92, 246, 0.15), rgba(139, 92, 246, 0.08));
                                border: 2px solid rgba(139, 92, 246, 0.3);
                                border-radius: 1.25rem;
                                padding: 1.25rem;
                                position: relative;
                                overflow: hidden;
                                transition: all 0.3s ease;
                            " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(139, 92, 246, 0.5)'" 
                               onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(139, 92, 246, 0.3)'">
                                <div style="position: absolute; top: 0; right: 0; width: 3rem; height: 3rem; background: linear-gradient(135deg, #8b5cf6, #7c3aed); border-radius: 0 1.25rem 0 1.25rem; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-calendar-plus" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <div style="margin-bottom: 0.75rem;">
                                    <span style="font-size: 0.875rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">Data</span>
                                </div>
                                <div style="font-size: 1rem; font-weight: 800; color: #e2e8f0; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                    ${shift.createdDate}
                                </div>
                            </div>
                        </div>
                        <!-- Operatori Ultra-Moderni -->
                        <div style="
                            background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
                            border: 2px solid rgba(255, 255, 255, 0.15);
                            border-radius: 1.25rem;
                            padding: 1.5rem;
                            margin-bottom: 2rem;
                            position: relative;
                            overflow: hidden;
                        ">
                            <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.25rem;">
                                <div style="
                                    width: 2.5rem;
                                    height: 2.5rem;
                                    border-radius: 0.75rem;
                                    background: linear-gradient(135deg, #ef4444, #dc2626);
                                    display: flex;
                                    align-items: center;
                                    justify-content: center;
                                    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.3);
                                ">
                                    <i class="fas fa-users" style="color: white; font-size: 1rem;"></i>
                                </div>
                                <span style="font-size: 1rem; color: #64748b; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em;">
                                    ${isDeactivation ? 'Operatori in Rientro' : 'Operatori in Uscita'}
                                </span>
                            </div>
                            <div style="display: flex; gap: 1rem;">
                                <div style="
                                    flex: 1;
                                    background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(59, 130, 246, 0.1));
                                    border: 2px solid rgba(59, 130, 246, 0.4);
                                    border-radius: 1rem;
                                    padding: 1rem;
                                    text-align: center;
                                    position: relative;
                                    overflow: hidden;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(59, 130, 246, 0.6)'" 
                                   onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(59, 130, 246, 0.4)'">
                                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #3b82f6, #2563eb);"></div>
                                    <div style="font-size: 1rem; font-weight: 800; color: #3b82f6; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                        ${shift.operator1Name}
                                    </div>
                                </div>
                                <div style="
                                    flex: 1;
                                    background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
                                    border: 2px solid rgba(16, 185, 129, 0.4);
                                    border-radius: 1rem;
                                    padding: 1rem;
                                    text-align: center;
                                    position: relative;
                                    overflow: hidden;
                                    transition: all 0.3s ease;
                                " onmouseover="this.style.transform='scale(1.05)'; this.style.borderColor='rgba(16, 185, 129, 0.6)'" 
                                   onmouseout="this.style.transform='scale(1)'; this.style.borderColor='rgba(16, 185, 129, 0.4)'">
                                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #10b981, #059669);"></div>
                                    <div style="font-size: 1rem; font-weight: 800; color: #10b981; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);">
                                        ${shift.operator2Name}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Pulsante Modifica Ultra-Moderno -->
                        <button class="btn btn-primary" style="
                            width: 100%;
                            font-size: 1rem;
                            padding: 1.25rem 2rem;
                            border-radius: 1.25rem;
                            font-weight: 800;
                            letter-spacing: 0.05em;
                            position: relative;
                            overflow: hidden;
                            background: linear-gradient(135deg, #3b82f6, #2563eb);
                            box-shadow: 0 12px 40px rgba(59, 130, 246, 0.4);
                            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
                        " onclick="editShift('${shift.id}')">
                            <i class="fas fa-edit" style="margin-right: 0.75rem;"></i> Modifica Turno
                        </button>
                    </div>
                </div>
            `;
        }

        // Animazioni per il nuovo design
        const style = document.createElement('style');
        style.textContent = `
            @keyframes gradientShift {
                0%, 100% { background-position: 0% 50%; }
                50% { background-position: 100% 50%; }
            }
            
            @keyframes shimmer {
                0% { transform: translateX(-100%); }
                100% { transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);

        function getShiftCardOld(shift) {
            const isDeactivation = shift.moduleType === 'patrol-deactivation';
            const statusColor = shift.status === 'Attivo' ? '#10b981' : (isDeactivation ? '#ef4444' : '#3b82f6');
            const statusBg = shift.status === 'Attivo' ? 'rgba(16, 185, 129, 0.15)' : (isDeactivation ? 'rgba(239, 68, 68, 0.15)' : 'rgba(59, 130, 246, 0.15)');
            const iconColor = isDeactivation ? '#ef4444' : '#10b981';
            const headerBg = isDeactivation ? 'rgba(239, 68, 68, 0.1)' : 'rgba(16, 185, 129, 0.1)';
            
            return `
                <div class="card" style="position: relative; overflow: hidden; background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.9)); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(20px); max-width: 400px;">
                    <!-- Header compatto -->
                    <div style="position: relative; padding: 1rem; background: linear-gradient(135deg, ${headerBg}, rgba(59, 130, 246, 0.05)); border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div style="width: 2rem; height: 2rem; border-radius: 0.5rem; background: linear-gradient(135deg, ${iconColor}, ${isDeactivation ? '#dc2626' : '#059669'}); display: flex; align-items: center; justify-content: center;">
                                    <i class="fas ${isDeactivation ? 'fa-car-crash' : 'fa-car'}" style="color: white; font-size: 0.875rem;"></i>
                                </div>
                                <div>
                                    <h3 style="font-size: 1rem; font-weight: 700; color: #e2e8f0; margin: 0;">${isDeactivation ? 'Disattivazione Pattuglia' : 'Attivazione Pattuglia'}</h3>
                                    <p style="font-size: 0.75rem; color: #94a3b8; margin: 0;">${isDeactivation ? 'Turno Completato' : (shift.patrolTypeName || 'Pattugliamento')}</p>
                                </div>
                            </div>
                            <div style="padding: 0.25rem 0.75rem; background: ${statusBg}; border: 1px solid ${statusColor}; border-radius: 1rem; color: ${statusColor}; font-size: 0.625rem; font-weight: 700; text-transform: uppercase;">
                                ${shift.status}
                            </div>
                        </div>
                    </div>

                    <!-- Contenuto compatto -->
                    <div style="padding: 1rem;">
                        <!-- Informazioni principali in una riga -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-clock" style="color: #3b82f6; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">${isDeactivation ? 'Disattivazione' : 'Attivazione'}</span>
                                </div>
                                <div style="font-size: 0.875rem; font-weight: 700; color: #e2e8f0;">${isDeactivation ? shift.deactivationTime : shift.patrolTime}</div>
                            </div>
                            
                            ${!isDeactivation ? `
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-user-tie" style="color: #10b981; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">Gestito da</span>
                                </div>
                                <div style="font-size: 0.875rem; font-weight: 700; color: #e2e8f0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${shift.managerName}</div>
                            </div>
                            ` : `
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-stopwatch" style="color: #ef4444; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">Durata</span>
                                </div>
                                <div style="font-size: 0.875rem; font-weight: 700; color: #e2e8f0;">${shift.duration || 'N/A'}</div>
                            </div>
                            `}
                        </div>

                        <!-- Informazioni secondarie -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                            ${!isDeactivation ? `
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-car-side" style="color: #f59e0b; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">Veicolo</span>
                                </div>
                                <div style="font-size: 0.75rem; font-weight: 600; color: #e2e8f0; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${shift.patrolVehicleName}</div>
                            </div>
                            ` : `
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-play" style="color: #10b981; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">Inizio</span>
                                </div>
                                <div style="font-size: 0.75rem; font-weight: 600; color: #e2e8f0;">${shift.activationTime || 'N/A'}</div>
                            </div>
                            `}
                            
                            <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08);">
                                <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.25rem;">
                                    <i class="fas fa-calendar-plus" style="color: #8b5cf6; font-size: 0.75rem;"></i>
                                    <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">Data</span>
                                </div>
                                <div style="font-size: 0.75rem; font-weight: 600; color: #e2e8f0;">${shift.createdDate}</div>
                            </div>
                        </div>
                        <!-- Operatori compatti -->
                        <div style="background: rgba(255, 255, 255, 0.03); border-radius: 0.5rem; padding: 0.75rem; border: 1px solid rgba(255, 255, 255, 0.08); margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; gap: 0.375rem; margin-bottom: 0.5rem;">
                                <i class="fas fa-users" style="color: #ef4444; font-size: 0.75rem;"></i>
                                <span style="font-size: 0.625rem; color: #64748b; font-weight: 600; text-transform: uppercase;">${isDeactivation ? 'Operatori in Rientro' : 'Operatori in Uscita'}</span>
                            </div>
                            <div style="display: flex; gap: 0.5rem;">
                                <div style="flex: 1; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05)); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 0.375rem; padding: 0.5rem; text-align: center;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #3b82f6; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${shift.operator1Name}</div>
                                </div>
                                <div style="flex: 1; background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05)); border: 1px solid rgba(16, 185, 129, 0.2); border-radius: 0.375rem; padding: 0.5rem; text-align: center;">
                                    <div style="font-size: 0.75rem; font-weight: 600; color: #10b981; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${shift.operator2Name}</div>
                                </div>
                            </div>
                        </div>

                        <!-- Azione compatta -->
                        <div style="display: flex; justify-content: center; padding-top: 0.75rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                            <button class="btn btn-sm" onclick="editShift(${shift.id})" style="background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; border: none; transition: all 0.3s ease; padding: 0.5rem 1.5rem; border-radius: 0.5rem; font-weight: 600; font-size: 0.875rem;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <i class="fas fa-edit"></i> Modifica
                        </button>
                    </div>
                    </div>
                    <!-- Effetto di bordo animato -->
                    <div style="position: absolute; top: 0; left: 0; right: 0; height: 2px; background: linear-gradient(90deg, transparent, #10b981, transparent); animation: shimmer 3s ease-in-out infinite;"></div>
                </div>
            `;
        }
        function getCreditsPage() {
            return `
                <div class="page-header" style="opacity: 0; animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;">
                    <h1>🔰 Crediti</h1>
                    <p>Informazioni sullo sviluppatore e riconoscimenti</p>
                </div>

                <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
                    <!-- Card Sviluppatore -->
                    <div class="card" style="text-align: center; padding: 3rem 2rem;">
                        <div style="position: relative; display: inline-block; margin-bottom: 2rem;">
                            <img src="https://i.imgur.com/8zbuZPh.png" 
                                 alt="Ryze Profile" 
                                 style="width: 120px; height: 120px; border-radius: 50%; border: 3px solid var(--gradient-primary); box-shadow: 0 0 30px rgba(59, 130, 246, 0.4); object-fit: cover;">
                            <div style="position: absolute; bottom: 5px; right: 5px; width: 30px; height: 30px; background: linear-gradient(135deg, #10b981, #059669); border-radius: 50%; display: flex; align-items: center; justify-content: center; border: 3px solid rgba(30, 41, 59, 0.95);">
                                <i class="fas fa-check" style="color: white; font-size: 0.75rem;"></i>
                            </div>
                        </div>
                        
                        <h2 style="color: #e2e8f0; margin-bottom: 0.5rem; font-size: 1.75rem; font-weight: 800;">Ryze</h2>
                        <p style="color: #94a3b8; margin-bottom: 1.5rem; font-size: 1rem;">Sviluppatore & Designer</p>
                        
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                            <h3 style="color: #3b82f6; margin-bottom: 1rem; font-size: 1.125rem; font-weight: 700;">🎯 Specializzazioni</h3>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">
                                <span style="background: rgba(59, 130, 246, 0.2); color: #3b82f6; padding: 0.5rem 1rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600;">Frontend Development</span>
                                <span style="background: rgba(16, 185, 129, 0.2); color: #10b981; padding: 0.5rem 1rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600;">UI/UX Design</span>
                                <span style="background: rgba(139, 92, 246, 0.2); color: #8b5cf6; padding: 0.5rem 1rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600;">JavaScript</span>
                                <span style="background: rgba(245, 158, 11, 0.2); color: #f59e0b; padding: 0.5rem 1rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600;">CSS Animations</span>
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; justify-content: center;">
                            <button class="btn btn-primary" onclick="UI.notify('Contatto Discord: Ryze#0000', 'info', '📧 Contatto')">
                                <i class="fab fa-discord"></i> Discord
                            </button>
                            <button class="btn btn-secondary" onclick="UI.notify('GitHub: github.com/ryze', 'info', '🐙 GitHub')">
                                <i class="fab fa-github"></i> GitHub
                            </button>
                        </div>
                    </div>

                    <!-- Card Progetto -->
                    <div class="card" style="padding: 2rem;">
                        <h3 style="color: #e2e8f0; margin-bottom: 1.5rem; font-size: 1.5rem; font-weight: 700;">🚀 U.O.P.I. Dashboard</h3>
                        
                        <div style="margin-bottom: 2rem;">
                            <h4 style="color: #3b82f6; margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">📋 Caratteristiche</h4>
                            <ul style="color: #e2e8f0; list-style: none; padding: 0;">
                                <li style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
                                    <span>Sistema di gestione operatori completo</span>
                                </li>
                                <li style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
                                    <span>Gestione turni con moduli specializzati</span>
                                </li>
                                <li style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
                                    <span>Dashboard con statistiche real-time</span>
                                </li>
                                <li style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
                                    <span>Sistema notifiche avanzato</span>
                                </li>
                                <li style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem;">
                                    <i class="fas fa-check-circle" style="color: #10b981; font-size: 1rem;"></i>
                                    <span>Design responsive e moderno</span>
                                </li>
                            </ul>
                        </div>

                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 1rem; padding: 1.5rem;">
                            <h4 style="color: #10b981; margin-bottom: 1rem; font-size: 1.125rem; font-weight: 600;">⚡ Tecnologie Utilizzate</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem;">
                                <div style="color: #e2e8f0; font-size: 0.875rem;">
                                    <strong>Frontend:</strong><br>
                                    HTML5, CSS3, JavaScript ES6+
                                </div>
                                <div style="color: #e2e8f0; font-size: 0.875rem;">
                                    <strong>Design:</strong><br>
                                    CSS Grid, Flexbox, Animations
                                </div>
                                <div style="color: #e2e8f0; font-size: 0.875rem;">
                                    <strong>Icons:</strong><br>
                                    Font Awesome 6.4.0
                                </div>
                                <div style="color: #e2e8f0; font-size: 0.875rem;">
                                    <strong>Fonts:</strong><br>
                                    Inter (Google Fonts)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Card Riconoscimenti -->
                <div class="card" style="margin-bottom: 2rem;">
                    <h3 style="color: #e2e8f0; margin-bottom: 2rem; font-size: 1.5rem; font-weight: 700; text-align: center;">🏆 Riconoscimenti</h3>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; border-radius: 1rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">🎨</div>
                            <h4 style="color: #3b82f6; margin-bottom: 0.5rem; font-weight: 700;">Design System</h4>
                            <p style="color: #e2e8f0; font-size: 0.875rem;">Sistema di design coerente e professionale con palette colori e animazioni fluide</p>
                        </div>
                        
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid #10b981; border-radius: 1rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">⚡</div>
                            <h4 style="color: #10b981; margin-bottom: 0.5rem; font-weight: 700;">Performance</h4>
                            <p style="color: #e2e8f0; font-size: 0.875rem;">Ottimizzazioni per caricamento veloce e esperienza utente fluida</p>
                        </div>
                        
                        <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid #8b5cf6; border-radius: 1rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">🔧</div>
                            <h4 style="color: #8b5cf6; margin-bottom: 0.5rem; font-weight: 700;">Funzionalità</h4>
                            <p style="color: #e2e8f0; font-size: 0.875rem;">Sistema completo di gestione con CRUD operations e validazioni</p>
                        </div>
                        
                        <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid #f59e0b; border-radius: 1rem; padding: 1.5rem; text-align: center;">
                            <div style="font-size: 2.5rem; margin-bottom: 1rem;">📱</div>
                            <h4 style="color: #f59e0b; margin-bottom: 0.5rem; font-weight: 700;">Responsive</h4>
                            <p style="color: #e2e8f0; font-size: 0.875rem;">Design adattivo per tutti i dispositivi e risoluzioni</p>
                        </div>
                    </div>
                </div>
                <!-- Footer -->
                <div class="card" style="text-align: center; padding: 2rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1)); border: 1px solid rgba(59, 130, 246, 0.3);">
                    <div style="font-size: 3rem; margin-bottom: 1rem;">🙏</div>
                    <h3 style="color: #e2e8f0; margin-bottom: 1rem; font-size: 1.5rem; font-weight: 700;">Grazie per aver utilizzato il Database U.O.P.I.</h3>
                    <p style="color: #94a3b8; margin-bottom: 2rem; font-size: 1.125rem;">Developed with ❤️ by <strong style="color: #3b82f6;">Ryze</strong></p>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="UI.notify('Versione 1.0.0 - Build 2024', 'info', 'ℹ️ Informazioni')">
                            <i class="fas fa-info-circle"></i> Versione
                        </button>
                        <button class="btn btn-secondary" onclick="loadPage('overview')">
                            <i class="fas fa-home"></i> Torna alla Dashboard
                        </button>
                    </div>
                </div>
                
                ${getFooterDisclaimer()}
            `;
        }
        function updateOperator(operatorId) {
            // Controllo accesso amministratore
            if (!requireAdminAccess()) {
                return;
            }
            const firstName = document.getElementById('editFirstName')?.value;
            const lastName = document.getElementById('editLastName')?.value;
            const qualification = document.getElementById('editQualification')?.value;
            const discordTag = document.getElementById('editDiscordTag')?.value;
            const role = document.querySelector('input[name="editRole"]:checked')?.value;
            
            // Validazione campi obbligatori
            if (!firstName || !lastName || !qualification || !discordTag || !role) {
                UI.notify('⚠️ Compila tutti i campi obbligatori!', 'error', '❌ Errore Validazione');
                return;
            }
            
            const fullName = `${firstName} ${lastName}`;
            
            // Trova l'operatore da aggiornare
            const operatorIndex = operators.findIndex(op => op.id === operatorId);
            if (operatorIndex === -1) {
                UI.notify('⚠️ Operatore non trovato!', 'error', '❌ Errore');
                return;
            }
            
            // Verifica se esiste già un altro operatore con lo stesso nome o Discord tag
            const existingOperator = operators.find(op => 
                op.id !== operatorId && 
                (op.name.toLowerCase() === fullName.toLowerCase() || op.discordTag === discordTag)
            );
            if (existingOperator) {
                UI.notify('⚠️ Esiste già un operatore con questo nome o tag Discord!', 'error', '❌ Duplicato');
                return;
            }
            
            // Mappa dei ruoli per i nomi completi
            const roleNames = {
                'dirigenziale': '🏅・Nucleo Dirigenziale',
                'amministrativo': '📋・Nucleo Amministrativo',
                'operativo': '👮・Nucleo Operativo'
            };
            
            // Aggiorna l'operatore
            operators[operatorIndex] = {
                ...operators[operatorIndex],
                name: fullName,
                firstName: firstName,
                lastName: lastName,
                qualification: qualification,
                discordTag: discordTag,
                role: role,
                roleName: roleNames[role]
            };
            
            // Salva automaticamente nel localStorage
            saveOperators();
            
            UI.loading('Salvataggio modifiche...', true);
            setTimeout(() => {
                UI.loading('', false);
                UI.notify(`✅ Operatore ${fullName} aggiornato con successo!`, 'success', '✏️ Modifiche Salvate');
                UI.closeModal();
                // Ricarica pagina con animazione
                setTimeout(() => loadPage('personnel'), 500);
                // Aggiorna statistiche panoramica
                setTimeout(() => updateOverviewStats(), 600);
            }, 1500);
        }
        function clearAllOperators() {
            // Controllo accesso amministratore
            if (!requireAdminAccess()) {
                return;
            }
            if (operators.length === 0) {
                UI.notify('⚠️ Nessun operatore da rimuovere!', 'info');
                return;
            }
            
            const confirmContent = `
                <div style="text-align: center; padding: 1rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; color: #ef4444;">⚠️</div>
                    <h3 style="color: #fff; margin-bottom: 1rem;">Rimuovi Tutti gli Operatori</h3>
                    <p style="color: #94a3b8; margin-bottom: 1.5rem;">Sei sicuro di voler rimuovere <strong>tutti i ${operators.length} operatori</strong>?</p>
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid #ef4444; border-radius: 0.75rem; padding: 1rem; margin-bottom: 1.5rem;">
                        <div style="color: #ef4444; font-weight: 600; margin-bottom: 0.5rem;">Operatori che verranno rimossi:</div>
                        <div style="color: #e2e8f0; font-size: 0.875rem; max-height: 200px; overflow-y: auto;">
                            ${operators.map(op => `<div>• ${op.name} (${op.qualification}) - ${op.roleName}</div>`).join('')}
                        </div>
                    </div>
                    <p style="color: #f59e0b; font-size: 0.875rem; font-weight: 600;">⚠️ Questa azione non può essere annullata!</p>
                </div>
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn" onclick="confirmClearAllOperators()" style="background: linear-gradient(135deg, #ef4444, #dc2626); color: white; border: none;">
                    <i class="fas fa-trash-alt"></i> Rimuovi Tutti (${operators.length})
                </button>
            `;
            
            UI.modal('🗑️ Rimuovi Tutti gli Operatori', confirmContent, footer);
        }

        function confirmClearAllOperators() {
            const count = operators.length;
            
            UI.loading('Rimozione operatori...', true);
            
            setTimeout(() => {
                // Svuota array operatori
            operators = [];
            
            // Salva automaticamente nel localStorage
            saveOperators();
            
            UI.loading('', false);
            UI.notify(`✅ Rimossi ${count} operatori!`, 'success');
                UI.closeModal();
                
                // Ricarica pagina con animazione
                setTimeout(() => loadPage('personnel'), 500);
                // Aggiorna statistiche panoramica
                setTimeout(() => updateOverviewStats(), 600);
            }, 1500);
        }

        // ========== MODAL TURNI ==========
        function openAddShift() {
            // Controllo accesso operatore (turni possono essere gestiti da operatori autorizzati)
            if (!requireOperatorAccess()) {
                return;
            }
            const moduleSelection = `
                <div style="text-align: center; margin-bottom: 2rem;">
                    <h3 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem; color: #fff;">Seleziona Tipo di Modulo</h3>
                    <p style="color: #94a3b8; margin-bottom: 2rem;">Scegli il tipo di operazione per il nuovo turno</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 2rem;">
                    <button class="module-btn" onclick="selectModule('patrol-activation')" style="
                        padding: 1.5rem; 
                        background: linear-gradient(135deg, #10b981, #059669); 
                        border: none; 
                        border-radius: 1rem; 
                        color: white; 
                        font-weight: 700; 
                        font-size: 1rem; 
                        cursor: pointer; 
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 8px 20px rgba(16, 185, 129, 0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)'">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">🚓</div>
                        <div>Modulo Attivazione</div>
                        <div style="font-size: 0.875rem; opacity: 0.9;">Pattuglie</div>
                    </button>
                    
                    <button class="module-btn" onclick="selectModule('patrol-deactivation')" style="
                        padding: 1.5rem; 
                        background: linear-gradient(135deg, #ef4444, #dc2626); 
                        border: none; 
                        border-radius: 1rem; 
                        color: white; 
                        font-weight: 700; 
                        font-size: 1rem; 
                        cursor: pointer; 
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">🚓</div>
                        <div>Modulo Disattivazione</div>
                        <div style="font-size: 0.875rem; opacity: 0.9;">Pattuglie</div>
                    </button>
                    
                    <button class="module-btn" onclick="selectModule('heist-activation')" style="
                        padding: 1.5rem; 
                        background: linear-gradient(135deg, #10b981, #059669); 
                        border: none; 
                        border-radius: 1rem; 
                        color: white; 
                        font-weight: 700; 
                        font-size: 1rem; 
                        cursor: pointer; 
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 8px 20px rgba(16, 185, 129, 0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.3)'">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">💰</div>
                        <div>Modulo Attivazione</div>
                        <div style="font-size: 0.875rem; opacity: 0.9;">Grandi Rapine</div>
                    </button>
                    <button class="module-btn" onclick="selectModule('heist-deactivation')" style="
                        padding: 1.5rem; 
                        background: linear-gradient(135deg, #ef4444, #dc2626); 
                        border: none; 
                        border-radius: 1rem; 
                        color: white; 
                        font-weight: 700; 
                        font-size: 1rem; 
                        cursor: pointer; 
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
                        position: relative;
                        overflow: hidden;
                    " onmouseover="this.style.transform='translateY(-3px) scale(1.02)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.4)'" onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 4px 12px rgba(239, 68, 68, 0.3)'">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">💰</div>
                        <div>Modulo Disattivazione</div>
                        <div style="font-size: 0.875rem; opacity: 0.9;">Grandi Rapine</div>
                    </button>
                </div>
                
                <div style="text-align: center; padding-top: 1rem; border-top: 1px solid rgba(255, 255, 255, 0.12);">
                    <button class="btn btn-secondary" onclick="UI.closeModal()" style="margin-right: 1rem;">
                        <i class="fas fa-arrow-left"></i> Indietro
                    </button>
                </div>
            `;
            
            UI.modal('🕐 Seleziona Tipo di Modulo', moduleSelection, '');
        }
        function selectModule(moduleType) {
            const moduleNames = {
                'patrol-activation': '🚓・Modulo Attivazione Pattuglie',
                'patrol-deactivation': '🚓・Modulo Disattivazione Pattuglie',
                'heist-activation': '💰・Modulo Attivazione Grandi Rapine',
                'heist-deactivation': '💰・Modulo Disattivazione Grandi Rapine'
            };

            const moduleName = moduleNames[moduleType];
            const isActivation = moduleType.includes('activation');
            const bannerColor = isActivation ? '#10b981' : '#ef4444';
            const borderColor = isActivation ? '#10b981' : '#ef4444';

            // Se è attivazione pattuglie, mostra il modulo completo
            if (moduleType === 'patrol-activation') {
                return showPatrolActivationModule(moduleName, bannerColor, borderColor);
            }
            
            // Se è disattivazione pattuglie, mostra il modulo completo
            if (moduleType === 'patrol-deactivation') {
                return showPatrolDeactivationModule(moduleName, bannerColor, borderColor);
            }
            
            // Se è attivazione grandi rapine, mostra il modulo completo
            if (moduleType === 'heist-activation') {
                return showHeistActivationModule(moduleName, bannerColor, borderColor);
            }

            // Per gli altri moduli, mantieni il form semplice
            const form = `
                <div style="background: linear-gradient(135deg, ${bannerColor}20, ${bannerColor}10); border: 2px solid ${borderColor}; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: ${borderColor}; margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-${isActivation ? 'play-circle' : 'stop-circle'}"></i>
                        ${moduleName}
                    </h3>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Responsabile Turno</label>
                        <input type="text" id="shResponsible" placeholder="Nome responsabile" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Durata Turno (ore)</label>
                        <input type="number" id="shDuration" placeholder="8" min="1" max="24" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    </div>
                </div>
                
                <div style="margin-top: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Note Aggiuntive</label>
                    <textarea id="shNotes" placeholder="Note per il turno..." rows="4" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease; resize: vertical;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'"></textarea>
                </div>
                
                <input type="hidden" id="shModuleType" value="${moduleType}">
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="saveShift()" style="background: linear-gradient(135deg, ${borderColor}, ${isActivation ? '#059669' : '#dc2626'});">
                    <i class="fas fa-save"></i> Salva ${isActivation ? 'Attivazione' : 'Disattivazione'}
                </button>
            `;
            
            UI.modal(`${moduleName}`, form, footer);
        }
        function showPatrolActivationModule(moduleName, bannerColor, borderColor) {
            // Tutti gli operatori per la selezione (gestito da)
            const allOps = operators;
            
            // Operatori disponibili per la selezione degli operatori in uscita
            const availableOps = operators.filter(op => op.status === 'Disponibile');

            const form = `
                <div style="background: linear-gradient(135deg, ${bannerColor}20, ${bannerColor}10); border: 2px solid ${borderColor}; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: ${borderColor}; margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-play-circle"></i>
                        ${moduleName}
                    </h3>
                </div>
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- Gestito da -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Gestito da:</label>
                        <select id="patrolManager" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona responsabile...</option>
                            ${allOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                        </div>

                    <!-- Orario di Attivazione -->
                        <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Orario di Attivazione Pattuglia:</label>
                        <input type="time" id="patrolTime" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                        </div>

                    <!-- Tipo di Intervento -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Tipo di Intervento:</label>
                        <select id="patrolType" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona tipo intervento...</option>
                            <option value="pattugliamento-rapine">Pattugliamento Cittadino / Intervento Rapine</option>
                        </select>
                    </div>

                    <!-- Veicolo Utilizzato -->
                        <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Veicolo Utilizzato:</label>
                        <select id="patrolVehicle" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona veicolo...</option>
                            <option value="jeep">Jeep Cherokee</option>
                            <option value="alfa">Alfa Romeo Giulietta </option>tili
                            </select>
                        </div>

                    <!-- Operatori in Uscita -->
                        <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Operatori in Uscita (min 2, max 2):</label>
                        <div id="operatorSelection" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <select id="operator1" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" onchange="updateOperator2Options()">
                                <option value="">Seleziona primo operatore...</option>
                                ${availableOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                            <select id="operator2" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                                <option value="">Seleziona secondo operatore...</option>
                                ${availableOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">⚠️ È necessario selezionare esattamente 2 operatori</p>
                    </div>
                </div>
                
                <input type="hidden" id="shModuleType" value="patrol-activation">
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="savePatrolActivation()" style="background: linear-gradient(135deg, ${borderColor}, #059669);">
                    <i class="fas fa-save"></i> Salva Attivazione Pattuglia
                </button>
            `;
            
            UI.modal(`${moduleName}`, form, footer);
        }

        function updateOperator2Options() {
            const operator1Select = document.getElementById('operator1');
            const operator2Select = document.getElementById('operator2');
            const selectedOperator1 = operator1Select.value;
            
            // Reset operator2
            operator2Select.innerHTML = '<option value="">Seleziona secondo operatore...</option>';
            
            if (selectedOperator1) {
                // Filtra operatori escludendo quello già selezionato
                const allOps = operators.filter(op => op.status === 'Disponibile' && op.id != selectedOperator1);
                allOps.forEach(op => {
                    const option = document.createElement('option');
                    option.value = op.id;
                    option.textContent = `${op.name} - ${op.qualification}`;
                    operator2Select.appendChild(option);
                });
            } else {
                // Se nessun operatore selezionato, mostra tutti
                const allOps = operators.filter(op => op.status === 'Disponibile');
                allOps.forEach(op => {
                    const option = document.createElement('option');
                    option.value = op.id;
                    option.textContent = `${op.name} - ${op.qualification}`;
                    operator2Select.appendChild(option);
                });
            }
        }

        // Fallback gestito per avatar immagini
        function avatarFallback(img) {
            try {
                if (!img.dataset.altTried) {
                    img.dataset.altTried = '1';
                    if (img.dataset.alt1) { img.src = img.dataset.alt1; return; }
                }
                img.onerror = null;
                img.src = img.dataset.alt2 || '';
            } catch (e) { img.onerror = null; }
        }

        // Proxy helper per evitare blocchi hotlink/CORS su CDN esterni
        function proxyImage(url) {
            try {
                if (!url) return '';
                const clean = url.replace(/^https?:\/\//, '');
                // images.weserv.nl forza no-referrer e resizing server-side
                return 'https://images.weserv.nl/?url=' + encodeURIComponent(clean) + '&w=84&h=84&fit=cover&we&il';
            } catch { return url; }
        }
        // Inizializzatore filtri Gerarchia (globale, fuori dai template)
        function initPersonnelFilters() {
            try {
                const pills = Array.from(document.querySelectorAll('.filter-pill'));
                const segs = Array.from(document.querySelectorAll('.segment-btn'));
                const panels = Array.from(document.querySelectorAll('.pu-panel-stack .pu-panel'));
                
                function switchPanel(targetRole) {
                    // Trova il pannello target
                    let targetPanel = null;
                    if (targetRole === 'dirigenziale') {
                        targetPanel = document.querySelector('#admin-panel-dir');
                    } else if (targetRole === 'amministrativo') {
                        targetPanel = document.querySelector('#admin-panel-amm');
                    } else if (targetRole === 'operativo') {
                        targetPanel = document.querySelector('#admin-panel-ope');
                    } else {
                        targetPanel = document.querySelector('#admin-panel-dir'); // Default
                    }
                    
                    if (!targetPanel) return;
                    
                    // Trova il pannello attualmente visibile
                    const currentPanel = panels.find(p => !p.classList.contains('hidden'));
                    
                    // Se è lo stesso pannello, non fare nulla
                    if (currentPanel === targetPanel) {
                        return;
                    }
                    
                    // Animazione: rimuovi il pannello corrente con animazione
                    if (currentPanel) {
                        currentPanel.classList.add('leaving');
                        setTimeout(() => {
                            currentPanel.classList.add('hidden');
                            currentPanel.classList.remove('leaving');
                        }, 400);
                    }
                    
                    // Animazione: mostra il nuovo pannello
                    setTimeout(() => {
                        targetPanel.classList.remove('hidden');
                        targetPanel.classList.add('entering');
                        // Assicura che le card siano visibili
                        setTimeout(() => {
                            const cards = targetPanel.querySelectorAll('.operator-card');
                            cards.forEach(c => c.style.display = '');
                            targetPanel.classList.remove('entering');
                        }, 500);
                    }, currentPanel ? 400 : 0);
                }
                
                // Mantieni supporto per segmenti se esistono ancora
                function activateSeg(seg){
                    if (!seg) return;
                    segs.forEach(s=>s.classList.remove('active'));
                    seg.classList.add('active');
                    const target = seg.getAttribute('data-target');
                    const role = target === '#admin-panel-dir' ? 'dirigenziale' : 
                                target === '#admin-panel-amm' ? 'amministrativo' : 
                                target === '#admin-panel-ope' ? 'operativo' : 'dirigenziale';
                    switchPanel(role);
                }
                segs.forEach(s=>s.addEventListener('click', ()=>activateSeg(s)));
                
                pills.forEach(p => p.addEventListener('click', () => {
                    pills.forEach(x => x.classList.remove('active'));
                    p.classList.add('active');
                    const role = p.dataset.role || 'dirigenziale';
                    switchPanel(role);
                }));
                
                // Inizializza il pannello corretto in base al filtro attivo
                if (segs.length) {
                    const defaultSeg = segs.find(s=> s.classList.contains('active')) || segs[0];
                    activateSeg(defaultSeg);
                } else {
                    const activePill = pills.find(p => p.classList.contains('active')) || pills[0];
                    if (activePill) {
                        const role = activePill.dataset.role || 'dirigenziale';
                        switchPanel(role);
                    }
                }
            } catch (e) { console.warn('initPersonnelFilters failed', e); }
        }
        function showPatrolDeactivationModule(moduleName, bannerColor, borderColor) {
            // Trova gli operatori che sono attualmente in servizio (da attivazioni precedenti)
            const activeShifts = shifts.filter(shift => 
                shift.status === 'Attivo' && 
                (shift.moduleType === 'patrol-activation' || shift.type === 'patrol-activation')
            );
            const activeOperators = [];
            
            activeShifts.forEach(shift => {
                if (shift.operator1Id) {
                    const op1 = operators.find(op => op.id == shift.operator1Id);
                    if (op1) activeOperators.push(op1);
                }
                if (shift.operator2Id) {
                    const op2 = operators.find(op => op.id == shift.operator2Id);
                    if (op2) activeOperators.push(op2);
                }
            });

            // Rimuovi duplicati
            const uniqueActiveOperators = activeOperators.filter((op, index, self) => 
                index === self.findIndex(t => t.id === op.id)
            );

            // Se non ci sono operatori attivi, mostra tutti gli operatori disponibili
            let operatorsToShow = uniqueActiveOperators.length > 0 ? uniqueActiveOperators : operators.filter(op => op.status === 'Disponibile');
            
            // Ordina gli operatori in ordine discendente per grado (dal più alto al più basso)
            const roleOrder = {
                'Comandante Generale': 1,
                'Comandante': 2,
                'Vice Comandante': 3,
                'Sostituto Vice Comandante': 4,
                'Capitano': 5,
                'Caposquadra': 6,
                'Vice Caposquadra': 7,
                'Coordinatore': 8,
                'Tecnico Esperto': 9,
                'Tecnico Specializzato': 10
            };
            
            operatorsToShow.sort((a, b) => {
                const orderA = roleOrder[a.qualification] || 999;
                const orderB = roleOrder[b.qualification] || 999;
                return orderA - orderB; // Ordine crescente per mostrare i gradi più alti prima
            });

            const form = `
                <div style="background: linear-gradient(135deg, ${bannerColor}20, ${bannerColor}10); border: 2px solid ${borderColor}; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: ${borderColor}; margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-car"></i>
                        ${moduleName}
                    </h3>
                </div>
                
                <div style="display: flex; flex-direction: column; gap: 1.5rem;">
                    <!-- Operatori in Rientro -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Operatori in Rientro (min 2, max 2):</label>
                        <div id="deactivationOperatorSelection" style="display: flex; flex-direction: column; gap: 0.75rem;">
                            <select id="deactivationOperator1" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'" onchange="updateDeactivationOperator2Options()">
                                <option value="">Seleziona primo operatore...</option>
                                ${operatorsToShow.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                            <select id="deactivationOperator2" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                                <option value="">Seleziona secondo operatore...</option>
                                ${operatorsToShow.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                        </div>
                        <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">⚠️ Seleziona gli operatori che stanno rientrando dall'attivazione precedente</p>
                    </div>

                    <!-- Orario di Disattivazione -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Orario di Disattivazione Pattuglia:</label>
                        <input type="time" id="deactivationTime" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    </div>

                    <!-- Calcolo Durata -->
                    <div id="durationCalculation" style="background: rgba(255, 255, 255, 0.03); border-radius: 0.75rem; padding: 1rem; border: 1px solid rgba(255, 255, 255, 0.08); display: none;">
                        <h4 style="color: var(--text-primary); margin: 0 0 0.75rem 0; font-size: 1rem; font-weight: 600;">📊 Calcolo Durata Attivazione</h4>
                        <div id="durationDetails" style="color: var(--text-muted); font-size: 0.875rem;"></div>
                    </div>
                </div>
                
                <input type="hidden" id="shModuleType" value="patrol-deactivation">
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="savePatrolDeactivation()" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
                    <i class="fas fa-save"></i> Salva Disattivazione Pattuglia
                </button>
            `;
            
            UI.modal(`${moduleName}`, form, footer);
        }
        function updateDeactivationOperator2Options() {
            const operator1Select = document.getElementById('deactivationOperator1');
            const operator2Select = document.getElementById('deactivationOperator2');
            const selectedOperator1 = operator1Select.value;
            
            // Reset operator2
            operator2Select.innerHTML = '<option value="">Seleziona secondo operatore...</option>';
            
            // Trova gli operatori attivi (stessa logica della funzione principale)
            const activeShifts = shifts.filter(shift => 
                shift.status === 'Attivo' && 
                (shift.moduleType === 'patrol-activation' || shift.type === 'patrol-activation')
            );
            const activeOperators = [];
            
            activeShifts.forEach(shift => {
                if (shift.operator1Id) {
                    const op1 = operators.find(op => op.id == shift.operator1Id);
                    if (op1) activeOperators.push(op1);
                }
                if (shift.operator2Id) {
                    const op2 = operators.find(op => op.id == shift.operator2Id);
                    if (op2) activeOperators.push(op2);
                }
            });

            // Rimuovi duplicati
            const uniqueActiveOperators = activeOperators.filter((op, index, self) => 
                index === self.findIndex(t => t.id === op.id)
            );

            // Se non ci sono operatori attivi, usa tutti gli operatori disponibili
            let operatorsToShow = uniqueActiveOperators.length > 0 ? uniqueActiveOperators : operators.filter(op => op.status === 'Disponibile');
            
            // Ordina gli operatori in ordine discendente per grado (stessa logica della funzione principale)
            const roleOrder = {
                'Comandante Generale': 1,
                'Comandante': 2,
                'Vice Comandante': 3,
                'Sostituto Vice Comandante': 4,
                'Capitano': 5,
                'Caposquadra': 6,
                'Vice Caposquadra': 7,
                'Coordinatore': 8,
                'Tecnico Esperto': 9,
                'Tecnico Specializzato': 10
            };
            
            operatorsToShow.sort((a, b) => {
                const orderA = roleOrder[a.qualification] || 999;
                const orderB = roleOrder[b.qualification] || 999;
                return orderA - orderB; // Ordine crescente per mostrare i gradi più alti prima
            });
            
            // Filtra escludendo l'operatore già selezionato
            const filteredOperators = operatorsToShow.filter(op => op.id != selectedOperator1);
            
            filteredOperators.forEach(op => {
                const option = document.createElement('option');
                option.value = op.id;
                option.textContent = `${op.name} - ${op.qualification}`;
                operator2Select.appendChild(option);
            });
        }
        function showHeistActivationModule(moduleName, bannerColor, borderColor) {
            // Ottieni tutti gli operatori disponibili dalla gerarchia
            const availableOps = operators.filter(op => op.status === 'Disponibile');
            
            // Ordina gli operatori per grado (dal più alto al più basso)
            const roleOrder = {
                'Comandante Generale': 1,
                'Comandante': 2,
                'Vice Comandante': 3,
                'Sostituto Vice Comandante': 4,
                'Capitano': 5,
                'Caposquadra': 6,
                'Vice Caposquadra': 7,
                'Coordinatore': 8,
                'Tecnico Esperto': 9,
                'Tecnico Specializzato': 10
            };
            
            availableOps.sort((a, b) => {
                const orderA = roleOrder[a.qualification] || 999;
                const orderB = roleOrder[b.qualification] || 999;
                return orderA - orderB;
            });

            const form = `
                <div style="background: linear-gradient(135deg, ${bannerColor}20, ${bannerColor}10); border: 2px solid ${borderColor}; border-radius: 1rem; padding: 1.5rem; margin-bottom: 2rem;">
                    <h3 style="color: ${borderColor}; margin: 0; font-size: 1.25rem; font-weight: 700; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-gem"></i>
                        ${moduleName}
                    </h3>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                    <!-- Coordinatore -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Coordinatore:</label>
                        <select id="heistCoordinator" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona coordinatore...</option>
                            ${availableOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                        </select>
                    </div>

                    <!-- Contrattatore -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Contrattatore:</label>
                        <select id="heistContractor" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona contrattatore...</option>
                            ${availableOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                        </select>
                    </div>

                    <!-- Tipo di Intervento -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Tipo di Intervento:</label>
                        <select id="heistType" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                            <option value="">Seleziona tipo di intervento...</option>
                            <option value="gioielleria">Gioielleria</option>
                            <option value="banca-credito-capitolina">Banca di Credito Capitolina</option>
                            <option value="zecca-stato">Zecca di Stato</option>
                        </select>
                    </div>

                    <!-- Orario di Attivazione -->
                    <div>
                        <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Orario di Attivazione:</label>
                        <input type="time" id="heistTime" style="width: 100%; padding: 0.875rem; border: 1px solid var(--border); border-radius: 0.75rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 1rem; transition: all 0.3s ease;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                    </div>
                </div>

                <!-- Operatori Coinvolti -->
                <div style="margin-top: 1.5rem;">
                    <label style="display: block; margin-bottom: 0.5rem; font-weight: 600; color: var(--text-primary);">Operatori Coinvolti (max 14):</label>
                    
                    <!-- Blocco Selezione Operatori -->
                    <div style="background: rgba(255, 255, 255, 0.05); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem;">
                        <!-- Area Operatori Selezionati -->
                        <div id="selectedOperatorsContainer" style="min-height: 60px; border: 2px dashed rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.75rem; margin-bottom: 1rem; background: rgba(59, 130, 246, 0.05);">
                            <div id="selectedOperatorsList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                <div style="color: var(--text-muted); font-size: 0.875rem; font-style: italic; width: 100%; text-align: center; padding: 1rem 0;">
                                    Nessun operatore selezionato
                                </div>
                            </div>
                        </div>
                        
                        <!-- Controlli Selezione -->
                        <div style="display: flex; gap: 0.75rem; align-items: stretch; flex-wrap: wrap;">
                            <select id="operatorSelector" style="flex: 1; min-width: 200px; padding: 0.75rem; border: 1px solid var(--border); border-radius: 0.5rem; background: var(--bg-secondary); color: var(--text-primary); font-size: 0.875rem;" onfocus="this.style.borderColor='#3b82f6'; this.style.boxShadow='0 0 0 3px rgba(59, 130, 246, 0.1)'" onblur="this.style.borderColor='var(--border)'; this.style.boxShadow='none'">
                                <option value="">Seleziona operatore da aggiungere...</option>
                                ${availableOps.map(op => `<option value="${op.id}">${op.name} - ${op.qualification}</option>`).join('')}
                            </select>
                            
                            <button type="button" onclick="addSelectedOperator()" style="flex-shrink: 0; padding: 0.75rem 1rem; background: linear-gradient(135deg, #3b82f6, #1d4ed8); border: none; border-radius: 0.5rem; color: white; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.3s ease; white-space: nowrap;" onmouseover="this.style.transform='translateY(-1px)'; this.style.boxShadow='0 4px 12px rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                                <i class="fas fa-plus"></i> Aggiungi
                            </button>
                        </div>
                        
                        <!-- Contatore e Info -->
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem; font-size: 0.875rem;">
                            <span style="color: var(--text-muted);">
                                <span id="operatorCount">0</span> / 14 operatori selezionati
                            </span>
                            <button type="button" onclick="clearAllOperators()" style="padding: 0.5rem 0.75rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.375rem; color: #ef4444; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">
                                <i class="fas fa-trash"></i> Rimuovi Tutti
                            </button>
                        </div>
                    </div>
                    
                    <p style="color: var(--text-muted); font-size: 0.875rem; margin-top: 0.5rem;">💡 Clicca "Aggiungi" per selezionare operatori. Usa la X per rimuovere singoli operatori.</p>
                </div>
                
                <input type="hidden" id="heistModuleType" value="heist-activation">
            `;
            
            const footer = `
                <button class="btn btn-secondary" onclick="UI.closeModal()">Annulla</button>
                <button class="btn btn-primary" onclick="saveHeistActivation()" style="background: linear-gradient(135deg, ${borderColor}, #059669);">
                    <i class="fas fa-save"></i> Salva Attivazione Grandi Rapine
                </button>
            `;
            
            UI.modal(`${moduleName}`, form, footer);
            
            // Inizializza le variabili per la gestione degli operatori
            window.selectedOperators = [];
            window.updateOperatorCount();
        }
        // Funzioni per gestire la selezione degli operatori
        function addSelectedOperator() {
            const selector = document.getElementById('operatorSelector');
            const operatorId = selector.value;
            
            if (!operatorId) {
                UI.notify('⚠️ Seleziona un operatore prima di aggiungerlo!', 'warning', '⚠️ Attenzione');
                return;
            }
            
            // Controlla se è già stato selezionato
            if (window.selectedOperators.some(op => op.id == operatorId)) {
                UI.notify('⚠️ Questo operatore è già stato selezionato!', 'warning', '⚠️ Attenzione');
                return;
            }
            
            // Controlla il limite di 14 operatori
            if (window.selectedOperators.length >= 14) {
                UI.notify('⚠️ Hai raggiunto il limite massimo di 14 operatori!', 'warning', '⚠️ Limite Raggiunto');
                return;
            }
            
            // Trova l'operatore
            const operator = operators.find(op => op.id == operatorId);
            if (!operator) {
                UI.notify('⚠️ Operatore non trovato!', 'error', '❌ Errore');
                return;
            }
            
            // Aggiungi l'operatore alla lista
            window.selectedOperators.push({
                id: operator.id,
                name: operator.name,
                qualification: operator.qualification
            });
            
            // Aggiorna l'interfaccia
            updateSelectedOperatorsDisplay();
            updateOperatorCount();
            
            // Reset del selector
            selector.value = '';
            
            // Rimuovi l'operatore dalle opzioni disponibili
            updateOperatorSelector();
        }
        
        function removeSelectedOperator(operatorId) {
            window.selectedOperators = window.selectedOperators.filter(op => op.id != operatorId);
            updateSelectedOperatorsDisplay();
            updateOperatorCount();
            updateOperatorSelector();
        }
        function clearAllOperators() {
            if (window.selectedOperators.length === 0) {
                UI.notify('ℹ️ Nessun operatore da rimuovere!', 'info', 'ℹ️ Info');
                return;
            }
            
            window.selectedOperators = [];
            updateSelectedOperatorsDisplay();
            updateOperatorCount();
            updateOperatorSelector();
        }
        function updateSelectedOperatorsDisplay() {
            const container = document.getElementById('selectedOperatorsList');
            
            if (window.selectedOperators.length === 0) {
                container.innerHTML = `
                    <div style="color: var(--text-muted); font-size: 0.875rem; font-style: italic; width: 100%; text-align: center; padding: 1rem 0;">
                        Nessun operatore selezionato
                    </div>
                `;
                return;
            }
            
            container.innerHTML = window.selectedOperators.map(op => `
                <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 0.5rem; padding: 0.5rem 0.75rem; font-size: 0.875rem;">
                    <span style="color: var(--text-primary); font-weight: 500;">${op.name}</span>
                    <span style="color: var(--text-muted); font-size: 0.75rem;">${op.qualification}</span>
                    <button type="button" onclick="removeSelectedOperator('${op.id}')" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 0.25rem; color: #ef4444; padding: 0.25rem 0.5rem; font-size: 0.75rem; cursor: pointer; transition: all 0.3s ease;" onmouseover="this.style.background='rgba(239, 68, 68, 0.2)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.1)'">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function updateOperatorCount() {
            const countElement = document.getElementById('operatorCount');
            if (countElement) {
                countElement.textContent = window.selectedOperators.length;
            }
        }
        
        function updateOperatorSelector() {
            const selector = document.getElementById('operatorSelector');
            if (!selector) return;
            
            // Ottieni gli ID degli operatori già selezionati
            const selectedIds = window.selectedOperators.map(op => op.id);
            
            // Filtra le opzioni per escludere quelli già selezionati
            const options = Array.from(selector.options);
            options.forEach(option => {
                if (option.value && selectedIds.includes(option.value)) {
                    option.style.display = 'none';
                } else {
                    option.style.display = 'block';
                }
            });
        }
        function savePatrolActivation() {
            const managerId = document.getElementById('patrolManager')?.value;
            const patrolTime = document.getElementById('patrolTime')?.value;
            const patrolType = document.getElementById('patrolType')?.value;
            const patrolVehicle = document.getElementById('patrolVehicle')?.value;
            const operator1Id = document.getElementById('operator1')?.value;
            const operator2Id = document.getElementById('operator2')?.value;

            // Validazione campi obbligatori
            if (!managerId || !patrolTime || !patrolType || !patrolVehicle || !operator1Id || !operator2Id) {
                UI.notify('⚠️ Compila tutti i campi obbligatori!', 'error', '❌ Errore Validazione');
                return;
            }

            // Validazione operatori diversi
            if (operator1Id === operator2Id) {
                UI.notify('⚠️ Gli operatori devono essere diversi!', 'error', '❌ Errore Validazione');
                return;
            }

            // Trova i dati degli operatori
            const manager = operators.find(op => op.id == managerId);
            const operator1 = operators.find(op => op.id == operator1Id);
            const operator2 = operators.find(op => op.id == operator2Id);

            if (!manager || !operator1 || !operator2) {
                UI.notify('⚠️ Errore nel recupero dati operatori!', 'error', '❌ Errore');
                return;
            }

            // Mappa dei tipi di intervento
            const patrolTypes = {
                'pattugliamento-rapine': 'Pattugliamento Cittadino/Intervento Rapine'
            };

            // Mappa dei veicoli
            const vehicles = {
                'jeep': 'Jeep Cherokee',
                'alfa': 'Alfa Romeo Giulietta'
            };

            // Crea il nuovo turno
            const newShift = {
                id: Date.now(),
                moduleType: 'patrol-activation',
                status: 'Attivo',
                managerId: managerId,
                managerName: manager.name,
                managerQualification: manager.qualification,
                patrolTime: patrolTime,
                patrolType: patrolType,
                patrolTypeName: patrolTypes[patrolType],
                patrolVehicle: patrolVehicle,
                patrolVehicleName: vehicles[patrolVehicle],
                operator1Id: operator1Id,
                operator1Name: operator1.name,
                operator1Qualification: operator1.qualification,
                operator2Id: operator2Id,
                createdBy: localStorage.getItem('authenticatedUserId') || 'unknown',
                createdByName: localStorage.getItem('authenticatedUserName') || 'Sconosciuto',
                operator2Name: operator2.name,
                operator2Qualification: operator2.qualification,
                createdAt: new Date().toISOString(),
                createdDate: new Date().toLocaleDateString('it-IT')
            };

            // Aggiungi il turno all'array
            shifts.push(newShift);
            
            // Salva nel localStorage
            saveShifts();

            UI.loading('Salvataggio attivazione pattuglia...', true);
            
            setTimeout(() => {
                UI.loading('', false);
                UI.notify(`✅ Attivazione pattuglia salvata con successo!\\n\\nGestito da: ${manager.name}\\nOrario: ${patrolTime}\\nTipo: ${patrolTypes[patrolType]}\\nVeicolo: ${vehicles[patrolVehicle]}\\nOperatori: ${operator1.name}, ${operator2.name}`, 'success', '🚓 Attivazione Completata');
                UI.closeModal();
                
                // Ricarica pagina turni
                setTimeout(() => loadPage('shifts'), 500);
            }, 1500);
        }
        function savePatrolDeactivation() {
            const operator1Id = document.getElementById('deactivationOperator1')?.value;
            const operator2Id = document.getElementById('deactivationOperator2')?.value;
            const deactivationTime = document.getElementById('deactivationTime')?.value;

            // Validazione campi obbligatori
            if (!operator1Id || !operator2Id || !deactivationTime) {
                UI.notify('⚠️ Compila tutti i campi obbligatori!', 'error', '❌ Errore Validazione');
                return;
            }

            // Validazione operatori diversi
            if (operator1Id === operator2Id) {
                UI.notify('⚠️ Gli operatori devono essere diversi!', 'error', '❌ Errore Validazione');
                return;
            }

            // Trova i dati degli operatori
            const operator1 = operators.find(op => op.id == operator1Id);
            const operator2 = operators.find(op => op.id == operator2Id);

            if (!operator1 || !operator2) {
                UI.notify('⚠️ Errore nel recupero dati operatori!', 'error', '❌ Errore');
                return;
            }

            // Trova l'attivazione precedente per questi operatori
            const activeShift = shifts.find(shift => 
                shift.status === 'Attivo' && 
                (shift.moduleType === 'patrol-activation' || shift.type === 'patrol-activation') &&
                ((shift.operator1Id == operator1Id && shift.operator2Id == operator2Id) ||
                 (shift.operator1Id == operator2Id && shift.operator2Id == operator1Id))
            );
            // Se non c'è un'attivazione precedente, crea una disattivazione standalone
            if (!activeShift) {
                UI.notify('⚠️ Nessuna attivazione precedente trovata per questi operatori. Creazione disattivazione standalone...', 'warning', '⚠️ Avviso');
                
                // Crea una disattivazione standalone senza calcolo durata
                const newShift = {
                    id: Date.now(),
                    moduleType: 'patrol-deactivation',
                    status: 'Completato',
                    operator1Id: operator1Id,
                    operator1Name: operator1.name,
                    operator1Qualification: operator1.qualification,
                    operator2Id: operator2Id,
                    operator2Name: operator2.name,
                    operator2Qualification: operator2.qualification,
                    deactivationTime: deactivationTime,
                    duration: 'N/A',
                    createdDate: new Date().toLocaleDateString('it-IT'),
                    createdAt: new Date().toISOString()
                };

                shifts.push(newShift);
                saveShifts();

                UI.loading('Salvataggio disattivazione...', true);
                
                setTimeout(() => {
                    UI.loading('', false);
                    UI.notify(`✅ Disattivazione pattuglia salvata con successo!\\n\\nOperatori: ${operator1.name}, ${operator2.name}\\nOrario Disattivazione: ${deactivationTime}\\n\\nNota: Nessuna attivazione precedente trovata.`, 'success', '🚓 Disattivazione Completata');
                    UI.closeModal();
                    
                    setTimeout(() => loadPage('shifts'), 500);
                }, 1500);
                
                return;
            }

            // Calcola la durata dell'attivazione
            const activationTime = activeShift.patrolTime;
            
            // Converte la data italiana (dd/mm/yyyy) in formato ISO
            const dateParts = activeShift.createdDate.split('/');
            const isoDate = `${dateParts[2]}-${dateParts[1].padStart(2, '0')}-${dateParts[0].padStart(2, '0')}`;
            
            const activationDateTime = new Date(`${isoDate}T${activationTime}:00`);
            const deactivationDateTime = new Date(`${isoDate}T${deactivationTime}:00`);
            
            // Se l'orario di disattivazione è precedente all'attivazione, assumiamo che sia il giorno dopo
            if (deactivationDateTime < activationDateTime) {
                deactivationDateTime.setDate(deactivationDateTime.getDate() + 1);
            }
            
            const durationMs = deactivationDateTime - activationDateTime;
            
            // Controlla se il calcolo è valido
            let durationText, durationHours, durationMinutes;
            if (isNaN(durationMs) || durationMs < 0) {
                durationText = 'N/A';
                durationHours = 0;
                durationMinutes = 0;
            } else {
                durationHours = Math.floor(durationMs / (1000 * 60 * 60));
                durationMinutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
                durationText = `${durationHours}h ${durationMinutes}m`;
            }

            // Crea il nuovo turno di disattivazione
            const newShift = {
                id: Date.now(),
                moduleType: 'patrol-deactivation',
                status: 'Completato',
                operator1Id: operator1Id,
                operator1Name: operator1.name,
                operator1Qualification: operator1.qualification,
                operator2Id: operator2Id,
                operator2Name: operator2.name,
                operator2Qualification: operator2.qualification,
                deactivationTime: deactivationTime,
                activationTime: activationTime,
                duration: durationText,
                durationHours: durationHours,
                durationMinutes: durationMinutes,
                relatedActivationId: activeShift.id,
                createdDate: activeShift.createdDate,
                createdAt: new Date().toISOString()
            };

            // Aggiorna lo stato dell'attivazione precedente
            activeShift.status = 'Completato';
            activeShift.deactivationTime = deactivationTime;
            activeShift.duration = durationText;
            activeShift.durationHours = durationHours;
            activeShift.durationMinutes = durationMinutes;
            activeShift.completedAt = new Date().toISOString();

            // Aggiungi il nuovo turno
            shifts.push(newShift);

            // Salva nel localStorage
            saveShifts();

            UI.loading('Salvataggio disattivazione...', true);
            
            setTimeout(() => {
                UI.loading('', false);
                UI.notify(`✅ Disattivazione pattuglia salvata con successo!\\n\\nOperatori: ${operator1.name}, ${operator2.name}\\nOrario Disattivazione: ${deactivationTime}\\nDurata Totale: ${durationText}\\n\\nL'attivazione precedente è stata completata automaticamente.`, 'success', '🚓 Disattivazione Completata');
                UI.closeModal();
                
                // Ricarica pagina turni
                setTimeout(() => loadPage('shifts'), 500);
            }, 1500);
        }
        function saveHeistActivation() {
            const coordinatorId = document.getElementById('heistCoordinator')?.value;
            const contractorId = document.getElementById('heistContractor')?.value;
            const heistType = document.getElementById('heistType')?.value;
            const heistTime = document.getElementById('heistTime')?.value;

            // Validazione campi obbligatori
            if (!coordinatorId || !contractorId || !heistType || !heistTime) {
                UI.notify('⚠️ Compila tutti i campi obbligatori!', 'error', '❌ Errore Validazione');
                return;
            }

            // Validazione che coordinatore e contrattatore siano diversi
            if (coordinatorId === contractorId) {
                UI.notify('⚠️ Il coordinatore e il contrattatore devono essere persone diverse!', 'error', '❌ Errore Validazione');
                return;
            }

            // Ottieni i dati degli operatori
            const coordinator = operators.find(op => op.id == coordinatorId);
            const contractor = operators.find(op => op.id == contractorId);

            if (!coordinator || !contractor) {
                UI.notify('⚠️ Operatori non trovati!', 'error', '❌ Errore');
                return;
            }

            // Ottieni gli operatori selezionati dal nuovo sistema
            const involvedOperators = window.selectedOperators || [];

            // Validazione che coordinatore e contrattatore non siano già selezionati negli operatori coinvolti
            const isCoordinatorInvolved = involvedOperators.some(op => op.id == coordinatorId);
            const isContractorInvolved = involvedOperators.some(op => op.id == contractorId);

            if (isCoordinatorInvolved) {
                UI.notify('⚠️ Il coordinatore non può essere selezionato anche negli operatori coinvolti!', 'error', '❌ Errore Validazione');
                return;
            }

            if (isContractorInvolved) {
                UI.notify('⚠️ Il contrattatore non può essere selezionato anche negli operatori coinvolti!', 'error', '❌ Errore Validazione');
                return;
            }

            // Mappa dei tipi di intervento
            const heistTypes = {
                'gioielleria': 'Gioielleria',
                'banca-credito-capitolina': 'Banca di Credito Capitolina',
                'zecca-stato': 'Zecca di Stato'
            };

            // Crea il nuovo turno
            const newShift = {
                id: Date.now(),
                moduleType: 'heist-activation',
                status: 'Attivo',
                coordinatorId: coordinatorId,
                coordinatorName: coordinator.name,
                coordinatorQualification: coordinator.qualification,
                contractorId: contractorId,
                contractorName: contractor.name,
                contractorQualification: contractor.qualification,
                heistType: heistType,
                heistTypeName: heistTypes[heistType],
                heistTime: heistTime,
                involvedOperators: involvedOperators,
                totalOperators: involvedOperators.length + 2, // +2 per coordinatore e contrattatore
                createdAt: new Date().toISOString(),
                createdDate: new Date().toLocaleDateString('it-IT')
            };

            // Aggiungi il turno all'array
            shifts.push(newShift);
            
            // Salva nel localStorage
            saveShifts();
            UI.loading('Salvataggio attivazione grandi rapine...', true);
            
            setTimeout(() => {
                UI.loading('', false);
                
                let operatorsText = `Coordinatore: ${coordinator.name}\\nContrattatore: ${contractor.name}`;
                if (involvedOperators.length > 0) {
                    operatorsText += `\\nOperatori Coinvolti: ${involvedOperators.map(op => op.name).join(', ')}`;
                }
                
                UI.notify(`✅ Attivazione grandi rapine salvata con successo!\\n\\nTipo: ${heistTypes[heistType]}\\nOrario: ${heistTime}\\n\\n${operatorsText}\\n\\nTotale Operatori: ${newShift.totalOperators}`, 'success', '💰 Attivazione Completata');
                UI.closeModal();
                
                // Ricarica pagina turni
                setTimeout(() => loadPage('shifts'), 500);
            }, 1500);
        }
        // Funzione di logout
        function logout() {
            console.log('🚪 Logout in corso...');
            
            // Rimuovi i dati di autenticazione
            localStorage.removeItem('authenticatedUserId');
            localStorage.removeItem('userData');
            localStorage.removeItem('userAccessLevel');
            
            // Mostra di nuovo la sidebar del login
            const loginSidebar = document.getElementById('loginSidebar');
            const mainContent = document.querySelector('.main-content');
            
            if (loginSidebar) {
                loginSidebar.classList.remove('hidden');
            }
            
            if (mainContent) {
                mainContent.classList.add('hidden');
                mainContent.classList.remove('full-width');
            }
            
            // Reset del profilo utente
            const avatarElement = document.querySelector('.avatar');
            const userNameElement = document.querySelector('.user-profile div div:nth-child(1)');
            const userTagElement = document.querySelector('.user-profile div div:nth-child(2)');
            const userRoleElement = document.querySelector('.user-profile div div:nth-child(3)');
            
            if (avatarElement) {
                avatarElement.textContent = 'd';
            }
            
            if (userNameElement) {
                userNameElement.textContent = 'dxrk.ryze';
            }
            
            if (userTagElement) {
                userTagElement.textContent = '#0001';
            }
            
            if (userRoleElement) {
                userRoleElement.textContent = 'Dirigenza';
            }
            
            // Pulisci il contenuto
            const content = document.getElementById('content');
            if (content) {
                content.innerHTML = '';
            }
            
            console.log('✅ Logout completato!');
        }

        // ========== INIT ==========
            const ENABLE_AUTO_LOGIN = true; // Abilita login automatico per utenti autorizzati
        window.addEventListener('load', () => {
            console.log('🚀 Pagina caricata, inizializzazione sistema sicurezza...');
            
            // Controllo immediato accesso Shadow (prima di tutto)
            setTimeout(() => {
                console.log('🥷 Controllo immediato accesso Shadow...');
                updateNavbarForShadowAccess();
            }, 500);
            // Verifica se c'è un utente già autenticato
            const savedUserId = localStorage.getItem('authenticatedUserId');
            const savedUserData = localStorage.getItem('userData');
            const savedAccessLevel = localStorage.getItem('userAccessLevel');
            
                console.log('🔍 Debug localStorage:', {
                    savedUserId,
                    savedUserData: savedUserData ? 'Presente' : 'Assente',
                    savedAccessLevel
                });
                
                if (ENABLE_AUTO_LOGIN && savedUserId && savedUserData && savedAccessLevel) {
                console.log('🔐 Utente già autenticato:', savedUserId, 'Livello:', savedAccessLevel);
                
                // Verifica che l'ID sia ancora autorizzato
                if (DISCORD_AUTH.isAuthorized(savedUserId)) {
                        console.log('✅ Utente ancora autorizzato, procedo con auto-login');
                    userAccessLevel = savedAccessLevel;
                    const userData = JSON.parse(savedUserData);
                    
                    // Nascondi la sidebar del login
                    const loginSidebar = document.getElementById('loginSidebar');
                    const mainContent = document.querySelector('.main-content');
                        
                        console.log('🔍 Debug elementi DOM:', {
                            loginSidebar: loginSidebar ? 'Trovato' : 'Non trovato',
                            mainContent: mainContent ? 'Trovato' : 'Non trovato'
                        });
                    
                    if (loginSidebar) {
                        loginSidebar.classList.add('hidden');
                            console.log('✅ LoginSidebar nascosto');
                    }
                    
                    if (mainContent) {
                        mainContent.classList.remove('hidden');
                        mainContent.classList.add('full-width');
                            console.log('✅ MainContent mostrato');
                    }
                    
                    // Aggiorna il profilo utente
                    console.log('🔄 Auto-login: Aggiorno profilo utente con:', userData);
                    
                    const avatarElement = document.querySelector('.avatar');
                    const userNameElement = document.querySelector('.user-profile div div:nth-child(1)');
                    const userTagElement = document.querySelector('.user-profile div div:nth-child(2)');
                    const userRoleElement = document.querySelector('.user-profile div div:nth-child(3)');
                        
                        console.log('🔍 Debug elementi profilo:', {
                            avatar: avatarElement ? 'Trovato' : 'Non trovato',
                            userName: userNameElement ? 'Trovato' : 'Non trovato',
                            userTag: userTagElement ? 'Trovato' : 'Non trovato',
                            userRole: userRoleElement ? 'Trovato' : 'Non trovato'
                        });
                    
                    if (avatarElement) {
                        avatarElement.textContent = (userData.username || 'U')[0].toUpperCase();
                    }
                    
                    if (userNameElement) {
                        userNameElement.textContent = userData.username || 'Utente';
                    }
                    
                    if (userTagElement) {
                        const discriminator = userData.discriminator || '0001';
                        userTagElement.textContent = `#${discriminator}`;
                    }
                    
                    if (userRoleElement) {
                        const roleText = savedAccessLevel === 'admin' ? 'Dirigenza' : 'Operatore';
                        userRoleElement.textContent = roleText;
                        console.log('✅ Ruolo aggiornato con:', roleText);
                        console.log('🔍 Debug ruolo DETTAGLIATO:');
                        console.log('  - savedAccessLevel:', savedAccessLevel);
                        console.log('  - typeof savedAccessLevel:', typeof savedAccessLevel);
                        console.log('  - savedAccessLevel === "admin":', savedAccessLevel === 'admin');
                        console.log('  - savedAccessLevel === "operator":', savedAccessLevel === 'operator');
                        console.log('  - roleText finale:', roleText);
                        console.log('  - userRoleElement.textContent:', userRoleElement.textContent);
                    }
                    
                    // Carica la pagina iniziale
                    loadPage('overview');
                    
                    // Controlla accesso Shadow dopo il login automatico (più volte per sicurezza)
                    setTimeout(() => {
                        updateNavbarForShadowAccess();
                    }, 1000);
                    
                    setTimeout(() => {
                        updateNavbarForShadowAccess();
                    }, 3000);
                    
                    setTimeout(() => {
                        updateNavbarForShadowAccess();
                    }, 5000);
                    
                    console.log('✅ Login automatico completato!');
                    return;
                } else {
                    console.log('⚠️ Utente non più autorizzato, rimuovo credenziali');
                    localStorage.removeItem('authenticatedUserId');
                    localStorage.removeItem('userData');
                    localStorage.removeItem('userAccessLevel');
                }
            }
            
                console.log('🔕 Nessun utente autenticato trovato, mostro schermata di login');
        });

        // Chiudi dropdown quando si clicca fuori
        document.addEventListener('click', (e) => {
            const userProfile = document.querySelector('.user-profile');
            const dropdown = document.querySelector('.user-dropdown');
            
            if (userProfile && dropdown && !userProfile.contains(e.target)) {
                dropdown.classList.remove('active');
                const chevron = userProfile.querySelector('i.fa-chevron-down');
                if (chevron) {
                    chevron.style.transform = 'rotate(0deg)';
                }
            }
        });
        // Aggiungi keyframes spin e altre animazioni
        const animationStyle = document.createElement('style');
        animationStyle.textContent = `
            @keyframes spin { 
                from { transform: rotate(0deg); } 
                to { transform: rotate(360deg); } 
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(20px); }
                to { opacity: 1; transform: translateY(0); }
            }
            @keyframes slideInLeft {
                from { opacity: 0; transform: translateX(-50px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes slideInRight {
                from { opacity: 0; transform: translateX(50px); }
                to { opacity: 1; transform: translateX(0); }
            }
            @keyframes bounceIn {
                0% { opacity: 0; transform: scale(0.3); }
                50% { opacity: 1; transform: scale(1.05); }
                70% { transform: scale(0.9); }
                100% { opacity: 1; transform: scale(1); }
            }
            @keyframes pulse {
                0%, 100% { opacity: 1; }
                50% { opacity: 0.5; }
            }
        `;
        document.head.appendChild(animationStyle);
        // ========== SISTEMA DROPDOWN PERSONALIZZATO ==========
        // Funzione per creare un dropdown personalizzato
        function createCustomDropdown(id, placeholder, options, selectedValue = '', onSelect = null) {
            const dropdownHTML = 
                '<div class="custom-dropdown" id="' + id + '-dropdown">' +
                    '<div class="dropdown-trigger" onclick="toggleDropdown(\'' + id + '\')" tabindex="0">' +
                        '<div class="dropdown-text" id="' + id + '-text">' + placeholder + '</div>' +
                        '<i class="fas fa-chevron-down dropdown-arrow"></i>' +
                    '</div>' +
                    '<div class="dropdown-menu" id="' + id + '-menu">' +
                        options.map(option => 
                            '<div class="dropdown-item" ' +
                                 'data-value="' + option.value + '" ' +
                                 'onclick="selectDropdownOption(\'' + id + '\', \'' + option.value + '\', \'' + option.text + '\', \'' + (option.icon || '') + '\', \'' + (option.qualification || '') + '\')"' +
                                 (selectedValue === option.value ? ' class="selected"' : '') + '>' +
                                (option.icon ? '<span class="dropdown-item-icon">' + option.icon + '</span>' : '') +
                                '<div class="dropdown-item-text">' +
                                    option.text +
                                    (option.qualification ? '<div class="dropdown-item-qualification">' + option.qualification + '</div>' : '') +
                                '</div>' +
                            '</div>'
                        ).join('') +
                    '</div>' +
                '</div>';
            
            return dropdownHTML;
        }
        // Funzione per aprire/chiudere dropdown
        function toggleDropdown(id) {
            const trigger = document.getElementById(id + '-dropdown').querySelector('.dropdown-trigger');
            const menu = document.getElementById(id + '-menu');
            
            // Chiudi tutti gli altri dropdown
            document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                if (menu.id !== id + '-menu') {
                    menu.classList.remove('show');
                    menu.previousElementSibling.classList.remove('open');
                }
            });
            
            // Toggle dropdown corrente
            trigger.classList.toggle('open');
            menu.classList.toggle('show');
        }
        // Funzione per selezionare un'opzione
        function selectDropdownOption(id, value, text, icon, qualification) {
            const trigger = document.getElementById(id + '-dropdown').querySelector('.dropdown-trigger');
            const menu = document.getElementById(`${id}-menu`);
            const textElement = document.getElementById(id + '-text');
            
            // Aggiorna testo visualizzato
            textElement.innerHTML = 
                (icon ? '<span style="margin-right: 0.5rem;">' + icon + '</span>' : '') +
                text +
                (qualification ? '<span style="color: #94a3b8; font-size: 0.75rem; margin-left: 0.5rem;">• ' + qualification + '</span>' : '');
            
            // Aggiorna stato selezionato
            menu.querySelectorAll('.dropdown-item').forEach(item => {
                item.classList.remove('selected');
                if (item.dataset.value === value) {
                    item.classList.add('selected');
                }
            });
            
            // Chiudi dropdown
            trigger.classList.remove('open');
            menu.classList.remove('show');
            
            // Trigger callback se fornito
            if (window['on' + id + 'Select']) {
                window['on' + id + 'Select'](value, text, icon, qualification);
            }
        }

        // Funzione per chiudere tutti i dropdown quando si clicca fuori
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.custom-dropdown')) {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                    menu.previousElementSibling.classList.remove('open');
                });
            }
        });

        // Funzione per gestire la navigazione con tastiera
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                document.querySelectorAll('.dropdown-menu.show').forEach(menu => {
                    menu.classList.remove('show');
                    menu.previousElementSibling.classList.remove('open');
                });
            }
        });
        // ========== INIZIALIZZAZIONE SISTEMA ==========
        // Carica dati salvati all'avvio
        async function initializeSystem() {
            console.log('🔄 Inizializzazione sistema...');
            
            // Ripristina eventuale sessione utente
            try {
                const storedLevel = localStorage.getItem('userAccessLevel');
                const storedId = localStorage.getItem('authenticatedUserId');
                if (storedLevel && (storedLevel === 'admin' || storedLevel === 'operator') && storedId) {
                    userAccessLevel = storedLevel;
                    console.log('👤 Sessione ripristinata:', { storedLevel, storedId });
                }
            } catch {}
            
            // Carica dati dal localStorage prima
            await loadOperators();
            await loadShifts();
            loadNotifications();
            
            // Carica moduli di attivazione
            await loadActivationModules();
            
            // DISABILITATO: Auto-sync che causa precaricamenti infiniti
            // startAutoSync();
            console.log('⚠️ Auto-sync disabilitato per evitare precaricamenti infiniti');
            
            
            // Controllo finale di sicurezza: assicurati che ci siano sempre operatori
            // Ma solo dopo un breve delay per evitare errori durante il caricamento veloce
            setTimeout(async () => {
            if (!operators || operators.length === 0) {
                    console.log('🚨 CONTROLLO FINALE: Nessun operatore trovato, provo a caricare dal file JSON...');
                    const jsonSuccess = await loadOperatorsFromJSON();
                    if (!jsonSuccess) {
                        console.log('❌ File JSON non disponibile, impossibile caricare operatori');
                        // Mostra errore solo se siamo ancora sulla pagina dopo il delay
                        const currentPage = document.querySelector('.nav-btn.active');
                        if (currentPage && currentPage.textContent.includes('Gerarchia')) {
                            UI.notify('❌ Impossibile caricare operatori. Controlla la connessione.', 'error', '❌ Errore');
                        }
                    }
                }
            }, 2000); // Delay di 2 secondi per evitare errori durante switching veloce
            
            console.log('📊 Stato finale sistema:', {
                operators: operators.length,
                shifts: shifts.length,
                notifications: notifications.length
            });
            
            // Controlla sempre l'accesso Shadow all'avvio (anche dopo refresh)
            console.log('🥷 Controllo accesso Shadow all\'avvio...');
            setTimeout(() => {
                updateNavbarForShadowAccess();
            }, 1000);
            
            setTimeout(() => {
                updateNavbarForShadowAccess();
            }, 3000);
            
            setTimeout(() => {
                updateNavbarForShadowAccess();
            }, 5000);
            
        }

          // Inizializza e carica automaticamente i dati per tutti gli utenti
          setTimeout(async () => {
              console.log('🔄 Caricamento automatico dati per tutti gli utenti...');
                  await initializeSystem();
              console.log('📊 Sistema inizializzato automaticamente');
              
              // Solo se l'utente è autenticato E non c'è una pagina attiva, apri la Panoramica
              if (isUserAuthenticated()) {
                  const currentPage = document.querySelector('.nav-btn.active');
                  if (!currentPage || currentPage.textContent.includes('Panoramica')) {
                      console.log('👤 Utente autenticato, apro Panoramica...');
                  loadPage('overview');
                  } else {
                      console.log('👤 Utente autenticato, mantengo pagina corrente:', currentPage.textContent);
                  }
              } else {
                  console.log('👤 Utente non autenticato, mostro pagina di login...');
                  // Mostra la pagina di login o una pagina pubblica
              }
                  
                  // Aggiorna la gerarchia dopo il caricamento dei dati
                  setTimeout(() => {
                      updateOverviewStats();
                  }, 1000);
          }, 1000);
        // Nascondi il main-content all'inizio per mostrare solo il login
        const mainContent = document.querySelector('.main-content');
        if (mainContent) {
            mainContent.classList.add('hidden');
        }
        // Controlla se c'è un callback di Discord
        handleDiscordCallback();

        // Aggiungi pulsante di emergenza per utenti bloccati
        setTimeout(() => {
            const loadingOverlay = document.querySelector('.loading-overlay');
            if (loadingOverlay && loadingOverlay.style.display !== 'none') {
                console.log('🚨 Rilevato loading bloccato, aggiungo pulsante di emergenza');
                
                const emergencyBtn = document.createElement('button');
                emergencyBtn.innerHTML = '🚨 Bypass Autenticazione (Solo per Test)';
                emergencyBtn.style.cssText = `
                    position: fixed;
                    bottom: 20px;
                    right: 20px;
                    background: linear-gradient(135deg, #ef4444, #dc2626);
                    color: white;
                    border: none;
                    border-radius: 0.75rem;
                    padding: 1rem 1.5rem;
                    font-weight: 700;
                    font-size: 0.875rem;
                    cursor: pointer;
                    z-index: 10000;
                    box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4);
                    transition: all 0.3s ease;
                `;
                
                emergencyBtn.onclick = () => {
                    console.log('🚨 Bypass di emergenza attivato');
                    UI.loading('', false);
                    
                    const testUser = {
                        id: '734406288213016607', // ID operatore autorizzato
                        username: 'EmergencyOperator',
                        discriminator: '7777',
                        avatar: null,
                        email: null
                    };
                    
                    showDashboard(testUser);
                    emergencyBtn.remove();
                };
                
                document.body.appendChild(emergencyBtn);
            }
        }, 15000); // Dopo 15 secondi

        console.log('✅ Sistema caricato - VERSIONE PULITA');
    </script>
</body>
</html>
